---
title: "Taro å°ç¨‹åºå¼€å‘å¤§å‹å®æˆ˜ï¼ˆå…­ï¼‰ï¼šLeanCloudï¼Œä¸€ç»Ÿæ±Ÿæ¹–"
description: "åœ¨ä¸Šä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®²è§£äº†ä½¿ç”¨å¾®ä¿¡å°ç¨‹åºäº‘ä½œä¸ºæˆ‘ä»¬çš„å°ç¨‹åºåå°ï¼Œç„¶åæˆ‘ä»¬è·‘é€šäº†æˆ‘ä»¬çš„æ³¨å†Œç™»å½•ã€åˆ›å»ºå¸–å­ã€è·å–å¸–å­åˆ—è¡¨ã€è·å–å¸–å­è¯¦æƒ…çš„å…¨æ ˆæµç¨‹ï¼Œå¦‚æœåªæƒ³äº†è§£å¾®ä¿¡å°ç¨‹åºçš„å…¨æ ˆå¼€å‘æµç¨‹çš„è¯ï¼Œä¹‹å‰çš„æ–‡ç« å·²ç»è¶³å¤Ÿäº†ï¼Œå¦‚æœè¿˜æƒ³äº†è§£è·¨ç«¯å¼€å‘å…¨æ ˆå¼€å‘æµç¨‹çš„è¯ï¼ˆå½“ç„¶ç”¨ Taro çš„åŒå­¦ä¼°è®¡ä¹Ÿæ¯”è¾ƒæœŸå¾…è·¨ç«¯çš„å…¨æ ˆå¼€å‘æµç¨‹ï¼Œæ‰‹åŠ¨æ»‘ç¨½ï¼‰æ¥ä¸‹æ¥è¿™ç¯‡æ–‡ç« å°±æ˜¯ä½ çš„èœäº†ğŸ˜†"
tags: ["Taro", "LeanCloud", "Serverless"]
categories: ["å°ç¨‹åº", "Taro", "è¿›é˜¶"]
date: 2020-02-19T10:16:40.222Z
photos:
  - https://static.tuture.co/c/34a473b/taro-cover-8.jpg
---

<div class="profileBox">
  <div class="avatarBox">
    <a href="https://github.com/tuture-dev"><img src="/images/avatars/tuture-dev.jpg" alt="" class="avatar"></a>
  </div>
  <div class="rightBox">
    <div class="infoBox">
    <a href="https://github.com/tuture-dev"><p class="nickName">@tuture-dev</p></a>
  </div>
  <div class="codeBox">
    <a href="https://github.com/tuture-dev/ultra-club"><span class="codeText">æŸ¥çœ‹ä»£ç </span></a>
  </div>
  </div>
</div>

## LeanCloud,ä¸€ç»Ÿæ±Ÿæ¹–

åœ¨ä¸Šä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®²è§£äº†ä½¿ç”¨å¾®ä¿¡å°ç¨‹åºäº‘ä½œä¸ºæˆ‘ä»¬çš„å°ç¨‹åºåå°ï¼Œç„¶åæˆ‘ä»¬è·‘é€šäº†æˆ‘ä»¬çš„æ³¨å†Œç™»å½•ã€åˆ›å»ºå¸–å­ã€è·å–å¸–å­åˆ—è¡¨ã€è·å–å¸–å­è¯¦æƒ…çš„å…¨æ ˆæµç¨‹ï¼Œå¦‚æœåªæƒ³äº†è§£å¾®ä¿¡å°ç¨‹åºçš„å…¨æ ˆå¼€å‘æµç¨‹çš„è¯ï¼Œä¹‹å‰çš„æ–‡ç« å·²ç»è¶³å¤Ÿäº†ï¼Œå¦‚æœè¿˜æƒ³äº†è§£è·¨ç«¯å¼€å‘å…¨æ ˆå¼€å‘æµç¨‹çš„è¯ï¼ˆå½“ç„¶ç”¨ Taro çš„åŒå­¦ä¼°è®¡ä¹Ÿæ¯”è¾ƒæœŸå¾…è·¨ç«¯çš„å…¨æ ˆå¼€å‘æµç¨‹ï¼Œæ‰‹åŠ¨æ»‘ç¨½ï¼‰æ¥ä¸‹æ¥è¿™ç¯‡æ–‡ç« å°±æ˜¯ä½ çš„èœäº†ğŸ˜†

é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹æœ€ç»ˆçš„è¿è¡Œæ•ˆæœï¼š

![](https://static.tuture.co/c/34a473b/1705b4e9b0b79869.gif)

åœ¨è¿™ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ¥å…¥ LeanCloud Serverless æœåŠ¡ï¼Œå®ƒç±»ä¼¼å¾®ä¿¡å°ç¨‹åºäº‘ï¼Œåªä¸è¿‡å®ƒæ²¡æœ‰å¹³å°å±æ€§ï¼Œæ‰€æœ‰çš„ç«¯éƒ½å¯ä»¥ä¾¿æ·è®¿é—®ï¼Œç›¸ä¿¡ä½ å·²ç»è¿«ä¸åŠå¾…äº†ï¼Œè®©æˆ‘ä»¬é©¬ä¸Šå¼€å§‹å§ğŸ’ªï¼

### å°ç¨‹åºæ¥å…¥å¤–ç½‘çš„æµç¨‹

å› ä¸ºå°ç¨‹åºæ˜¯å°è£…åœ¨ä¸€äº›å·¨å‹ App åº”ç”¨é‡Œçš„æ²™ç›’ç¯å¢ƒä¹‹å†…ï¼Œæ‰€ä»¥å¯¹äºæ¥å…¥å¤–ç«™çš„æœåŠ¡éœ€è¦ä¸€äº›ç‰¹æ®Šçš„æµç¨‹ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹ï¼š

- æ³¨å†Œå¤–ç«™æœåŠ¡çš„è´¦å·
- æ‰¾åˆ°å¯¹åº”çš„å°ç¨‹åºå¼€å‘æ¥å…¥æŒ‡å—
- è·å–å¯¹åº”çš„æ¥å…¥åœ°å€ï¼Œå°†æ¥å…¥åœ°å€å¡«å…¥å°ç¨‹åºåå°çš„ç™½åå•åˆ—è¡¨
- åœ¨å°ç¨‹åºå®é™…æ¥å…¥ï¼Œå¹¶è¿›è¡Œæµ‹è¯•

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬çš„å¤–ç«™ç‰¹æŒ‡ LeanCloud Serverless äº‘æœåŠ¡ï¼Œå°ç¨‹åºç‰¹æŒ‡å¾®ä¿¡å°ç¨‹åºå’Œæ”¯ä»˜å®å°ç¨‹åºã€‚

å¥½çš„ï¼Œäº†è§£äº†æµç¨‹ä¹‹åï¼Œæˆ‘ä»¬ç°åœ¨æ¥èµ°ä¸€éæµç¨‹æ¥å°†æˆ‘ä»¬çš„ LeanCloud æ¥å…¥åˆ°å¾®ä¿¡/æ”¯ä»˜å®å°ç¨‹åºã€‚

#### æ³¨å†Œå¤–ç«™æœåŠ¡çš„è´¦å·

è®¿é—® LeanCloud ç½‘å€ï¼š[ç‚¹æˆ‘è®¿é—®](https://www.leancloud.cn/)ï¼Œå®Œæˆæ³¨å†Œç™»å½•æµç¨‹ã€‚

#### æ‰¾åˆ°å¯¹åº”çš„å°ç¨‹åºå¼€å‘æ¥å…¥æŒ‡å—

è¿™é‡Œæˆ‘ä»¬æ‰¾åˆ° LeanCloud å¾®ä¿¡/QQ å°ç¨‹åºæ¥å…¥æŒ‡å—ï¼š[ç‚¹æˆ‘è®¿é—®](https://leancloud.cn/docs/weapp.html)

{% note info %}
**æç¤º**

LeanCloud æ²¡æœ‰æä¾›æ”¯ä»˜å®çš„æ¥å…¥æŒ‡å—ï¼Œä½†æ˜¯å°ç¨‹åºæ¥å…¥æŒ‡å—éƒ½åŸºæœ¬ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¼šä¸€ä¸€è®²è§£è¿™ä¸€æµç¨‹ã€‚
{% endnote %}

#### è·å–å¯¹åº”çš„æ¥å…¥åœ°å€

LeanCloud å·²ç»æœ‰è¯¦ç»†çš„é“¾æ¥æç¤ºå¦‚ä½•æ¥å…¥ï¼š

![](https://static.tuture.co/c/34a473b/1705b4b3d3c87988.jpeg)

å¯¹äºæ”¯ä»˜å®å°ç¨‹åºçš„ç™½åå•é…ç½®åœ°å€å¦‚ä¸‹ï¼š[ç‚¹æˆ‘è®¿é—®](https://mini.open.alipay.com/channel/miniIndex.htm)ã€‚

#### åœ¨å°ç¨‹åºå®é™…æ¥å…¥ï¼Œå¹¶è¿›è¡Œæµ‹è¯•

æœ€åæˆ‘ä»¬éœ€è¦è¿›è¡Œå°ç¨‹åºçš„å®é™…æ¥å…¥ï¼Œå› ä¸º LeanCloud å¹¶æ²¡æœ‰æä¾›æ”¯ä»˜å®å°ç¨‹åºçš„ SDK åŒ…ï¼Œè¿™é‡Œå¯¹äºæ”¯ä»˜å®å°ç¨‹åºæˆ‘ä»¬ä½¿ç”¨ LeanCloud æä¾›çš„ REST æ¥å£è¿›è¡Œè®¿é—®ï¼Œå…·ä½“åœ°å€å¦‚ä¸‹ï¼š[ç‚¹æˆ‘è®¿é—®](https://leancloud.cn/docs/leanengine-rest-api.html#hash20005220)ã€‚

### å®šä¹‰ LeanCloud ç›¸å…³çš„è¾…åŠ©å‡½æ•°

å¯¹äºæ¥å…¥ LeanCloudï¼Œæˆ‘ä»¬éœ€è¦åœ¨åº”ç”¨ä¸­åšä¸€ç³»åˆ—åˆå§‹åŒ–ç¯å¢ƒçš„å‡†å¤‡ï¼Œåœ¨ `src/api/` æ–‡ä»¶å¤¹ä¸‹åˆ›å»º `utils.js` æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­ç¼–å†™å†…å®¹å¦‚ä¸‹ï¼š

```js src/api/utils.js https://github.com/tuture-dev/ultra-club/blob/abfd872/src/api/utils.js æŸ¥çœ‹å®Œæ•´ä»£ç 
const API_BASE_URL = ''

const LOGIN_URL = `${API_BASE_URL}/1.1/functions/login`
const CREATE_POST_URL = `${API_BASE_URL}/1.1/functions/createPost`
const GET_POST_URL = `${API_BASE_URL}/1.1/functions/getPost`
const GET_POSTS_URL = `${API_BASE_URL}/1.1/functions/getPosts`

const HEADER = {
  'X-LC-Prod': 1,
  'X-LC-Id': '',
  'X-LC-Key': '',
}

const convertUserFormat = user => {
  const _id = user.objectId
  delete user.objectId

  return { ...user, _id }
}

const convertPostFormat = post => {
  const _id = post.objectId
  const user = convertUserFormat(post.user)

  delete post.objectId
  delete post.user

  return { ...post, _id, user }
}

const convertPostsFormat = posts => {
  const convertedPosts = posts.map(post => convertPostFormat(post))

  return convertedPosts
}

export {
  LOGIN_URL,
  HEADER,
  CREATE_POST_URL,
  GET_POST_URL,
  GET_POSTS_URL,
  convertPostsFormat,
  convertPostFormat,
  convertUserFormat,
}
```

å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„ä»£ç ä¸»è¦åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼š

- å®šä¹‰äº‘å‡½æ•°çš„ REST URLï¼ŒLeanCloud çš„äº‘å‡½æ•° REST URL çš„æ ¼å¼ç±»ä¼¼è¿™æ ·ï¼š`https://API_BASE_URL/1.1/functions/functionName`ï¼Œå…¶ä¸­ `API_BASE_URL` å¯ä»¥é€šè¿‡æ–‡æ¡£è·å–ï¼š[ç‚¹æˆ‘è®¿é—®](https://leancloud.cn/docs/leanengine-rest-api.html#hash-1722650509)ï¼›è€Œ `functionName` å³ä¸ºæˆ‘ä»¬éœ€è¦è°ƒç”¨çš„äº‘å‡½æ•°åå­—ã€‚è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº† `API_BASE_URL` ï¼Œæˆ‘ä»¬ç»™äº†ç©ºå­—ç¬¦ä¸²ï¼Œè¯»è€…å¯ä»¥æ ¹æ® LeanCloud ç»™ä¸çš„ `Base URL` æ›¿ä»£ç©ºå­—ç¬¦ä¸²ï¼›åŒæ ·æˆ‘ä»¬å®šä¹‰äº†å››ä¸ªäº‘å‡½æ•°ï¼Œåˆ†åˆ«ä»£è¡¨ç™»å½•ã€åˆ›å¸–ã€æŸ¥è¯¢å¸–å­åˆ—è¡¨ã€æŸ¥è¯¢å•ä¸ªå¸–å­ï¼Œå…·ä½“çš„äº‘ç«¯äº‘å‡½æ•°æˆ‘ä»¬å°†åœ¨åé¢å®šä¹‰ã€‚
- ç¬¬äºŒä¸ªéƒ¨åˆ†å³ä¸ºå‘ LeanCloud æœåŠ¡å™¨å‘é€ REST è¯·æ±‚æ—¶éœ€è¦æºå¸¦çš„è¯·æ±‚å¤´éƒ¨ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥åœ¨æ–‡æ¡£é‡Œç»™å‡ºï¼š[ç‚¹æˆ‘è®¿é—®](https://leancloud.cn/docs/leanengine-rest-api.html#hash20005220)ï¼›è¿™é‡Œä¹Ÿéœ€è¦ç”¨æˆ·ç”¨è‡ªå·±çš„å†…å®¹æ¥æ›¿æ¢ä¸Šé¢çš„ç©ºå­—ç¬¦ä¸²ã€‚
- ç¬¬ä¸‰ä¸ªéƒ¨åˆ†åˆ™ä¸ºä¸¤ä¸ªè¾…åŠ©è½¬æ¢æ ¼å¼çš„å‡½æ•°ï¼Œä¸»è¦ç”¨äºå°† LeanCloud æ•°æ®åº“æ ¼å¼çš„æ•°æ®ä¸ç°æœ‰çš„å¾®ä¿¡å°ç¨‹åºæ•°æ®åº“æ ¼å¼çš„æ•°æ®å…¼å®¹ã€‚
- ç¬¬å››ä¸ªéƒ¨åˆ†ä¸ºå¯¼å‡ºè¿™äº›å®šä¹‰çš„å†…å®¹ï¼Œä¾›å…¶å®ƒæ¨¡å—ä½¿ç”¨ã€‚

{% note info %}
**æç¤º**

ä¸Šé¢çš„ `API_BASE_URL` å’Œ `HEADER` éƒ½éœ€è¦ç”¨æˆ·åœ¨ç™»å½•çš„æƒ…å†µä¸‹è®¿é—®ç»™å‡ºçš„åœ°å€æ‰èƒ½è·å–åˆ°ã€‚
{% endnote %}

### åœ¨ LeanCloud ä¸Šé¢åˆ›å»ºæ•°æ®åº“è¡¨

ç™»å½• LeanCloud æ§åˆ¶å°ï¼Œåœ¨å·¦è¾¹æ çš„ **å­˜å‚¨ > ç»“æ„åŒ–æ•°æ®** å¯ä»¥çœ‹åˆ°åˆ›å»º Class çš„æŒ‰é’®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ª Class æ¥åˆ›å»ºä¸€å¼ æ•°æ®åº“è¡¨ï¼š

![](https://static.tuture.co/c/34a473b/1705b4b3d457d461.jpeg)

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆ›å»ºäº†ä¸¤å¼ è¡¨ï¼š`Post` å’Œ `MyUser`ï¼Œä¸€ä¸ªå­˜æ”¾å’Œå¸–å­ç›¸å…³çš„æ•°æ®ï¼Œä¸€ä¸ªå­˜æ”¾å’Œç”¨æˆ·ç›¸å…³çš„æ•°æ®ã€‚å…¶ä¸­ `MyUser` ç±»ä¼¼ä¹‹å‰æˆ‘ä»¬åœ¨å¾®ä¿¡å°ç¨‹åºæ•°æ®åº“è¡¨æ—¶çš„ `user` è¡¨ã€‚

#### å®šä¹‰ MyUser å­—æ®µ

å¦‚å›¾ä¹‹å‰åœ¨å¾®ä¿¡å°ç¨‹åºæ•°æ®åº“è¡¨åˆ›å»ºæ—¶ä¸€æ ·ï¼Œæˆ‘ä»¬åŒæ ·ä¸º `MyUser` å®šä¹‰å¦‚ä¸‹çš„å­—æ®µï¼š

- avatar
- nickName

è‡³äºè¯»è€…çœ‹åˆ°çš„å…¶å®ƒå­—æ®µéƒ½æ˜¯ LeanCloud é»˜è®¤åˆ›å»ºä¸”è‡ªåŠ¨æ›´æ–°çš„å­—æ®µï¼Œç”¨æˆ·ä¸å¯ä»¥æ“ä½œã€‚

#### å®šä¹‰ Post å­—æ®µ

åŒæ ·å’Œä¹‹å‰åœ¨å¾®ä¿¡å°ç¨‹åºé‡Œé¢åˆ›å»º `post` ä¸€æ ·ï¼Œæˆ‘ä»¬ç»™ Post å®šä¹‰å¦‚ä¸‹å­—æ®µ:

- content
- title
- user

çœ¼å°–çš„åŒå­¦å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œè¿™é‡Œçš„ `user` å­—æ®µæ˜¯ä¸€ä¸ª `Pointer` ç±»å‹ï¼Œå®ƒæ˜¯ LeanCloud æ•°æ®è¡¨ç‹¬æœ‰çš„å¼•ç”¨ç±»å‹ï¼Œç±»ä¼¼å…³ç³»æ•°æ®åº“é‡Œé¢çš„å¤–é”®ï¼Œå³å­˜ä¸€ä¸ªæŒ‡é’ˆï¼Œä¹‹åè·å–æ•°æ®çš„æ—¶å€™å¯ä»¥ä¾¿æ·çš„è·å–å¯¹åº”çš„ `user` æ•°æ®ã€‚

#### å…³äºé»˜è®¤ Class çš„è§£é‡Š

è¿™é‡Œæœ‰äº›è¯»è€…å¯èƒ½æœ‰ç–‘é—®ï¼Œä¸ºä»€ä¹ˆè¿˜æœ‰ä¸€äº›å¤šä½™çš„è¡¨äº†ï¼Ÿè¿™äº›ä»¥ä¸‹åˆ’çº¿å¼€å¤´çš„ Class å…¶å®æ˜¯ LeanCloud é»˜è®¤åˆ›å»ºçš„ï¼Œä¸å…è®¸åˆ é™¤ï¼Œç”¨äº LeanCloud SDK å°è£…ä¸€ç³»åˆ—å¸¸ç”¨ä¸”å¤æ‚çš„åº”ç”¨åŠŸèƒ½ï¼Œä¾›ç”¨æˆ·å¿«é€Ÿæ­å»º App/ç½‘ç«™/å°ç¨‹åºåŸå‹ï¼Œæ¯”å¦‚ç±»ä¼¼å¾®ä¿¡çš„æœ‹å‹åœˆåŠŸèƒ½ï¼ŒLeanCloud æä¾›å¼€ç®±å³ç”¨çš„é€»è¾‘ï¼Œä½ å¯ä»¥ç›´æ¥è°ƒç”¨ã€‚

å¹¶ä¸”ï¼Œç±»ä¼¼ `_User` å’Œ `User` Class å…¶å®æ˜¯å¼•ç”¨è‡ªåŒä¸€ä¸ª Classï¼Œæ‰€ä»¥ä¸èƒ½åˆ›å»ºå’Œ LeanCloud é»˜è®¤çš„ç±»å…·æœ‰åŒåä¸”ä¸å¸¦å‰ç¼€ä¸‹åˆ’çº¿çš„ç±»ï¼Œæ¯”å¦‚ `User` ï¼Œ`File` ç±»å°±ä¸èƒ½åˆ›å»ºï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº† `MyUser` ç±»ï¼Œè¿™æ ·ä¸ç”¨å»è€ƒè™‘ `_User` ç±»æœ¬èº«å­˜åœ¨çš„ä¸€äº›ç»†èŠ‚é™åˆ¶ã€‚

### åœ¨ LeanCloud ä¸Šåˆ›å»ºäº‘å‡½æ•°

åœ¨ä¸Šä¸€æ­¥é‡Œé¢ï¼Œæˆ‘ä»¬åœ¨å°ç¨‹åºä»£ç é‡Œåˆ›å»ºäº†å’Œ LeanCloud æœ‰å…³çš„é€»è¾‘ä»£ç ï¼Œå…¶ä¸­æˆ‘ä»¬åˆ›å»ºäº†å››ä¸ªäº‘å‡½æ•°ï¼Œç°åœ¨æˆ‘ä»¬è¦åˆ›å»ºå¯¹åº”è¿™å››ä¸ªäº‘å‡½æ•°çš„å®é™…äº‘å‡½æ•°ã€‚

æ³¨å†Œå¹¶ç™»é™† LeanCloud ä¹‹åï¼Œç‚¹å‡»å·¦è¾¹æ çš„ **äº‘å¼•æ“ > éƒ¨ç½²** å¯ä»¥çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„ç•Œé¢ï¼š

![](https://static.tuture.co/c/34a473b/1705b4b3d8296a49.jpeg)

LeanCloud æä¾›ç»™æˆ‘ä»¬åœ¨çº¿åˆ›å»ºå’Œç¼–å†™äº‘å‡½æ•°çš„æ–¹ä¾¿ç•Œé¢ï¼Œä½¿å¾—æˆ‘ä»¬ä¸ç”¨è‡ªå·±åˆ›å»ºæœ¬åœ°æœåŠ¡å™¨ä»£ç å’Œé…ç½®éƒ¨ç½²å’Œè¿ç»´è¿‡ç¨‹ï¼Œå¤§å¤§åŠ é€Ÿäº†ç¨‹åºçš„å¼€å‘è¿‡ç¨‹ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†éµå¾ªä»¥ä¸‹ä¸‰æ­¥èµ°çš„æ–¹å¼æ¥è¿›è¡Œ LeanCloud äº‘å‡½æ•°çš„å¼€å‘ï¼š

- åˆ›å»ºäº‘å‡½æ•°
- éƒ¨ç½²
- åœ¨å°ç¨‹åºç«¯è¿›è¡Œè°ƒè¯•

### åˆ›å»º User é€»è¾‘ äº‘å‡½æ•°

ç‚¹å‡»ç•Œé¢é‡Œé¢çš„åˆ›å»ºæŒ‰é’®ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹çš„ç•Œé¢ï¼š

![](https://static.tuture.co/c/34a473b/1705b4b3da0b73ca.jpeg)

å¯ä»¥çœ‹åˆ°ä¸Šå›¾åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

- é€‰æ‹©æˆ‘ä»¬è¦åˆ›å»ºçš„å‡½æ•°ç±»å‹ï¼Œä¸»è¦æœ‰ä¸‰ç±»ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹© `Function` ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤é€‰æ‹©çš„ç±»å‹ï¼Œå…¶ä½™ä¸¤ç±»è¯»è€…æœ‰å…´è¶£å¯ä»¥è‡ªè¡Œæ¢ç´¢ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸å±•å¼€è®²ã€‚
- æ¥ç€å°±æ˜¯å®šä¹‰ä½ çš„å‡½æ•°åï¼Œè¿™é‡Œæˆ‘ä»¬å¡«å…¥ `login`ã€‚
- æ¥ç€å°±æ˜¯ç¼–å†™å‡½æ•°ä½“ï¼Œå®ƒæ˜¯ä¸€ä¸ª Node.js å‡½æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦ç¼–å†™å¯¹åº”çš„ Node.js å¤„ç†é€»è¾‘å°±å¯ä»¥äº†ã€‚
- æœ€åæˆ‘ä»¬å¯ä»¥å¯¹è¿™ä¸ªå‡½æ•°å†™ä¸€ç‚¹æ³¨é‡Šï¼Œæ–¹ä¾¿æ—¥åå›é¡¾ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©ä¸å¡«å…¥ã€‚

å¥½çš„ï¼Œäº†è§£äº†åˆ›å»ºå‡½æ•°çš„å¼¹å‡ºå±‚ä¹‹åï¼Œæˆ‘ä»¬å¡«å…¥æˆ‘ä»¬éœ€è¦åˆ›å»ºçš„ `login` å‡½æ•°ä½“å¦‚ä¸‹ï¼š

```JavaScript
const { userInfo } = request.params

const query = new AV.Query('MyUser')
query.equalTo('nickName', userInfo.nickName)
const users = await query.find()

if (users.length > 0) {
    return users[0]
} else {
    const MyUser = AV.Object.extend('MyUser')
    const myUser = new MyUser()

    const { nickName, avatar } = userInfo
    myUser.set('nickName', nickName)
    myUser.set('avatar', avatar)

    const user = await myUser.save()
    return user
}
```

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¸Šé¢çš„å†…å®¹ä¸»è¦æ”¹åŠ¨æœ‰å››å¤„ï¼š

- ä» `request.params` å–åˆ°å¯¹åº”çš„è¯·æ±‚ä½“æ•°æ® `userInfo`ï¼Œè¿™å†³å®šäº†æˆ‘ä»¬ä¹‹ååœ¨å°ç¨‹åºç«¯è°ƒç”¨ LeanCloud äº‘å‡½æ•°æ—¶ï¼Œè¦ä½¿ç”¨ `POST` çš„æ–¹å¼ã€‚
- æ¥ç€æˆ‘ä»¬ä½¿ç”¨äº† LeanCloud çš„æŸ¥è¯¢ SDK æ“ä½œ
- æ¥ç€é€šè¿‡ `equalTo` è¿›è¡Œæ¡ä»¶è¿‡æ»¤ï¼Œè¿™é‡Œæˆ‘ä»¬æŸ¥è¯¢ `nickName` ä¸º `userInfo.nickName` çš„ç”¨æˆ·ã€‚
- é€šè¿‡ `query.find()` æ¥æäº¤æŸ¥è¯¢æ“ä½œï¼Œæ³¨æ„åˆ°è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† `await` å…³é”®å­—ï¼Œé‚£æ˜¯å› ä¸ºé»˜è®¤åŒ…è£¹äº‘å‡½æ•°æçš„æ˜¯ä¸€ä¸ª `async` å‡½æ•°ï¼Œå…è®¸æˆ‘ä»¬æ–¹ä¾¿çš„æ‰§è¡Œå¼‚æ­¥æµç¨‹ã€‚

æ¥ç€æˆ‘ä»¬å¯¹æŸ¥è¯¢åˆ°çš„æ•°æ®è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœ `users.length > 0 ` è¡¨ç¤ºå­˜åœ¨ç”¨æˆ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿”å›æŸ¥è¯¢åˆ°çš„ç¬¬ä¸€ä¸ªç”¨æˆ·ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œæˆ‘ä»¬æ‰§è¡Œåˆ›å»ºç”¨æˆ·æ“ä½œï¼Œå†è¿”å›åˆ›å»ºçš„ç”¨æˆ·ã€‚

åˆ›å»ºç”¨æˆ·çš„æ“ä½œä¸»è¦æ˜¯å¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

å®ä¾‹åŒ–è¿™ä¸ªç±»è·å–ä¸€ä¸ªå¯¹è±¡

è®¾ç½®è¿™ä¸ªå¯¹è±¡çš„å±æ€§ï¼Œè¿™é‡Œé€šè¿‡ `set(key, value)` çš„æ–¹å¼è®¾ç½®

é€šè¿‡å¯¹è±¡çš„ `save` æ–¹æ³•è¿›è¡Œä¿å­˜ï¼Œä¿å­˜åˆ° LeanCloud æ•°æ®åº“

{% note info %}
**æç¤º**

è¿™é‡Œæˆ‘ä»¬åªç”¨åˆ°äº† LeanCloud çš„ä¸€äº›ç®€å•æ“ä½œï¼Œå…·ä½“çš„è¯¦æƒ…å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œå®˜æ–¹æ–‡æ¡£æ’°å†™äº†éå¸¸å®Œå¤‡çš„æ“ä½œæŒ‡å—ï¼š[ç‚¹æˆ‘æŸ¥çœ‹](https://leancloud.cn/docs/leanstorage_guide-js.html)ã€‚
{% endnote %}

#### éƒ¨ç½²

æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤ç¼–å†™å®Œ `login` äº‘å‡½æ•°ä¹‹åï¼Œç‚¹å‡»ä¿å­˜ï¼Œæ­¤æ—¶æˆ‘ä»¬çš„äº‘å‡½æ•°å°±ç¼–å†™å¥½äº†ï¼Œä½†æ˜¯æˆ‘ä»¬ç›®å‰åœ¨å°ç¨‹åºç«¯è¿˜æ— æ³•è°ƒç”¨å®ƒï¼Œå› ä¸ºæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªéƒ¨ç½²çš„æ“ä½œã€‚

åœ¨ LeanCloud ä¸Šé¢è¿›è¡Œäº‘å‡½æ•°çš„éƒ¨ç½²ä¹ŸåŒæ ·ç®€å•ï¼Œåªéœ€è¦ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®ï¼š

![](https://static.tuture.co/c/34a473b/1705b4b43e869c59.jpeg)

ç‚¹æˆ‘ä¹‹åï¼Œç­‰å¾…éƒ¨ç½²æç¤ºï¼Œè¿‡ä¸€ä¼šåº”è¯¥å°±ä¼šæç¤ºéƒ¨ç½²æˆåŠŸï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥åœ¨å°ç¨‹åºç«¯é€šè¿‡ REST API è®¿é—®äº†ã€‚

#### åœ¨å°ç¨‹åºç«¯è¿›è¡Œè°ƒè¯•

æˆ‘ä»¬è¿™é‡Œä½¿ç”¨ LeanCloud ä¸»è¦æ˜¯è®©æ”¯ä»˜å®å°ç¨‹åºä¹Ÿå¯ä»¥æˆä¸ºå…¨æ ˆåº”ç”¨ï¼Œå¯¹åº”æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ H5ï¼Œå› ä¸º Taro ç›®å‰å¯¹ H5 çš„æ”¯æŒè¿˜ä¸å®Œå–„ï¼Œæˆ‘ä»¬å†³å®šæ”¾å¼ƒå¯¹ H5 çš„è®²è§£, ä½†æ˜¯è¿™å¹¶ä¸ä»£è¡¨ Taro å­˜åœ¨ç¼ºé™·ï¼Œåªèƒ½è¯´å®ƒæ˜¯ä¸€ä¸ªå¾ˆæœ‰æ½œåŠ›çš„æ¡†æ¶ï¼Œæˆé•¿è¿˜éœ€è¦å®è·µï¼Œå¹¶ä¸”è·¨ç«¯å°ç¨‹åºæ˜¯å®ƒè¯ç”Ÿçš„é‡ç‚¹ï¼Œå°†ç²¾åŠ›æ”¾åœ¨ä¸»è¦çš„è·¯å¾„ä¸Šæ˜¯å€¼å¾—æå€¡çš„ï¼ŒTaro åœ¨è¿‘æœŸå‘å¸ƒäº† Taro Nextï¼Œæ”¯æŒä½¿ç”¨ Vue/React/Nerve å¼€å‘è·¨ç«¯å°ç¨‹åºï¼Œç¬”è€…è¿™é‡Œæ¨èè¯»è€…å¯ä»¥å°è¯•ä¸€æ³¢ï¼š[ç‚¹æˆ‘è·³è½¬](https://taro.jd.com/)ã€‚

å› ä¸ºæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº† `login` çš„äº‘å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ”¹è¿›ä¸€ä¸‹æˆ‘ä»¬çš„æ”¯ä»˜å®ç™»å½•çš„æŒ‰é’®é€»è¾‘ï¼Œæ‰“å¼€ `src/components/AlipayLoginButton/index.js` å¯¹å…¶ä¸­çš„å†…å®¹ä½œå‡ºå¦‚ä¸‹çš„ä¿®æ”¹:

```js src/components/AlipayLoginButton/index.js https://github.com/tuture-dev/ultra-club/blob/abfd872/src/components/AlipayLoginButton/index.js æŸ¥çœ‹å®Œæ•´ä»£ç 
// ...
import { useDispatch } from '@tarojs/redux'

import './index.scss'
[tuture-del]import { SET_LOGIN_INFO } from '../../constants'
[tuture-add]import { LOGIN } from '../../constants'

export default function AlipayLoginButton(props) {
  const [isLogin, setIsLogin] = useState(false)
  // ...
      userInfo = JSON.parse(userInfo.response).response
      const { avatar, nickName } = userInfo

[tuture-del]      await Taro.setStorage({
[tuture-del]        key: 'userInfo',
[tuture-del]        data: { avatar, nickName },
[tuture-del]      })
[tuture-del] 
      dispatch({
[tuture-del]        type: SET_LOGIN_INFO,
[tuture-add]        type: LOGIN,
        payload: {
[tuture-del]          avatar,
[tuture-del]          nickName,
[tuture-add]          userInfo: {
[tuture-add]            avatar,
[tuture-add]            nickName,
[tuture-add]          },
        },
      })
    } catch (err) {
      // ...
```

å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„å†…å®¹æ”¹åŠ¨ä¸»è¦æœ‰ä¸‰å¤„ï¼š

- æˆ‘ä»¬åˆ æ‰äº†ä½¿ç”¨æ”¯ä»˜å®è·å–ç™»å½•ä¿¡æ¯ä¹‹åå­˜ç¼“å­˜çš„é€»è¾‘
- æ¥ç€ï¼Œæˆ‘ä»¬ dispatch äº†ä¸€ä¸ª `action.type` ä¸º LOGIN çš„å¼‚æ­¥ ACTIONï¼Œå¹¶ä¼ é€’äº† `userInfo` æ•°æ®
- æœ€åæˆ‘ä»¬å¯¼å…¥äº†éœ€è¦çš„ `LOGIN` å¸¸é‡ã€‚

é™¤äº†æ”¯ä»˜å®ç™»å½•æŒ‰é’®çš„é€»è¾‘æ”¹è¿›ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è¦æ”¹è¿›æˆ‘ä»¬çš„ api é€»è¾‘ï¼ŒåŠ ä¸Šå¯¹æ”¯ä»˜å®ç¯å¢ƒçš„åˆ¤æ–­å’Œè°ƒç”¨å¯¹åº”çš„ LeanCloud äº‘å‡½æ•°ã€‚

æ‰“å¼€ `src/api/user.js` æ–‡ä»¶ï¼Œå¯¹å…¶ä¸­çš„å†…å®¹ä½œå‡ºå¯¹åº”çš„ä¿®æ”¹å¦‚ä¸‹ï¼š

```js src/api/user.js https://github.com/tuture-dev/ultra-club/blob/abfd872/src/api/user.js æŸ¥çœ‹å®Œæ•´ä»£ç 
import Taro from '@tarojs/taro'

[tuture-add]import { HEADER, LOGIN_URL, convertUserFormat } from './utils'
[tuture-add] 
async function login(userInfo) {
  const isWeapp = Taro.getEnv() === Taro.ENV_TYPE.WEAPP
  const isAlipay = Taro.getEnv() === Taro.ENV_TYPE.ALIPAY
[tuture-add]  const isH5 = Taro.getEnv() === Taro.ENV_TYPE.WEB

  // é’ˆå¯¹å¾®ä¿¡å°ç¨‹åºä½¿ç”¨å°ç¨‹åºäº‘å‡½æ•°ï¼Œå…¶ä»–ä½¿ç”¨å°ç¨‹åº RESTful API
  try {
    // ...
      })

      return result.user
[tuture-add]    } else if (isAlipay || isH5) {
[tuture-add]      const { data } = await Taro.request({
[tuture-add]        url: LOGIN_URL,
[tuture-add]        method: 'POST',
[tuture-add]        header: { ...HEADER },
[tuture-add]        data: {
[tuture-add]          userInfo,
[tuture-add]        },
[tuture-add]      })
[tuture-add] 
[tuture-add]      return convertUserFormat(data.result)
    }
  } catch (err) {
    console.error('login ERR: ', err)
  // ...
```

å¯ä»¥çœ‹åˆ°ä¸Šé¢ä¸»è¦åšäº†å››å¤„ä¿®æ”¹ï¼š

- é¦–å…ˆæˆ‘ä»¬å¯¼å…¥äº†ä¹‹å‰å®šä¹‰çš„å’Œ LeanCloud æœ‰ä¸ªçš„ `utils` å‡½æ•°ã€‚
- æ¥ç€æˆ‘ä»¬åŠ å…¥äº†å¯¹ H5 ç¯å¢ƒçš„åˆ¤æ–­ã€‚
- æœ€åæˆ‘ä»¬å¢åŠ äº†ä¸€ä¸ª `else if` æµç¨‹ï¼Œç”¨äºåˆ¤æ–­åœ¨æ”¯ä»˜å®å°ç¨‹åºæˆ–è€… H5 ç¯å¢ƒä¸‹éœ€è¦æ‰§è¡Œå‘èµ· REST è¯·æ±‚çš„é€»è¾‘ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† `Taro.request` è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œå¹¶ä¼ å…¥äº†å¯¹åº”çš„ `url` ã€`header`ã€`data`ï¼Œä»¥åŠå°†è¯·æ±‚çš„ç±»å‹è®¾ç½®ä¸º `POST`ï¼Œä¹‹å‰æˆ‘ä»¬æåˆ°è¿‡ï¼Œå¯¹ LeanCloud äº‘å‡½æ•°å‘èµ·è¯·æ±‚éƒ½éœ€è¦ä½¿ç”¨ `POST` æ–¹æ³•ã€‚
- æœ€åæˆ‘ä»¬å°†ä» LeanCloud æ‹¿åˆ°çš„è¯·æ±‚ç»“æœä½¿ç”¨ `convertUserFormat ` åšäº†ä¸€æ¬¡æ ¼å¼çš„è½¬æ¢ï¼Œä»¥é€‚åº”ç°æœ‰çš„å¾®ä¿¡å°ç¨‹åºæ•°æ®ç±»å‹ã€‚

å¥½äº†ï¼Œé€šè¿‡ä»¥ä¸Šä¸‰æ­¥æµç¨‹ï¼Œæˆ‘ä»¬å°±è·‘é€šäº†å°ç¨‹åºç±»è¯·æ±‚ LeanCloud çš„æµç¨‹ï¼Œä¿å­˜ä¿®æ”¹çš„ä»£ç ï¼Œè®©æˆ‘ä»¬é©¬ä¸Šæ‰“å¼€æ”¯ä»˜å®å°ç¨‹åºè¯•ä¸€ä¸‹å§ï¼

![](https://static.tuture.co/c/34a473b/1705b4b43fe789ae.jpeg)

### åˆ›å»º Post é€»è¾‘äº‘å‡½æ•°

åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº† User é€»è¾‘çš„ `login` äº‘å‡½æ•°ï¼Œåœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ¥æ”¶å°¾ Post é€»è¾‘çš„ä¸‰ä¸ªäº‘å‡½æ•°ï¼š

- `createPost`
- `getPosts`
- `getPost`

å› ä¸ºåˆ›å»ºçš„é€»è¾‘å’Œæ–¹å¼å’Œä¹‹å‰çš„ `login` äº‘å‡½æ•°ç±»ä¼¼ï¼Œæˆ‘ä»¬è¿™é‡Œä¸å†èµ˜è¿°ï¼Œä¼šç®€å•çš„è´´ä¸€ä¸‹ä»£ç ï¼Œä½†æˆ‘ä»¬åŒæ ·æŒ‰ç…§ä¹‹å‰çš„ä¸‰æ­¥æµç¨‹æ¥è®²è§£ã€‚

#### åˆ›å»ºäº‘å‡½æ•°

é¦–å…ˆåˆ›å»ºæˆ‘ä»¬çš„ `createPost` äº‘å‡½æ•°ï¼Œå…¶ä»£ç å¦‚ä¸‹ï¼š

```JavaScript
const { postData, userId } = request.params

const Post = AV.Object.extend('Post')
const post = new Post();

const myUser = AV.Object.createWithoutData('MyUser', userId)
const newPost = await post.save({
    ...postData,
    user: myUser
});

const query = new AV.Query('Post')
const postWithUser = await query.equalTo('objectId', newPost.get('objectId')).include('user').first()

return postWithUser
```

æ¥ç€æ¥åˆ›å»ºæˆ‘ä»¬çš„è·å–å¸–å­åˆ—è¡¨çš„äº‘å‡½æ•° `getPosts`ï¼Œå…¶ä»£ç å¦‚ä¸‹ï¼š

```JavaScript
const query = new AV.Query('Post')
const posts = await query.include('user').find()

return posts
```

æœ€åæ˜¯æˆ‘ä»¬çš„è·å–å¸–å­è¯¦æƒ…çš„äº‘å‡½æ•° `getPost`ï¼š

```JavaScript
const { postId } = request.params

const query = new AV.Query('Post')
const post = await query.equalTo('objectId', postId).include('user').first()

return post
```

#### éƒ¨ç½²

å¥½çš„ï¼Œä¸‰ä¸ªå’Œ Post é€»è¾‘æœ‰å…³çš„äº‘å‡½æ•°åˆ›å»ºå¥½äº†ï¼Œæˆ‘ä»¬é©¬ä¸Šç‚¹å‡»éƒ¨ç½²æŒ‰é’®æ¥å°†å®ƒä»¬éƒ¨ç½²ä¸Šçº¿ã€‚

#### åœ¨å°ç¨‹åºç«¯æµ‹è¯•

å½“åˆ›å»ºå¥½äº‘å‡½æ•°ï¼Œå¹¶éƒ¨ç½²å¥½ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å°ç¨‹åºç«¯ç¼–å†™å¯¹åº”çš„ä»£ç è¿›è¡Œæµ‹è¯•äº†ï¼Œæ‰“å¼€ `src/api/post.js` æ–‡ä»¶ï¼Œå¯¹å…¶ä¸­çš„ä»£ç åšå‡ºå¯¹åº”çš„ä¿®æ”¹å¦‚ä¸‹ï¼š

```js src/api/post.js https://github.com/tuture-dev/ultra-club/blob/abfd872/src/api/post.js æŸ¥çœ‹å®Œæ•´ä»£ç 
import Taro from '@tarojs/taro'

[tuture-add]import {
[tuture-add]  HEADER,
[tuture-add]  CREATE_POST_URL,
[tuture-add]  GET_POSTS_URL,
[tuture-add]  GET_POST_URL,
[tuture-add]  convertPostFormat,
[tuture-add]  convertPostsFormat,
[tuture-add]} from './utils'
[tuture-add] 
async function createPost(postData, userId) {
  const isWeapp = Taro.getEnv() === Taro.ENV_TYPE.WEAPP
  const isAlipay = Taro.getEnv() === Taro.ENV_TYPE.ALIPAY
[tuture-del] 
[tuture-del]  console.log('postData', postData, userId)
[tuture-add]  const isH5 = Taro.getEnv() === Taro.ENV_TYPE.WEB

  // é’ˆå¯¹å¾®ä¿¡å°ç¨‹åºä½¿ç”¨å°ç¨‹åºäº‘å‡½æ•°ï¼Œå…¶ä»–ä½¿ç”¨å°ç¨‹åº RESTful API
  try {
    // ...
      })

      return result.post
[tuture-add]    } else if (isAlipay || isH5) {
[tuture-add]      const { data } = await Taro.request({
[tuture-add]        url: CREATE_POST_URL,
[tuture-add]        method: 'POST',
[tuture-add]        header: { ...HEADER },
[tuture-add]        data: {
[tuture-add]          postData,
[tuture-add]          userId,
[tuture-add]        },
[tuture-add]      })
[tuture-add] 
[tuture-add]      return convertPostFormat(data.result)
    }
  } catch (err) {
    console.error('createPost ERR: ', err)
  // ...
async function getPosts() {
  const isWeapp = Taro.getEnv() === Taro.ENV_TYPE.WEAPP
  const isAlipay = Taro.getEnv() === Taro.ENV_TYPE.ALIPAY
[tuture-add]  const isH5 = Taro.getEnv() === Taro.ENV_TYPE.WEB

  // é’ˆå¯¹å¾®ä¿¡å°ç¨‹åºä½¿ç”¨å°ç¨‹åºäº‘å‡½æ•°ï¼Œå…¶ä»–ä½¿ç”¨å°ç¨‹åº RESTful API
  try {
    // ...
      })

      return result.posts
[tuture-add]    } else if (isAlipay || isH5) {
[tuture-add]      const { data } = await Taro.request({
[tuture-add]        url: GET_POSTS_URL,
[tuture-add]        method: 'POST',
[tuture-add]        header: { ...HEADER },
[tuture-add]      })
[tuture-add] 
[tuture-add]      return convertPostsFormat(data.result)
    }
  } catch (err) {
    console.error('getPosts ERR: ', err)
  // ...
async function getPost(postId) {
  const isWeapp = Taro.getEnv() === Taro.ENV_TYPE.WEAPP
  const isAlipay = Taro.getEnv() === Taro.ENV_TYPE.ALIPAY
[tuture-add]  const isH5 = Taro.getEnv() === Taro.ENV_TYPE.WEB

  // é’ˆå¯¹å¾®ä¿¡å°ç¨‹åºä½¿ç”¨å°ç¨‹åºäº‘å‡½æ•°ï¼Œå…¶ä»–ä½¿ç”¨å°ç¨‹åº RESTful API
  try {
    // ...
      })

      return result.post
[tuture-add]    } else if (isAlipay || isH5) {
[tuture-add]      const { data } = await Taro.request({
[tuture-add]        url: GET_POST_URL,
[tuture-add]        method: 'POST',
[tuture-add]        header: { ...HEADER },
[tuture-add]        data: {
[tuture-add]          postId,
[tuture-add]        },
[tuture-add]      })
[tuture-add] 
[tuture-add]      return convertPostFormat(data.result)
    }
  } catch (err) {
    console.error('getPost ERR: ', err)
  // ...
```

å¯ä»¥çœ‹åˆ°ä¸Šé¢ä¸»è¦åšäº†å››å¤„ä¿®æ”¹ï¼š

- é¦–å…ˆæˆ‘ä»¬å¯¼å…¥äº†ä¹‹å‰å®šä¹‰çš„å’Œ LeanCloud æœ‰å…³çš„ `utils` å‡½æ•°ã€‚
- æ¥ç€æˆ‘ä»¬åŠ å…¥äº†å¯¹ H5 ç¯å¢ƒçš„åˆ¤æ–­ã€‚
- æœ€åæˆ‘ä»¬å¢åŠ äº†ä¸€ä¸ª `else if` æµç¨‹ï¼Œç”¨äºåˆ¤æ–­åœ¨æ”¯ä»˜å®å°ç¨‹åºæˆ–è€… H5 ç¯å¢ƒä¸‹éœ€è¦æ‰§è¡Œå‘èµ· REST è¯·æ±‚çš„é€»è¾‘ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† `Taro.request` è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œå¹¶ä¼ å…¥äº†å¯¹åº”ä¸‰ä¸ªå’Œ Post é€»è¾‘æœ‰å…³çš„ `url` ã€ä»¥åŠå¯¹åº”çš„ `header`ã€`data`ï¼Œä»¥åŠå°†è¯·æ±‚çš„ç±»å‹è®¾ç½®ä¸º `POST`ï¼Œä¹‹å‰æˆ‘ä»¬æåˆ°è¿‡ï¼Œå¯¹ LeanCloud äº‘å‡½æ•°å‘èµ·è¯·æ±‚éƒ½éœ€è¦ä½¿ç”¨ `POST` æ–¹æ³•ã€‚
- æœ€åæˆ‘ä»¬å°†ä» LeanCloud æ‹¿åˆ°çš„è¯·æ±‚ç»“æœä½¿ç”¨ `convertPostFormat ` åšäº†ä¸€æ¬¡æ ¼å¼çš„è½¬æ¢ï¼Œä»¥é€‚åº”ç°æœ‰çš„å¾®ä¿¡å°ç¨‹åºæ•°æ®ç±»å‹ã€‚

å¥½äº†ï¼Œé€šè¿‡ä»¥ä¸Šä¸‰æ­¥æµç¨‹ï¼Œæˆ‘ä»¬å°±è·‘é€šäº†å°ç¨‹åºç±»è¯·æ±‚ LeanCloud çš„æµç¨‹ï¼Œä¿å­˜ä¿®æ”¹çš„ä»£ç ï¼Œè®©æˆ‘ä»¬é©¬ä¸Šæ‰“å¼€æ”¯ä»˜å®å°ç¨‹åºè¯•ä¸€ä¸‹å§ï¼

![](https://static.tuture.co/c/34a473b/1705b4b44d2d0cc8.jpeg)

### å°ç»“

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®²è§£äº†æ”¯ä»˜å®å°ç¨‹åºæ¥å…¥ LeanCloud Serverless äº‘æœåŠ¡çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å†æ¥å¤ä¹ ä¸€ä¸‹æ•´ä¸ªæµç¨‹ï¼š

- é¦–å…ˆæˆ‘ä»¬è®²è§£äº†å¾®ä¿¡å°ç¨‹åºäº‘çš„ä¸è¶³ï¼Œç„¶åå¼•å‡ºäº† LeanCloud æ¥å®ç°è·¨ç«¯å°ç¨‹åºå¼€å‘
- æ¥ç€æˆ‘ä»¬ä»‹ç»äº† LeanCloud æœåŠ¡çš„é…ç½®è¿‡ç¨‹ï¼Œå…·ä½“åŒ…å« 1ï¼‰æ³¨å†Œç™»å½• LeanCloud 2ï¼‰é…ç½®å¯¹åº”çš„å°ç¨‹åºåå°çš„ç™½åå•ã€‚ä¸”å› ä¸º LeanCloud æ²¡æœ‰æ”¯ä»˜å®å°ç¨‹åºçš„ SDKï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨ REST è¯·æ±‚çš„æ–¹å¼æ¥è·å–å’Œä¿®æ”¹å¯¹åº”çš„æ•°æ®
- æ¥ç€æˆ‘ä»¬è®²è§£äº†å¦‚ä½•åœ¨ LeanCloud ä¸Šé¢åˆ›å»ºæ•°æ®è¡¨ã€‚
- æ¥ç€ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•åœ¨ LeanCloud åˆ›å»ºäº‘å‡½æ•°ã€‚
- æœ€åæˆ‘ä»¬é€šè¿‡ä¸‰æ­¥èµ°æµç¨‹ï¼š1ï¼‰åˆ›å»ºäº‘å‡½æ•° 2ï¼‰éƒ¨ç½² 3ï¼‰åœ¨å°ç¨‹åºç«¯æµ‹è¯•ï¼Œåˆ›å»ºäº†æˆ‘ä»¬éœ€è¦çš„å››ä¸ªäº‘å‡½æ•°ã€‚

æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹æ•´ä½“çš„æ¥å…¥æ•ˆæœï¼š

![](https://static.tuture.co/c/34a473b/1705b4e9b0b79869.gif)

åˆ°è¿™é‡Œæˆ‘ä»¬çš„ **Taro å¤šç«¯å°ç¨‹åºå¼€å‘å¤§å‹å®æˆ˜** å°±åŸºæœ¬å‘Šä¸€æ®µè½äº†ï¼Œæ•´ä¸ªæ•™ç¨‹å†…å®¹æƒ³å½“é•¿ï¼Œæ¶µç›–çš„å†…å®¹ä¹Ÿç›¸å½“å¤šï¼Œè¿™ä¹Ÿæ˜¯å›¾é›€ç¤¾åŒºæœ€é•¿çš„ä¸€ä¸ªç³»åˆ—æ•™ç¨‹ã€‚æœ€åå¸Œæœ› Taro ç¤¾åŒºè¶Šæ¥è¶Šå¥½ï¼Œä¹Ÿå¸Œæœ›èƒ½å¸®åˆ°æ‚¨ï¼

### One More Thing

æˆ‘ä»¬åœ¨ä¹‹å‰çš„æ•™ç¨‹ä¸­èŠ±äº†8ç¯‡æ–‡ç« çš„ç¯‡å¹…è®²è§£äº†å°ç¨‹åºä»0åˆ°å¼€å‘å®Œæˆçš„è¿‡ç¨‹ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡å°†å¦‚ä½•å°†å°ç¨‹åºä¸Šçº¿ï¼Œè¿™é‡Œæˆ‘ä»¬å†é¢å¤–èŠ±ä¸€ç‚¹ç¬”å¢¨è®²ä¸€ä¸‹å¦‚ä½•ä¸Šçº¿ä½ çš„å°ç¨‹åºï¼Œå› ä¸ºå°ç¨‹åºçš„ä¸Šçº¿å¾ˆå®¹æ˜“ï¼Œæ‰€ä»¥å†…å®¹ä¸ä¼šå¾ˆé•¿ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥ç»§ç»­è¯»ä¸‹å»áƒ¦( Â´ï½¥á´—ï½¥` )æ¯”å¿ƒã€‚

#### å¾®ä¿¡å°ç¨‹åºä¸Šçº¿

é¦–å…ˆç‚¹å‡»å°ç¨‹åºå¼€å‘è€…å·¥å…·çš„å³ä¸Šè§’çš„ä¸Šä¼ æŒ‰é’®ï¼š

![](https://static.tuture.co/c/34a473b/1705b4c4db32af08.jpeg)

æ¥ç€å»å¾®ä¿¡å°ç¨‹åºç½‘ç«™åå°ï¼š[ç‚¹æˆ‘å‰å¾€](https://mp.weixin.qq.com/wxamp/home/guide?lang=zh_CN&token=160873486)ã€‚

è¿›è¡Œç™»å½•ä¹‹åï¼Œåœ¨è¿›æ¥çš„ç¬¬ä¸€ä¸ªé¡µé¢çš„ç¬¬äºŒæ­¥å¯ä»¥çœ‹è§ç‰ˆæœ¬å‘å¸ƒçš„ä¿¡æ¯ï¼Œå®‰è£…å¾®ä¿¡å®˜æ–¹çš„æµç¨‹è¿›è¡Œå³å¯ã€‚

![](https://static.tuture.co/c/34a473b/1705b4b456f9d5c4.jpeg)

#### æ”¯ä»˜å®å°ç¨‹åºä¸Šçº¿

é¦–å…ˆç‚¹å‡»æ”¯ä»˜å®å°ç¨‹åºå¼€å‘è€…å·¥å…·çš„å³ä¸Šè§’ä¸Šä¼ æŒ‰é’®ï¼š

![](https://static.tuture.co/c/34a473b/1705b4b49d020734.jpeg)

æ¥ç€å»æ”¯ä»˜å®å°ç¨‹åºåå°ï¼š[ç‚¹æˆ‘å‰å¾€](https://mini.open.alipay.com/channel/miniIndex.htm)ã€‚

è¿›è¡Œç™»å½•ä¹‹åï¼Œç‚¹å‡»é¡¶éƒ¨çš„ å¼€å‘ä¸­å¿ƒï¼Œé€‰æ‹©å°ç¨‹åºåº”ç”¨ï¼Œé€‰æ‹©ä½ çš„å°ç¨‹åºåº”ç”¨ï¼Œç„¶ååŒæ ·å¯ä»¥çœ‹åˆ°ç±»ä¼¼å‘å¸ƒä¸Šçº¿çš„æ ç›®ï¼Œå®‰è£…æ”¯ä»˜å®å®˜æ–¹çš„æµç¨‹è¿›è¡Œå‘å¸ƒå°±å¯ä»¥äº†ã€‚

![](https://static.tuture.co/c/34a473b/1705b4c4e4d77b6d.jpeg)

{% note info %}
**æç¤º**

å¾®ä¿¡/æ”¯ä»˜å®å°ç¨‹åºå¯¹äºæœ‰ç¤¾äº¤ã€ç¤¾åŒºæ€§è´¨çš„å°ç¨‹åºæ˜¯éœ€è¦ä¼ä¸šè®¤è¯çš„ï¼Œæ‰€ä»¥æœ‰ç±»ä¼¼éœ€æ±‚çš„éœ€è¦åšä¸€ä¸‹å‡†å¤‡ã€‚
{% endnote %}

å¥½äº†ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬çš„è¦è¯´å†è§äº† ğŸ‘‹ï¼å¸Œæœ›ä½ ä»¬å­¦å¾—å¼€å¿ƒï¼