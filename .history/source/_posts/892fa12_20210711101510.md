---
title: "ä¸€æ¯èŒ¶çš„æ—¶é—´ï¼Œä¸Šæ‰‹ Node.js"
description: "Node.js å¤ªç«äº†ï¼Œç«åˆ°å‡ ä¹æ‰€æœ‰å‰ç«¯å·¥ç¨‹å¸ˆéƒ½æƒ³å­¦ï¼Œå‡ ä¹æ‰€æœ‰åç«¯å·¥ç¨‹å¸ˆä¹Ÿæƒ³å­¦ã€‚ä¸€è¯´åˆ° Node.jsï¼Œæˆ‘ä»¬é©¬ä¸Šå°±ä¼šæƒ³åˆ°â€œå¼‚æ­¥â€ã€â€œäº‹ä»¶é©±åŠ¨â€ã€â€œéé˜»å¡â€ã€â€œæ€§èƒ½ä¼˜è‰¯â€è¿™å‡ ä¸ªç‰¹ç‚¹ï¼Œä½†æ˜¯ä½ çœŸçš„ç†è§£è¿™äº›è¯çš„å«ä¹‰å—ï¼Ÿè¿™ç¯‡æ•™ç¨‹å°†å¸¦ä½ å¿«é€Ÿå…¥é—¨ Node.jsï¼Œä¸ºåç»­çš„å‰ç«¯å­¦ä¹ æˆ–æ˜¯ Node.js è¿›é˜¶æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚"
categories: ["åç«¯", "Node.js", "å…¥é—¨"]
date: 2019-12-03T01:42:02.548Z
photos:
  - https://static.tuture.co/c/892fa12/cover.png
---

<div class="profileBox">
  <div class="avatarBox">
    <a href="https://github.com/mRcfps"><img src="/images/avatars/mRcfps.jpg" alt="" class="avatar"></a>
  </div>
  <div class="rightBox">
    <div class="infoBox">
    <a href="https://github.com/mRcfps"><p class="nickName">@mRcfps</p></a>
  </div>
  <div class="codeBox">
    <a href="https://github.com/mRcfps/nodejs-quickstart"><span class="codeText">æŸ¥çœ‹ä»£ç </span></a>
  </div>
  </div>
</div>

## èµ·æ­¥

{% note primary %}
**ä¸»è¦**

æ­¤æ•™ç¨‹å±äº[Node.js åç«¯å·¥ç¨‹å¸ˆå­¦ä¹ è·¯çº¿](https://github.com/tuture-dev/nodejs-roadmap)çš„ä¸€éƒ¨åˆ†ï¼Œç‚¹å‡»å¯æŸ¥çœ‹å…¨éƒ¨å†…å®¹ã€‚
{% endnote %}

### ä»€ä¹ˆæ˜¯ Nodeï¼Ÿ

ç®€å•åœ°è¯´ï¼ŒNodeï¼ˆæˆ–è€…è¯´ Node.jsï¼Œä¸¤è€…æ˜¯ç­‰ä»·çš„ï¼‰ æ˜¯ JavaScript çš„ä¸€ç§**è¿è¡Œç¯å¢ƒ**ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬çŸ¥é“ JavaScript éƒ½æ˜¯åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œçš„ï¼Œç”¨äºç»™ç½‘é¡µæ·»åŠ å„ç§åŠ¨æ€æ•ˆæœï¼Œé‚£ä¹ˆå¯ä»¥è¯´**æµè§ˆå™¨ä¹Ÿæ˜¯ JavaScript çš„è¿è¡Œç¯å¢ƒ**ã€‚é‚£ä¹ˆè¿™ä¸¤ä¸ªè¿è¡Œç¯å¢ƒæœ‰å“ªäº›å·®å¼‚å‘¢ï¼Ÿè¯·çœ‹ä¸‹å›¾ï¼š

![](https://static.tuture.co/c/892fa12/javascript-component.png)

ä¸¤ä¸ªè¿è¡Œç¯å¢ƒå…±åŒåŒ…å«äº† ECMAScriptï¼Œä¹Ÿå°±æ˜¯å‰¥ç¦»äº†æ‰€æœ‰è¿è¡Œç¯å¢ƒçš„ JavaScript **è¯­è¨€æ ‡å‡†**æœ¬èº«ã€‚ç°åœ¨ ECMAScript çš„å‘å±•é€Ÿåº¦éå¸¸æƒŠäººï¼Œå‡ ä¹èƒ½å¤Ÿåšåˆ°æ¯å¹´å‘å±•ä¸€ä¸ªç‰ˆæœ¬ã€‚

{% note info %}
**æç¤º**

ECMAScript å’Œ JavaScript çš„å…³ç³»æ˜¯ï¼Œå‰è€…æ˜¯åè€…çš„è§„æ ¼ï¼Œåè€…æ˜¯å‰è€…çš„ä¸€ç§å®ç°ã€‚åœ¨æ—¥å¸¸åœºåˆï¼Œè¿™ä¸¤ä¸ªè¯æ˜¯å¯ä»¥äº’æ¢çš„ã€‚æ›´å¤šèƒŒæ™¯çŸ¥è¯†å¯å‚è€ƒé˜®ä¸€å³°çš„[ã€ŠJavaScriptè¯­è¨€çš„å†å²ã€‹](http://javascript.ruanyifeng.com/introduction/history.html)ã€‚
{% endnote %}

å¦ä¸€æ–¹é¢ï¼Œæµè§ˆå™¨ç«¯ JavaScript è¿˜åŒ…æ‹¬äº†ï¼š

- æµè§ˆå™¨å¯¹è±¡æ¨¡å‹ï¼ˆBrowser Object Modelï¼Œç®€ç§° BOMï¼‰ï¼Œä¹Ÿå°±æ˜¯ `window`  å¯¹è±¡
- æ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼ˆDocument Object Modelï¼Œç®€ç§° DOMï¼‰ï¼Œä¹Ÿå°±æ˜¯ `document` å¯¹è±¡

è€Œ Node.js åˆ™æ˜¯åŒ…æ‹¬ V8 å¼•æ“ã€‚V8 æ˜¯ Chrome æµè§ˆå™¨ä¸­çš„ JavaScript å¼•æ“ï¼Œç»è¿‡å¤šå¹´çš„å‘å±•å’Œä¼˜åŒ–ï¼Œæ€§èƒ½å’Œå®‰å…¨æ€§éƒ½å·²ç»è¾¾åˆ°äº†ç›¸å½“çš„é«˜åº¦ã€‚è€Œ Node.js åˆ™è¿›ä¸€æ­¥å°† V8 å¼•æ“åŠ å·¥æˆå¯ä»¥åœ¨ä»»ä½•æ“ä½œç³»ç»Ÿä¸­è¿è¡Œ JavaScript çš„å¹³å°ã€‚

### é¢„å¤‡çŸ¥è¯†

åœ¨æ­£å¼å¼€å§‹è¿™ç¯‡æ•™ç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬å¸Œæœ›ä½ å·²ç»åšå¥½äº†ä»¥ä¸‹å‡†å¤‡ï¼š

- äº†è§£ JavaScript è¯­è¨€çš„åŸºç¡€çŸ¥è¯†ï¼Œå¦‚æœæœ‰è¿‡æµè§ˆå™¨ JS å¼€å‘ç»éªŒå°±æ›´å¥½äº†
- å·²ç»å®‰è£…äº† Node.jsï¼Œé…ç½®å¥½äº†é€‚åˆè‡ªå·±çš„ç¼–è¾‘å™¨æˆ– IDE
- äº†è§£ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„

### å­¦ä¹ ç›®æ ‡

è¿™ç¯‡æ–‡æ¡£å°†ä¼šè®©ä½ å­¦åˆ°ï¼š

- æµè§ˆå™¨ JavaScript ä¸ Node.js çš„å…³ç³»ä¸åŒºåˆ«
- äº†è§£ Node.js æœ‰å“ªäº›å…¨å±€å¯¹è±¡
- æŒæ¡ Node.js å¦‚ä½•å¯¼å…¥å’Œå¯¼å‡ºæ¨¡å—ï¼Œä»¥åŠæ¨¡å—æœºåˆ¶çš„åŸç†
- äº†è§£å¦‚ä½•ç”¨ Node.js å¼€å‘ç®€å•çš„å‘½ä»¤è¡Œåº”ç”¨
- å­¦ä¼šåˆ©ç”¨ npm ç¤¾åŒºçš„åŠ›é‡è§£å†³å¼€å‘ä¸­é‡åˆ°çš„éš¾é¢˜ï¼Œé¿å…â€œé‡å¤é€ è½®å­â€
- äº†è§£ npm scripts çš„åŸºæœ¬æ¦‚å¿µå’Œä½¿ç”¨
- åˆæ­¥äº†è§£ Node.js çš„äº‹ä»¶æœºåˆ¶

### è¿è¡Œ Node ä»£ç 

è¿è¡Œ Node ä»£ç é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼ï¼š1ï¼‰åœ¨ REPL ä¸­äº¤äº’å¼è¾“å…¥å’Œè¿è¡Œï¼›2ï¼‰å°†ä»£ç å†™å…¥ JS æ–‡ä»¶ï¼Œå¹¶ç”¨ Node æ‰§è¡Œã€‚

{% note info %}
**æç¤º**

REPL çš„å…¨ç§°æ˜¯ Read Eval Print Loopï¼ˆè¯»å–-æ‰§è¡Œ-è¾“å‡º-å¾ªç¯ï¼‰ï¼Œé€šå¸¸å¯ä»¥ç†è§£ä¸º**äº¤äº’å¼è§£é‡Šå™¨**ï¼Œä½ å¯ä»¥è¾“å…¥ä»»ä½•è¡¨è¾¾å¼æˆ–è¯­å¥ï¼Œç„¶åå°±ä¼šç«‹åˆ»æ‰§è¡Œå¹¶è¿”å›ç»“æœã€‚å¦‚æœä½ ç”¨è¿‡ Python çš„ REPL ä¸€å®šä¼šè§‰å¾—å¾ˆç†Ÿæ‚‰ã€‚
{% endnote %}

#### ä½¿ç”¨ REPL å¿«é€Ÿä½“éªŒ

å¦‚æœä½ å·²ç»å®‰è£…å¥½äº† Nodeï¼Œé‚£ä¹ˆè¿è¡Œä»¥ä¸‹å‘½ä»¤å°±å¯ä»¥è¾“å‡º Node.js çš„ç‰ˆæœ¬ï¼š

```bash
$ node -v
v12.10.0
```

ç„¶åï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è¿›å…¥ Node REPLï¼ˆç›´æ¥è¾“å…¥ `node`ï¼‰ï¼Œç„¶åè¾“å…¥ä»»ä½•åˆæ³•çš„ JavaScript è¡¨è¾¾å¼æˆ–è¯­å¥ï¼š

```
$ node
Welcome to Node.js v12.10.0.
Type ".help" for more information.
> 1 + 2
3
> var x = 10;
undefined
> x + 20
30
> console.log('Hello World');
Hello World
undefined
```

æœ‰äº›è¡Œçš„å¼€å¤´æ˜¯ `> `ï¼Œä»£è¡¨è¾“å…¥æç¤ºç¬¦ï¼Œå› æ­¤ `> ` åé¢çš„éƒ½æ˜¯æˆ‘ä»¬è¦è¾“å…¥çš„å‘½ä»¤ï¼Œå…¶ä»–è¡Œåˆ™æ˜¯è¡¨è¾¾å¼çš„è¿”å›å€¼æˆ–æ ‡å‡†è¾“å‡ºï¼ˆStandard Outputï¼Œstdoutï¼‰ã€‚è¿è¡Œçš„æ•ˆæœå¦‚ä¸‹ï¼š

![](https://static.tuture.co/c/892fa12/repl.gif)

#### ç¼–å†™ Node è„šæœ¬

REPL é€šå¸¸ç”¨æ¥è¿›è¡Œä¸€äº›ä»£ç çš„è¯•éªŒã€‚åœ¨æ­å»ºå…·ä½“åº”ç”¨æ—¶ï¼Œæ›´å¤šçš„è¿˜æ˜¯åˆ›å»º Node æ–‡ä»¶ã€‚æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªæœ€ç®€å•çš„ Node.js è„šæœ¬æ–‡ä»¶ï¼Œå«åš timer.jsï¼Œä»£ç å¦‚ä¸‹ï¼š

```js timer.js https://github.com/mRcfps/nodejs-quickstart/blob/03752c9/timer.js æŸ¥çœ‹å®Œæ•´ä»£ç 
console.log('Hello World!');
```

ç„¶åç”¨ Node è§£é‡Šå™¨æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ï¼š

```bash
$ node timer.js
Hello World!
```

çœ‹ä¸Šå»éå¸¸å¹³æ·¡æ— å¥‡ï¼Œä½†æ˜¯è¿™ä¸€è¡Œä»£ç å´å‡èšäº† Node.js å›¢é˜ŸèƒŒåçš„å¿ƒè¡€ã€‚æˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹ï¼Œåœ¨æµè§ˆå™¨å’Œ Node ç¯å¢ƒä¸­æ‰§è¡Œè¿™è¡Œä»£ç æœ‰ä»€ä¹ˆåŒºåˆ«ï¼š

- åœ¨æµè§ˆå™¨è¿è¡Œ `console.log` è°ƒç”¨äº† BOMï¼Œå®é™…ä¸Šæ‰§è¡Œçš„æ˜¯ `window.console.log('Hello World!')`
- Node é¦–å…ˆåœ¨æ‰€å¤„çš„æ“ä½œç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œç„¶åå‘æ ‡å‡†è¾“å‡ºæ‰“å°äº†æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼Œ å®é™…ä¸Šæ‰§è¡Œçš„æ˜¯ `process.stdout.write('Hello World!\n')`

ç®€è€Œè¨€ä¹‹ï¼ŒNode ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ— éœ€ä¾èµ–æµè§ˆå™¨ã€èƒ½å¤Ÿç›´æ¥ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’çš„ JavaScript ä»£ç è¿è¡Œç¯å¢ƒï¼

## Node å…¨å±€å¯¹è±¡åˆæ¢

å¦‚æœä½ æœ‰è¿‡ç¼–å†™ JavaScript çš„ç»éªŒï¼Œé‚£ä¹ˆä½ ä¸€å®šå¯¹å…¨å±€å¯¹è±¡ä¸é™Œç”Ÿã€‚åœ¨æµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬æœ‰ `document` å’Œ `window`  ç­‰å…¨å±€å¯¹è±¡ï¼›è€Œ Node åªåŒ…å« ECMAScript å’Œ V8ï¼Œä¸åŒ…å« BOM å’Œ DOMï¼Œå› æ­¤ Node ä¸­ä¸å­˜åœ¨ `document` å’Œ `window`ï¼›å–è€Œä»£ä¹‹ï¼ŒNode ä¸“å±çš„å…¨å±€å¯¹è±¡æ˜¯ `process`ã€‚åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†åˆæ­¥æ¢ç´¢ä¸€ç•ª Node å…¨å±€å¯¹è±¡ã€‚

### JavaScript å…¨å±€å¯¹è±¡çš„åˆ†ç±»

åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ JavaScript å„ä¸ªè¿è¡Œç¯å¢ƒçš„å…¨å±€å¯¹è±¡çš„æ¯”è¾ƒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://static.tuture.co/c/892fa12/global-objects.png)

å¯ä»¥çœ‹åˆ° JavaScript å…¨å±€å¯¹è±¡å¯ä»¥åˆ†ä¸ºå››ç±»ï¼š

1. æµè§ˆå™¨ä¸“å±ï¼Œä¾‹å¦‚ `window`ã€`alert` ç­‰ç­‰ï¼›
2. Node ä¸“å±ï¼Œä¾‹å¦‚ `process`ã€`__dirname`ã€`__filename` ç­‰ç­‰ï¼›
3. æµè§ˆå™¨å’Œ Node å…±æœ‰ï¼Œä½†æ˜¯**å®ç°æ–¹å¼ä¸åŒ**ï¼Œä¾‹å¦‚ `console`ï¼ˆç¬¬ä¸€èŠ‚ä¸­å·²æåˆ°ï¼‰ã€`setTimeout`ã€`setInterval` ç­‰ï¼›
4. æµè§ˆå™¨å’Œ Node å…±æœ‰ï¼Œå¹¶ä¸”å±äº **ECMAScript è¯­è¨€å®šä¹‰**çš„ä¸€éƒ¨åˆ†ï¼Œä¾‹å¦‚ `Date`ã€`String`ã€`Promise` ç­‰ï¼›

### Node ä¸“å±å…¨å±€å¯¹è±¡è§£æ

#### `process`

`process` å…¨å±€å¯¹è±¡å¯ä»¥è¯´æ˜¯ Node.js çš„çµé­‚ï¼Œå®ƒæ˜¯ç®¡ç†å½“å‰ Node.js è¿›ç¨‹çŠ¶æ€çš„å¯¹è±¡ï¼Œæä¾›äº†ä¸æ“ä½œç³»ç»Ÿçš„ç®€å•æ¥å£ã€‚

é¦–å…ˆæˆ‘ä»¬æ¢ç´¢ä¸€ä¸‹ `process` å¯¹è±¡çš„é‡è¦å±æ€§ã€‚æ‰“å¼€ Node REPLï¼Œç„¶åæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹ `process` å¯¹è±¡çš„ä¸€äº›å±æ€§ï¼š

- `pid`ï¼šè¿›ç¨‹ç¼–å·
- `env`ï¼šç³»ç»Ÿç¯å¢ƒå˜é‡
- `argv`ï¼šå‘½ä»¤è¡Œæ‰§è¡Œæ­¤è„šæœ¬æ—¶çš„è¾“å…¥å‚æ•°
- `platform`ï¼šå½“å‰æ“ä½œç³»ç»Ÿçš„å¹³å°

{% note info %}
**æç¤º**

å¯ä»¥åœ¨ Node REPL ä¸­å°è¯•ä¸€ä¸‹è¿™äº›å¯¹è±¡ã€‚åƒä¸Šé¢è¯´çš„é‚£æ ·è¿›å…¥ REPLï¼ˆä½ çš„è¾“å‡ºå¾ˆæœ‰å¯èƒ½è·Ÿæˆ‘çš„ä¸ä¸€æ ·ï¼‰ï¼š

```bash
$ node
Welcome to Node.js v12.10.0.
Type ".help" for more information.
> process.pid
3
> process.platform
'darwin'
```
{% endnote %}

#### `Buffer`

`Buffer` å…¨å±€å¯¹è±¡è®© JavaScript ä¹Ÿèƒ½å¤Ÿè½»æ¾åœ°å¤„ç†äºŒè¿›åˆ¶æ•°æ®æµï¼Œç»“åˆ Node çš„æµæ¥å£ï¼ˆStreamï¼‰ï¼Œèƒ½å¤Ÿå®ç°é«˜æ•ˆçš„äºŒè¿›åˆ¶æ–‡ä»¶å¤„ç†ã€‚è¿™ç¯‡æ•™ç¨‹ä¸ä¼šæ¶‰åŠ `Buffer`ã€‚

#### `__filename` å’Œ `__dirname`

åˆ†åˆ«ä»£è¡¨å½“å‰æ‰€è¿è¡Œ Node è„šæœ¬çš„æ–‡ä»¶è·¯å¾„å’Œæ‰€åœ¨ç›®å½•è·¯å¾„ã€‚

{% note warning %}
**æ³¨æ„**

`__filename` å’Œ `__dirname` åªèƒ½åœ¨ Node è„šæœ¬æ–‡ä»¶ä¸­ä½¿ç”¨ï¼Œåœ¨ REPL ä¸­æ˜¯æ²¡æœ‰å®šä¹‰çš„ã€‚
{% endnote %}

### ä½¿ç”¨ Node å…¨å±€å¯¹è±¡

æ¥ä¸‹æ¥æˆ‘ä»¬å°†åœ¨åˆšæ‰å†™çš„è„šæœ¬æ–‡ä»¶ä¸­ä½¿ç”¨ Node å…¨å±€å¯¹è±¡ï¼Œåˆ†åˆ«æ¶µç›–ä¸Šé¢çš„ä¸‰ç±»ï¼š

- Node ä¸“å±ï¼š`process`
- å®ç°æ–¹å¼ä¸åŒçš„å…±æœ‰å…¨å±€å¯¹è±¡ï¼š`console` å’Œ `setTimeout`
- ECMAScript è¯­è¨€å®šä¹‰çš„å…¨å±€å¯¹è±¡ï¼š`Date`

{% note info %}
**æç¤º**

`setTimeout` ç”¨äºåœ¨ä¸€å®šæ—¶é—´åæ‰§è¡Œç‰¹å®šçš„é€»è¾‘ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ—¶é—´åˆ°äº†ä¹‹åè¦æ‰§è¡Œçš„å‡½æ•°ï¼ˆå›è°ƒå‡½æ•°ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç­‰å¾…æ—¶é—´ã€‚ä¾‹å¦‚ï¼š

```javascript
setTimeout(someFunction, 1000);
```

å°±ä¼šåœ¨ `1000` æ¯«ç§’åæ‰§è¡Œ `someFunction` å‡½æ•°ã€‚
{% endnote %}

ä»£ç å¦‚ä¸‹ï¼š

```js timer.js https://github.com/mRcfps/nodejs-quickstart/blob/f9d3190/timer.js æŸ¥çœ‹å®Œæ•´ä»£ç 
[tuture-del]console.log('Hello World!');
[tuture-add]setTimeout(() => {
[tuture-add]  console.log('Hello World!');
[tuture-add]}, 3000);
[tuture-add] 
[tuture-add]console.log('å½“å‰è¿›ç¨‹ ID', process.pid);
[tuture-add]console.log('å½“å‰è„šæœ¬è·¯å¾„', __filename);
[tuture-add] 
[tuture-add]const time = new Date();
[tuture-add]console.log('å½“å‰æ—¶é—´', time.toLocaleString());
```

è¿è¡Œä»¥ä¸Šè„šæœ¬ï¼Œåœ¨æˆ‘æœºå™¨ä¸Šçš„è¾“å‡ºå¦‚ä¸‹ï¼ˆHello World! ä¼šå»¶è¿Ÿä¸‰ç§’è¾“å‡ºï¼‰ï¼š

```text
$ node timer.js
å½“å‰è¿›ç¨‹ ID 7310
å½“å‰è„šæœ¬è·¯å¾„ /Users/mRc/Tutorials/nodejs-quickstart/timer.js
å½“å‰æ—¶é—´ 12/4/2019, 9:49:28 AM
Hello World!
```

ä»ä¸Šé¢çš„ä»£ç ä¸­ä¹Ÿå¯ä»¥ä¸€ç¥ Node.js å¼‚æ­¥çš„é­…åŠ›ï¼šåœ¨ `setTimeout` ç­‰å¾…çš„ 3 ç§’å†…ï¼Œç¨‹åºå¹¶**æ²¡æœ‰é˜»å¡**ï¼Œè€Œæ˜¯**ç»§ç»­å‘ä¸‹æ‰§è¡Œ**ï¼Œè¿™å°±æ˜¯ Node.js çš„å¼‚æ­¥éé˜»å¡ï¼

{% note info %}
**æç¤º**

åœ¨å®é™…çš„åº”ç”¨ç¯å¢ƒä¸­ï¼Œå¾€å¾€æœ‰å¾ˆå¤š I/O æ“ä½œï¼ˆä¾‹å¦‚ç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“æŸ¥è¯¢ç­‰ç­‰ï¼‰éœ€è¦è€—è´¹ç›¸å½“å¤šçš„æ—¶é—´ï¼Œè€Œ Node.js èƒ½å¤Ÿåœ¨ç­‰å¾…çš„åŒæ—¶ç»§ç»­å¤„ç†æ–°çš„è¯·æ±‚ï¼Œå¤§å¤§æé«˜äº†ç³»ç»Ÿçš„ååç‡ã€‚
{% endnote %}

åœ¨åç»­æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šå‡ºä¸€ç¯‡æ·±å…¥è®²è§£ Node.js å¼‚æ­¥ç¼–ç¨‹çš„æ•™ç¨‹ï¼Œæ•¬è¯·æœŸå¾…ï¼

## ç†è§£ Node æ¨¡å—æœºåˆ¶

Node.js ç›¸æ¯”ä¹‹å‰çš„æµè§ˆå™¨ JavaScript çš„å¦ä¸€ä¸ªé‡ç‚¹æ”¹å˜å°±æ˜¯ï¼šæ¨¡å—æœºåˆ¶çš„å¼•å…¥ã€‚è¿™ä¸€èŠ‚å†…å®¹å¾ˆé•¿ï¼Œä½†å´æ˜¯å…¥é—¨ Node.js æœ€ä¸ºå…³é”®çš„ä¸€æ­¥ï¼ŒåŠ æ²¹å§ğŸ’ªï¼

### JavaScript çš„æ¨¡å—åŒ–ä¹‹è·¯

Eric Raymond åœ¨ã€ŠUNIXç¼–ç¨‹è‰ºæœ¯ã€‹ä¸­å®šä¹‰äº†**æ¨¡å—æ€§**ï¼ˆModularityï¼‰çš„è§„åˆ™ï¼š

> å¼€å‘äººå‘˜åº”ä½¿ç”¨é€šè¿‡å®šä¹‰æ˜ç¡®çš„æ¥å£è¿æ¥çš„ç®€å•é›¶ä»¶æ¥æ„å»ºç¨‹åºï¼Œå› æ­¤é—®é¢˜æ˜¯å±€éƒ¨çš„ï¼Œå¯ä»¥åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­æ›¿æ¢ç¨‹åºçš„æŸäº›éƒ¨åˆ†ä»¥æ”¯æŒæ–°åŠŸèƒ½ã€‚ è¯¥è§„åˆ™æ—¨åœ¨èŠ‚çœè°ƒè¯•å¤æ‚ã€å†—é•¿ä¸”ä¸å¯è¯»çš„å¤æ‚ä»£ç çš„æ—¶é—´ã€‚

â€œåˆ†è€Œæ²»ä¹‹â€çš„æ€æƒ³åœ¨è®¡ç®—æœºçš„ä¸–ç•Œéå¸¸æ™®éï¼Œä½†æ˜¯åœ¨ ES2015 æ ‡å‡†å‡ºç°ä»¥å‰ï¼ˆ*ä¸äº†è§£æ²¡å…³ç³»ï¼Œåé¢ä¼šè®²åˆ°*ï¼‰ï¼Œ JavaScript è¯­è¨€å®šä¹‰æœ¬èº«å¹¶æ²¡æœ‰æ¨¡å—åŒ–çš„æœºåˆ¶ï¼Œæ„å»ºå¤æ‚åº”ç”¨ä¹Ÿæ²¡æœ‰ç»Ÿä¸€çš„æ¥å£æ ‡å‡†ã€‚äººä»¬é€šå¸¸ä½¿ç”¨ä¸€ç³»åˆ—çš„ `<script>` æ ‡ç­¾æ¥å¯¼å…¥ç›¸åº”çš„æ¨¡å—ï¼ˆä¾èµ–ï¼‰ï¼š

```html
<head>
  <script src="fileA.js"></script>
  <script src="fileB.js"></script>
</head>
```

è¿™ç§ç»„ç»‡ JS ä»£ç çš„æ–¹å¼æœ‰å¾ˆå¤šé—®é¢˜ï¼Œå…¶ä¸­æœ€æ˜¾è‘—çš„åŒ…æ‹¬ï¼š

- å¯¼å…¥çš„å¤šä¸ª JS æ–‡ä»¶ç›´æ¥ä½œç”¨äºå…¨å±€å‘½åç©ºé—´ï¼Œå¾ˆå®¹æ˜“äº§ç”Ÿ**å‘½åå†²çª**
- å¯¼å…¥çš„ JS æ–‡ä»¶ä¹‹é—´ä¸èƒ½ç›¸äº’è®¿é—®ï¼Œä¾‹å¦‚ fileB.js ä¸­æ— æ³•è®¿é—® fileA.js ä¸­çš„å†…å®¹ï¼Œå¾ˆä¸æ–¹ä¾¿
- å¯¼å…¥çš„ `<script>` æ— æ³•è¢«è½»æ˜“å»é™¤æˆ–ä¿®æ”¹

äººä»¬æ¸æ¸è®¤è¯†åˆ°äº† JavaScript æ¨¡å—åŒ–æœºåˆ¶çš„ç¼ºå¤±å¸¦æ¥çš„é—®é¢˜ï¼Œäºæ˜¯ä¸¤å¤§æ¨¡å—åŒ–è§„èŒƒè¢«æå‡ºï¼š

1. [AMDï¼ˆAsynchronous Module Definitionï¼‰è§„èŒƒ](https://github.com/amdjs/amdjs-api/blob/master/AMD.md)ï¼Œåœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨è¾ƒä¸ºæ™®éï¼Œæœ€ç»å…¸çš„å®ç°åŒ…æ‹¬ [RequireJS](https://requirejs.org/)ï¼›
2. [CommonJS è§„èŒƒ](http://wiki.commonjs.org/wiki/CommonJS)ï¼Œè‡´åŠ›äºä¸º JavaScript ç”Ÿæ€åœˆæä¾›ç»Ÿä¸€çš„æ¥å£ APIï¼ŒNode.js æ‰€å®ç°çš„æ­£æ˜¯è¿™ä¸€æ¨¡å—æ ‡å‡†ã€‚

{% note info %}
**æç¤º**

ECMAScript 2015ï¼ˆä¹Ÿå°±æ˜¯å¤§å®¶å¸¸è¯´çš„ ES6ï¼‰æ ‡å‡†ä¸º JavaScript è¯­è¨€å¼•å…¥äº†å…¨æ–°çš„æ¨¡å—æœºåˆ¶ï¼ˆç§°ä¸º ES æ¨¡å—ï¼Œå…¨ç§° ECMAScript Modulesï¼‰ï¼Œå¹¶æä¾›äº† `import` å’Œ `export` å…³é”®è¯ï¼Œå¦‚æœæ„Ÿå…´è¶£å¯å‚è€ƒ[è¿™ç¯‡æ–‡ç« ](https://zhuanlan.zhihu.com/p/36358695)ã€‚ä½†æ˜¯æˆªæ­¢ç›®å‰ï¼ŒNode.js å¯¹ ES æ¨¡å—çš„æ”¯æŒè¿˜å¤„äº**è¯•éªŒé˜¶æ®µ**ï¼Œå› æ­¤è¿™ç¯‡æ–‡ç« ä¸ä¼šè®²è§£ã€ä¹Ÿä¸æå€¡ä½¿ç”¨ã€‚
{% endnote %}

### ä»€ä¹ˆæ˜¯ Node æ¨¡å—

åœ¨æ­£å¼åˆ†æ Node æ¨¡å—æœºåˆ¶ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®å®šä¹‰ä»€ä¹ˆæ˜¯ Node æ¨¡å—ã€‚é€šå¸¸æ¥è¯´ï¼ŒNode æ¨¡å—å¯åˆ†ä¸ºä¸¤å¤§ç±»ï¼š

- **æ ¸å¿ƒæ¨¡å—**ï¼šNode æä¾›çš„å†…ç½®æ¨¡å—ï¼Œåœ¨å®‰è£… Node æ—¶å·²ç»è¢«ç¼–è¯‘æˆ**äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶**
- **æ–‡ä»¶æ¨¡å—**ï¼šç”¨æˆ·ç¼–å†™çš„æ¨¡å—ï¼Œå¯ä»¥æ˜¯è‡ªå·±å†™çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯é€šè¿‡ npm å®‰è£…çš„ï¼ˆåé¢ä¼šè®²åˆ°ï¼‰ã€‚

å…¶ä¸­ï¼Œæ–‡ä»¶æ¨¡å—å¯ä»¥æ˜¯ä¸€ä¸ª**å•ç‹¬çš„æ–‡ä»¶**ï¼ˆä»¥ `.js`ã€`.node` æˆ– `.json` ç»“å°¾ï¼‰ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ª**ç›®å½•**ã€‚å½“è¿™ä¸ªæ¨¡å—æ˜¯ä¸€ä¸ªç›®å½•æ—¶ï¼Œ**æ¨¡å—åå°±æ˜¯ç›®å½•å**ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š

1. ç›®å½•ä¸­æœ‰ä¸€ä¸ª package.json æ–‡ä»¶ï¼Œåˆ™è¿™ä¸ª Node æ¨¡å—çš„å…¥å£å°±æ˜¯å…¶ä¸­ `main` å­—æ®µæŒ‡å‘çš„æ–‡ä»¶ï¼›
2. ç›®å½•ä¸­æœ‰ä¸€ä¸ªåä¸º index çš„æ–‡ä»¶ï¼Œæ‰©å±•åä¸º `.js`ã€`.node` æˆ– `.json`ï¼Œæ­¤æ–‡ä»¶åˆ™ä¸ºæ¨¡å—å…¥å£æ–‡ä»¶ã€‚

ä¸€ä¸‹å­æ¶ˆåŒ–ä¸äº†æ²¡å…³ç³»ï¼Œå¯ä»¥å…ˆé˜…è¯»åé¢çš„å†…å®¹ï¼Œå¿˜è®°äº†æ¨¡å—çš„å®šä¹‰å¯ä»¥å†å›è¿‡æ¥çœ‹çœ‹å“¦ã€‚

### Node æ¨¡å—æœºåˆ¶æµ…æ

çŸ¥é“äº† Node æ¨¡å—çš„å…·ä½“å®šä¹‰åï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ Node å…·ä½“æ˜¯æ€æ ·å®ç°æ¨¡å—æœºåˆ¶çš„ã€‚å…·ä½“è€Œè¨€ï¼ŒNode å¼•å…¥äº†ä¸‰ä¸ªæ–°çš„å…¨å±€å¯¹è±¡ï¼ˆè¿˜æ˜¯ Node ä¸“å±å“¦ï¼‰ï¼š1ï¼‰`require`ï¼›2ï¼‰ `exports` å’Œ 3ï¼‰`module`ã€‚ä¸‹é¢æˆ‘ä»¬é€ä¸€è®²è§£ã€‚

**`require`**

`require` ç”¨äºå¯¼å…¥å…¶ä»– Node æ¨¡å—ï¼Œå…¶å‚æ•°æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ä»£è¡¨æ¨¡å—çš„åç§°æˆ–è·¯å¾„ï¼Œé€šå¸¸è¢«ç§°ä¸º**æ¨¡å—æ ‡è¯†ç¬¦**ã€‚å…·ä½“æœ‰ä»¥ä¸‹ä¸‰ç§å½¢å¼ï¼š

- ç›´æ¥å†™æ¨¡å—åç§°ï¼Œé€šå¸¸æ˜¯æ ¸å¿ƒæ¨¡å—æˆ–ç¬¬ä¸‰æ–¹æ–‡ä»¶æ¨¡å—ï¼Œä¾‹å¦‚ `os`ã€`express` ç­‰
- æ¨¡å—çš„ç›¸å¯¹è·¯å¾„ï¼ŒæŒ‡å‘é¡¹ç›®ä¸­å…¶ä»– Node æ¨¡å—ï¼Œä¾‹å¦‚ `./utils`
- æ¨¡å—çš„ç»å¯¹è·¯å¾„ï¼ˆ**ä¸æ¨èï¼**ï¼‰ï¼Œä¾‹å¦‚ `/home/xxx/MyProject/utils`

{% note info %}
**æç¤º**

åœ¨é€šè¿‡è·¯å¾„å¯¼å…¥æ¨¡å—æ—¶ï¼Œé€šå¸¸çœç•¥æ–‡ä»¶åä¸­çš„ `.js` åç¼€ã€‚
{% endnote %}

ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```javascript
// å¯¼å…¥å†…ç½®åº“æˆ–ç¬¬ä¸‰æ–¹æ¨¡å—
const os = require('os');
const express = require('express');

// é€šè¿‡ç›¸å¯¹è·¯å¾„å¯¼å…¥å…¶ä»–æ¨¡å—
const utils = require('./utils');

// é€šè¿‡ç»å¯¹è·¯å¾„å¯¼å…¥å…¶ä»–æ¨¡å—
const utils = require('/home/xxx/MyProject/utils');
```

ä½ ä¹Ÿè®¸ä¼šå¥½å¥‡ï¼Œé€šè¿‡åç§°å¯¼å…¥ Node æ¨¡å—çš„æ—¶å€™ï¼ˆä¾‹å¦‚ `express`ï¼‰ï¼Œæ˜¯ä»å“ªé‡Œæ‰¾åˆ°è¿™ä¸ªæ¨¡å—çš„ï¼Ÿå®é™…ä¸Šæ¯ä¸ªæ¨¡å—éƒ½æœ‰ä¸ªè·¯å¾„æœç´¢åˆ—è¡¨ `module.paths`ï¼Œåœ¨åé¢è®²è§£ `module` å¯¹è±¡çš„æ—¶å€™å°±ä¼šä¸€æ¸…äºŒæ¥šäº†ã€‚

**`exports`**

æˆ‘ä»¬å·²ç»å­¦ä¼šäº†ç”¨ `require` å¯¼å…¥å…¶ä»–æ¨¡å—ä¸­çš„å†…å®¹ï¼Œé‚£ä¹ˆæ€ä¹ˆå†™ä¸€ä¸ª Node æ¨¡å—ï¼Œå¹¶å¯¼å‡ºå…¶ä¸­å†…å®¹å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ç”¨ `exports` å¯¹è±¡ã€‚

ä¾‹å¦‚æˆ‘ä»¬å†™ä¸€ä¸ª Node æ¨¡å— myModule.jsï¼š

```javascript
// myModule.js
function add(a, b) {
  return a + b;
}

// å¯¼å‡ºå‡½æ•° add
exports.add = add;
```

é€šè¿‡å°† `add` å‡½æ•°æ·»åŠ åˆ° `exports` å¯¹è±¡ä¸­ï¼Œå¤–é¢çš„æ¨¡å—å°±å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚åœ¨ myModule.js æ—è¾¹åˆ›å»ºä¸€ä¸ª main.jsï¼Œä»£ç å¦‚ä¸‹ï¼š

```javascript
// main.js
const myModule = require('./myModule');

// è°ƒç”¨ myModule.js ä¸­çš„ add å‡½æ•°
myModule.add(1, 2);
```

{% note info %}
**æç¤º**

å¦‚æœä½ ç†Ÿæ‚‰ ECMAScript 6 ä¸­çš„[è§£æ„èµ‹å€¼](http://es6.ruanyifeng.com/#docs/destructuring)ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨æ›´ä¼˜é›…çš„æ–¹å¼è·å– `add` å‡½æ•°ï¼š

```javascript
const { add } = require('./myModule');
```
{% endnote %}

**`module`**

é€šè¿‡ `require` å’Œ `exports`ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†å¦‚ä½•å¯¼å…¥ã€å¯¼å‡º Node æ¨¡å—ä¸­çš„å†…å®¹ï¼Œä½†æ˜¯ä½ å¯èƒ½è¿˜æ˜¯è§‰å¾— Node æ¨¡å—æœºåˆ¶æœ‰ä¸€ä¸ä¸ç¥ç§˜çš„æ„Ÿè§‰ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ€å¼€è¿™ç¥ç§˜çš„é¢çº±ï¼Œäº†è§£ä¸€ä¸‹èƒŒåçš„ä¸»è§’â€”â€”`module` æ¨¡å—å¯¹è±¡ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨åˆšæ‰çš„ myModule.js æ–‡ä»¶çš„æœ€ååŠ ä¸Šè¿™ä¸€è¡Œä»£ç ï¼š

```javascript
console.log('module myModule:', module);
```

åœ¨ main.js æœ€ååŠ ä¸Šï¼š

```javascript
console.log('module main:', module);
```

è¿è¡Œåä¼šæ‰“å°å‡ºæ¥è¿™æ ·çš„å†…å®¹ï¼ˆå·¦è¾¹æ˜¯ myModuleï¼Œå³è¾¹æ˜¯ moduleï¼‰ï¼š

![](https://static.tuture.co/c/892fa12/module.png)

å¯ä»¥çœ‹åˆ° `module` å¯¹è±¡æœ‰ä»¥ä¸‹å­—æ®µï¼š

- `id`ï¼šæ¨¡å—çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¦‚æœæ˜¯è¢«è¿è¡Œçš„ä¸»ç¨‹åºï¼ˆä¾‹å¦‚ main.jsï¼‰åˆ™ä¸º `.`ï¼Œå¦‚æœæ˜¯è¢«å¯¼å…¥çš„æ¨¡å—ï¼ˆä¾‹å¦‚ myModule.jsï¼‰åˆ™ç­‰åŒäºæ­¤æ–‡ä»¶åï¼ˆå³ä¸‹é¢çš„ `filename` å­—æ®µï¼‰
- `path` å’Œ `filename`ï¼šæ¨¡å—æ‰€åœ¨è·¯å¾„å’Œæ–‡ä»¶åï¼Œæ²¡å•¥å¥½è¯´çš„
- `exports`ï¼šæ¨¡å—æ‰€å¯¼å‡ºçš„å†…å®¹ï¼Œå®é™…ä¸Š**ä¹‹å‰çš„ ****`exports`**** å¯¹è±¡æ˜¯æŒ‡å‘ ****`module.exports`**** çš„å¼•ç”¨**ã€‚ä¾‹å¦‚å¯¹äº myModule.jsï¼Œåˆšæ‰æˆ‘ä»¬å¯¼å‡ºäº† `add` å‡½æ•°ï¼Œå› æ­¤å‡ºç°åœ¨äº†è¿™ä¸ª `exports` å­—æ®µé‡Œé¢ï¼›è€Œ main.js æ²¡æœ‰å¯¼å‡ºä»»ä½•å†…å®¹ï¼Œå› æ­¤ `exports` å­—æ®µä¸ºç©º
- `parent` å’Œ `children`ï¼šç”¨äºè®°å½•æ¨¡å—ä¹‹é—´çš„å¯¼å…¥å…³ç³»ï¼Œä¾‹å¦‚ main.js ä¸­ `require` äº† myModule.jsï¼Œé‚£ä¹ˆ main å°±æ˜¯ myModule çš„ `parent`ï¼ŒmyModule å°±æ˜¯ main çš„ `children`
- `loaded`ï¼šæ¨¡å—æ˜¯å¦è¢«åŠ è½½ï¼Œä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºåªæœ‰ `children` ä¸­åˆ—å‡ºçš„æ¨¡å—æ‰ä¼šè¢«åŠ è½½
- `paths`ï¼šè¿™ä¸ªå°±æ˜¯ Node **æœç´¢æ–‡ä»¶æ¨¡å—çš„è·¯å¾„åˆ—è¡¨**ï¼ŒNode ä¼šä»ç¬¬ä¸€ä¸ªè·¯å¾„åˆ°æœ€åä¸€ä¸ªè·¯å¾„ä¾æ¬¡æœç´¢æŒ‡å®šçš„ Node æ¨¡å—ï¼Œæ‰¾åˆ°äº†åˆ™å¯¼å…¥ï¼Œæ‰¾ä¸åˆ°å°±ä¼šæŠ¥é”™

{% note info %}
**æç¤º**

å¦‚æœä½ ä»”ç»†è§‚å¯Ÿï¼Œä¼šå‘ç° Node æ–‡ä»¶æ¨¡å—æŸ¥æ‰¾è·¯å¾„ï¼ˆ`module.paths`ï¼‰çš„æ–¹å¼å…¶å®æ˜¯è¿™æ ·çš„ï¼šå…ˆæ‰¾å½“å‰ç›®å½•ä¸‹çš„ node_modulesï¼Œæ²¡æœ‰çš„è¯å†æ‰¾ä¸Šä¸€çº§ç›®å½•çš„ node_modulesï¼Œè¿˜æ²¡æ‰¾åˆ°çš„è¯å°±ä¸€ç›´å‘ä¸Šæ‰¾ï¼Œç›´åˆ°æ ¹ç›®å½•ä¸‹çš„ node_modulesã€‚
{% endnote %}

**æ·±å…¥ç†è§£ ****`module.exports`**

ä¹‹å‰æˆ‘ä»¬æåˆ°ï¼Œ`exports` å¯¹è±¡æœ¬è´¨ä¸Šæ˜¯ `module.exports` çš„å¼•ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸‹é¢ä¸¤è¡Œä»£ç æ˜¯ç­‰ä»·çš„ï¼š

```javascript
// å¯¼å‡º add å‡½æ•°
exports.add = add;

// å’Œä¸Šé¢ä¸€è¡Œä»£ç æ˜¯ä¸€æ ·çš„
module.exports.add = add;
```

å®é™…ä¸Šè¿˜æœ‰ç¬¬äºŒç§å¯¼å‡ºæ–¹å¼ï¼Œç›´æ¥æŠŠ `add` å‡½æ•°èµ‹ç»™ `module.exports` å¯¹è±¡ï¼š

```javascript
module.exports = add;
```

è¿™æ ·å†™å’Œç¬¬ä¸€ç§å¯¼å‡ºæ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿç¬¬ä¸€ç§æ–¹å¼ï¼Œåœ¨ `exports` å¯¹è±¡ä¸Šæ·»åŠ ä¸€ä¸ªå±æ€§åä¸º `add`ï¼Œè¯¥å±æ€§çš„å€¼ä¸º `add` å‡½æ•°ï¼›ç¬¬äºŒç§æ–¹å¼ï¼Œç›´æ¥ä»¤ `exports` å¯¹è±¡ä¸º `add` å‡½æ•°ã€‚å¯èƒ½æœ‰ç‚¹ç»•ï¼Œä½†æ˜¯è¯·ä¸€å®šè¦ç†è§£è¿™ä¸¤è€…çš„é‡å¤§åŒºåˆ«ï¼ä½ ä¹Ÿè®¸çŒœåˆ°äº†ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ `module.exports` å¯¼å‡ºæ—¶ï¼Œå°±æ„å‘³ç€æ•´ä¸ªæ¨¡å—åªèƒ½å¯¼å‡ºä¸€ä¸ªå˜é‡æˆ–å‡½æ•°äº†ã€‚

åœ¨ `require` æ—¶ï¼Œä¸¤è€…çš„åŒºåˆ«å°±å¾ˆæ˜æ˜¾äº†ï¼š

```javascript
// ç¬¬ä¸€ç§å¯¼å‡ºæ–¹å¼ï¼Œéœ€è¦è®¿é—® add å±æ€§è·å–åˆ° add å‡½æ•°
const myModule = require('./myModule');
myModule.add(1, 2);

// ç¬¬äºŒç§å¯¼å‡ºæ–¹å¼ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ add å‡½æ•°
const add = require('./myModule');
add(1, 2);
```

{% note warning %}
**æ³¨æ„**

ç›´æ¥å†™ `exports = add;` æ— æ³•å¯¼å‡º `add` å‡½æ•°ï¼Œå› ä¸º `exports` æœ¬è´¨ä¸Šæ˜¯æŒ‡å‘ `module` çš„ `exports` å±æ€§çš„å¼•ç”¨ï¼Œç›´æ¥å¯¹ `exports` èµ‹å€¼åªä¼šæ”¹å˜ `exports`ï¼Œå¯¹ `module.exports` æ²¡æœ‰å½±å“ã€‚å¦‚æœä½ è§‰å¾—éš¾ä»¥ç†è§£ï¼Œé‚£æˆ‘ä»¬ç”¨ `apple` å’Œ `price` ç±»æ¯” `module` å’Œ `exports`ï¼š

```javascript
apple = { price: 1 };   // æƒ³è±¡ apple å°±æ˜¯ module
price = apple.price;    // æƒ³è±¡ price å°±æ˜¯ exports
apple.price = 3;        // æ”¹å˜äº† apple.price
price = 3;              // åªæ”¹å˜äº† priceï¼Œæ²¡æœ‰æ”¹å˜ apple.price
```

æˆ‘ä»¬åªèƒ½é€šè¿‡ `apple.price = 1` è®¾ç½® `price` å±æ€§ï¼Œè€Œç›´æ¥å¯¹ `price` èµ‹å€¼å¹¶ä¸èƒ½ä¿®æ”¹ `apple.price`ã€‚
{% endnote %}

### é‡æ„ timer è„šæœ¬

åœ¨èŠäº†è¿™ä¹ˆå¤šå…³äº Node æ¨¡å—æœºåˆ¶çš„å†…å®¹åï¼Œæ˜¯æ—¶å€™å›åˆ°æˆ‘ä»¬ä¹‹å‰çš„å®šæ—¶å™¨è„šæœ¬ timer.js äº†ã€‚æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„ Node æ¨¡å— info.jsï¼Œç”¨äºæ‰“å°ç³»ç»Ÿä¿¡æ¯ï¼Œä»£ç å¦‚ä¸‹ï¼š

```js info.js https://github.com/mRcfps/nodejs-quickstart/blob/98a736d/info.js æŸ¥çœ‹å®Œæ•´ä»£ç 
const os = require('os');

function printProgramInfo() {
  console.log('å½“å‰ç”¨æˆ·', os.userInfo().username);
  console.log('å½“å‰è¿›ç¨‹ ID', process.pid);
  console.log('å½“å‰è„šæœ¬è·¯å¾„', __filename);
}

module.exports = printProgramInfo;
```

è¿™é‡Œæˆ‘ä»¬å¯¼å…¥äº† Node å†…ç½®æ¨¡å— `os`ï¼Œå¹¶é€šè¿‡ `os.userInfo()` æŸ¥è¯¢åˆ°äº†ç³»ç»Ÿç”¨æˆ·åï¼Œæ¥ç€é€šè¿‡ `module.exports` å¯¼å‡ºäº† `printProgramInfo` å‡½æ•°ã€‚

ç„¶ååˆ›å»ºç¬¬äºŒä¸ª Node æ¨¡å— datetime.jsï¼Œç”¨äºè¿”å›å½“å‰çš„æ—¶é—´ï¼Œä»£ç å¦‚ä¸‹ï¼š

```js datetime.js https://github.com/mRcfps/nodejs-quickstart/blob/98a736d/datetime.js æŸ¥çœ‹å®Œæ•´ä»£ç 
function getCurrentTime() {
  const time = new Date();
  return time.toLocaleString();
}

exports.getCurrentTime = getCurrentTime;
```

ä¸Šé¢çš„æ¨¡å—ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©äº†é€šè¿‡ `exports` å¯¼å‡º `getCurrentTime` å‡½æ•°ã€‚

æœ€åï¼Œæˆ‘ä»¬åœ¨ timer.js ä¸­é€šè¿‡ `require` å¯¼å…¥åˆšæ‰ä¸¤ä¸ªæ¨¡å—ï¼Œå¹¶åˆ†åˆ«è°ƒç”¨æ¨¡å—ä¸­çš„å‡½æ•° `printProgramInfo` å’Œ `getCurrentTime`ï¼Œä»£ç å¦‚ä¸‹ï¼š

```js timer.js https://github.com/mRcfps/nodejs-quickstart/blob/98a736d/timer.js æŸ¥çœ‹å®Œæ•´ä»£ç 
[tuture-add]const printProgramInfo = require('./info');
[tuture-add]const datetime = require('./datetime');
[tuture-add] 
setTimeout(() => {
  console.log('Hello World!');
}, 3000);

[tuture-del]console.log('å½“å‰è¿›ç¨‹ ID', process.pid);
[tuture-del]console.log('å½“å‰è„šæœ¬è·¯å¾„', __filename);
[tuture-del] 
[tuture-del]const time = new Date();
[tuture-del]console.log('å½“å‰æ—¶é—´', time.toLocaleString());
[tuture-add]printProgramInfo();
[tuture-add]console.log('å½“å‰æ—¶é—´', datetime.getCurrentTime());
```

å†è¿è¡Œä¸€ä¸‹ timer.jsï¼Œè¾“å‡ºå†…å®¹åº”è¯¥ä¸ä¹‹å‰å®Œå…¨ä¸€è‡´ã€‚

è¯»åˆ°è¿™é‡Œï¼Œæˆ‘æƒ³å…ˆæ­å–œä½ æ¸¡è¿‡äº† Node.js å…¥é—¨æœ€éš¾çš„ä¸€å…³ï¼å¦‚æœä½ å·²ç»çœŸæ­£åœ°ç†è§£äº† Node æ¨¡å—æœºåˆ¶ï¼Œé‚£ä¹ˆæˆ‘ç›¸ä¿¡æ¥ä¸‹æ¥çš„å­¦ä¹ ä¼šæ— æ¯”è½»æ¾å“¦ã€‚

## å‘½ä»¤è¡Œå¼€å‘ï¼šæ¥å—è¾“å…¥å‚æ•°

Node.js ä½œä¸ºå¯ä»¥åœ¨æ“ä½œç³»ç»Ÿä¸­ç›´æ¥è¿è¡Œ JavaScript ä»£ç çš„å¹³å°ï¼Œä¸ºå‰ç«¯å¼€å‘è€…å¼€å¯äº†æ— é™å¯èƒ½ï¼Œå…¶ä¸­å°±åŒ…æ‹¬ä¸€ç³»åˆ—ç”¨äºå®ç°å‰ç«¯è‡ªåŠ¨åŒ–å·¥ä½œæµçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä¾‹å¦‚ [Grunt](http://gruntjs.com/)ã€[Gulp](https://gulpjs.com/) è¿˜æœ‰å¤§åé¼é¼çš„ [Webpack](https://webpack.js.org/)ã€‚

ä»è¿™ä¸€æ­¥å¼€å§‹ï¼Œæˆ‘ä»¬å°†æŠŠ timer.js æ”¹é€ æˆä¸€ä¸ªå‘½ä»¤è¡Œåº”ç”¨ã€‚å…·ä½“åœ°ï¼Œæˆ‘ä»¬å¸Œæœ› timer.js å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šç­‰å¾…çš„æ—¶é—´ï¼ˆ`time` é€‰é¡¹ï¼‰å’Œæœ€ç»ˆè¾“å‡ºçš„ä¿¡æ¯ï¼ˆ`message` é€‰é¡¹ï¼‰ï¼š

```bash
$ node timer.js --time 5 --message "Hello Tuture"
```

### é€šè¿‡ `process.argv` è¯»å–å‘½ä»¤è¡Œå‚æ•°

ä¹‹å‰åœ¨è®²å…¨å±€å¯¹è±¡ `process` æ—¶æåˆ°ä¸€ä¸ª `argv` å±æ€§ï¼Œèƒ½å¤Ÿè·å–å‘½ä»¤è¡Œå‚æ•°çš„æ•°ç»„ã€‚åˆ›å»ºä¸€ä¸ª args.js æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š

```javascript
console.log(process.argv);
```

ç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
$ node args.js --time 5 --message "Hello Tuture"
```

è¾“å‡ºä¸€ä¸ªæ•°ç»„ï¼š

```
[
  '/Users/mRc/.nvm/versions/node/v12.10.0/bin/node',
  '/Users/mRc/Tutorials/nodejs-quickstart/args.js',
  '--time',
  '5',
  '--message',
  'Hello Tuture'
]
```

å¯ä»¥çœ‹åˆ°ï¼Œ`process.argv` æ•°ç»„çš„ç¬¬ 0 ä¸ªå…ƒç´ æ˜¯ `node` çš„å®é™…è·¯å¾„ï¼Œç¬¬ 1 ä¸ªå…ƒç´ æ˜¯ args.js çš„è·¯å¾„ï¼Œåé¢åˆ™æ˜¯è¾“å…¥çš„æ‰€æœ‰å‚æ•°ã€‚

### å®ç°å‘½ä»¤è¡Œåº”ç”¨

æ ¹æ®åˆšæ‰çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸ç®€å•ç²—æš´åœ°è·å– `process.argv` çš„ç¬¬ 3 ä¸ªå’Œç¬¬ 5 ä¸ªå…ƒç´ ï¼Œåˆ†åˆ«å¯ä»¥å¾—åˆ° `time` å’Œ `message` å‚æ•°ã€‚äºæ˜¯ä¿®æ”¹ timer.js çš„ä»£ç å¦‚ä¸‹ï¼š

```js timer.js https://github.com/mRcfps/nodejs-quickstart/blob/0658c65/timer.js æŸ¥çœ‹å®Œæ•´ä»£ç 
const printProgramInfo = require('./info');
const datetime = require('./datetime');

[tuture-add]const waitTime = Number(process.argv[3]);
[tuture-add]const message = process.argv[5];
[tuture-add] 
setTimeout(() => {
[tuture-del]  console.log('Hello World!');
[tuture-del]}, 3000);
[tuture-add]  console.log(message);
[tuture-add]}, waitTime * 1000);

printProgramInfo();
console.log('å½“å‰æ—¶é—´', datetime.getCurrentTime());
```

æé†’ä¸€ä¸‹ï¼Œ`setTimeout` ä¸­æ—¶é—´çš„å•ä½æ˜¯æ¯«ç§’ï¼Œè€Œæˆ‘ä»¬æŒ‡å®šçš„æ—¶é—´å‚æ•°å•ä½æ˜¯ç§’ï¼Œå› æ­¤è¦ä¹˜ 1000ã€‚

è¿è¡Œ timer.jsï¼ŒåŠ ä¸Šåˆšæ‰è¯´çš„æ‰€æœ‰å‚æ•°ï¼š

```bash
$ node timer.js --time 5 --message "Hello Tuture"
```

ç­‰å¾… 5 ç§’é’Ÿåï¼Œä½ å°±çœ‹åˆ°äº† Hello Tuture çš„æç¤ºæ–‡æœ¬ï¼

ä¸è¿‡å¾ˆæ˜¾ç„¶ï¼Œç›®å‰è¿™ä¸ªç‰ˆæœ¬æœ‰å¾ˆå¤§çš„é—®é¢˜ï¼šè¾“å…¥å‚æ•°çš„æ ¼å¼æ˜¯å›ºå®šçš„ï¼Œå¾ˆä¸çµæ´»ï¼Œæ¯”å¦‚è¯´è°ƒæ¢ `time` å’Œ `message` çš„è¾“å…¥é¡ºåºå°±ä¼šå‡ºé”™ï¼Œä¹Ÿä¸èƒ½æ£€æŸ¥ç”¨æˆ·æ˜¯å¦è¾“å…¥äº†æŒ‡å®šçš„å‚æ•°ï¼Œæ ¼å¼æ˜¯å¦æ­£ç¡®ç­‰ç­‰ã€‚å¦‚æœè¦äº²è‡ªå®ç°ä¸Šé¢æ‰€è¯´çš„åŠŸèƒ½ï¼Œé‚£å¯å¾—èŠ±å¾ˆå¤§çš„åŠ›æ°”ï¼Œè¯´ä¸å®šè¿˜ä¼šæœ‰ä¸å°‘ Bugã€‚æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ¡ˆå‘¢ï¼Ÿ

## npmï¼šæ´ªè’ä¹‹åŠ›ï¼Œéƒ½èµäºˆä½ 

ä»è¿™ä¸€èŠ‚å¼€å§‹ï¼Œä½ å°†ä¸å†æ˜¯ä¸€ä¸ªäººå†™ä»£ç ã€‚ä½ çš„èƒŒåå°†æ‹¥æœ‰ç™¾ä¸‡å JavaScript å¼€å‘è€…çš„æ”¯æŒï¼Œè€Œè¿™ä¸€åˆ‡ä»…éœ€è¦ npm å°±å¯ä»¥å®ç°ã€‚npm åŒ…æ‹¬ï¼š

- npm å‘½ä»¤è¡Œå·¥å…·ï¼ˆå®‰è£… node æ—¶ä¹Ÿä¼šé™„å¸¦å®‰è£…ï¼‰
- npm é›†ä¸­å¼ä¾èµ–ä»“åº“ï¼ˆregistryï¼‰ï¼Œå­˜æ”¾äº†å…¶ä»– JavaScript å¼€å‘è€…åˆ†äº«çš„ npm åŒ…
- npm [ç½‘ç«™](https://npmjs.com)ï¼Œå¯ä»¥æœç´¢éœ€è¦çš„ npm åŒ…ã€ç®¡ç† npm å¸æˆ·ç­‰

### npm åˆæ¢

æˆ‘ä»¬é¦–å…ˆæ‰“å¼€ç»ˆç«¯ï¼ˆå‘½ä»¤è¡Œï¼‰ï¼Œæ£€æŸ¥ä¸€ä¸‹ `npm` å‘½ä»¤æ˜¯å¦å¯ç”¨ï¼š

```bash
$ npm -v
6.10.3
```

ç„¶ååœ¨å½“å‰ç›®å½•ï¼ˆä¹Ÿå°±æ˜¯åˆšæ‰ç¼–è¾‘çš„ timer.js æ‰€åœ¨çš„æ–‡ä»¶å¤¹ï¼‰è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŠŠå½“å‰é¡¹ç›®åˆå§‹åŒ–ä¸º npm é¡¹ç›®:

```bash
$ npm init
```

è¿™æ—¶å€™ npm ä¼šæä¸€ç³»åˆ—é—®é¢˜ï¼Œä½ å¯ä»¥ä¸€è·¯å›è½¦ä¸‹å»ï¼Œä¹Ÿå¯ä»¥ä»”ç»†å›ç­”ï¼Œæœ€ç»ˆä¼šåˆ›å»ºä¸€ä¸ª package.json æ–‡ä»¶ã€‚package.json æ–‡ä»¶æ˜¯ä¸€ä¸ª npm é¡¹ç›®çš„æ ¸å¿ƒï¼Œè®°å½•äº†è¿™ä¸ªé¡¹ç›®æ‰€æœ‰çš„å…³é”®ä¿¡æ¯ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```json
{
  "name": "timer",
  "version": "1.0.0",
  "description": "A cool timer",
  "main": "timer.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/mRcfps/nodejs-quickstart.git"
  },
  "author": "mRcfps",
  "license": "ISC",
  "bugs": {
    "url": "https://github.com/mRcfps/nodejs-quickstart/issues"
  },
  "homepage": "https://github.com/mRcfps/nodejs-quickstart#readme"
}
```

å…¶ä¸­å¤§éƒ¨åˆ†å­—æ®µçš„å«ä¹‰éƒ½å¾ˆæ˜ç¡®ï¼Œä¾‹å¦‚ `name` é¡¹ç›®åç§°ã€ `version` ç‰ˆæœ¬å·ã€`description` æè¿°ã€`author` ä½œè€…ç­‰ç­‰ã€‚ä¸è¿‡è¿™ä¸ª `scripts` å­—æ®µä½ å¯èƒ½ä¼šæ¯”è¾ƒå›°æƒ‘ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€èŠ‚ä¸­è¯¦ç»†ä»‹ç»ã€‚

### å®‰è£… npm åŒ…

æ¥ä¸‹æ¥æˆ‘ä»¬å°†è®²è§£ npm æœ€æœ€æœ€å¸¸ç”¨çš„å‘½ä»¤â€”â€” `install`ã€‚æ²¡é”™ï¼Œæ¯«ä¸å¤¸å¼ åœ°è¯´ï¼Œä¸€ä¸ª JavaScript ç¨‹åºå‘˜ç”¨çš„æœ€å¤šçš„ npm å‘½ä»¤å°±æ˜¯ `npm install`ã€‚

åœ¨å®‰è£…æˆ‘ä»¬éœ€è¦çš„ npm åŒ…ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å»æ¢ç´¢ä¸€ä¸‹æœ‰å“ªäº›åŒ…å¯ä»¥ä¸ºæˆ‘ä»¬æ‰€ç”¨ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ [npm å®˜æ–¹ç½‘ç«™](https://npmjs.com) ä¸Šè¿›è¡Œå…³é”®è¯æœç´¢ï¼ˆè®°å¾—ç”¨è‹±æ–‡å“¦ï¼‰ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬æœ command lineï¼š

![](https://static.tuture.co/c/892fa12/search-npm.png)

å‡ºæ¥çš„ç¬¬ä¸€ä¸ªç»“æœ commander å°±å¾ˆç¬¦åˆæˆ‘ä»¬çš„éœ€è¦ï¼Œç‚¹è¿›å»å°±æ˜¯å®‰è£…çš„è¯´æ˜å’Œ[ä½¿ç”¨æ–‡æ¡£](https://github.com/tj/commander.js/blob/HEAD/Readme_zh-CN.md)ã€‚æˆ‘ä»¬è¿˜æƒ³è¦ä¸€ä¸ªâ€œåŠ è½½ä¸­â€çš„åŠ¨ç”»æ•ˆæœï¼Œæé«˜ç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒï¼Œè¯•ç€æœä¸€ä¸‹ loading å…³é”®è¯ï¼š

![](https://static.tuture.co/c/892fa12/search-npm2.png)

ç¬¬äºŒä¸ªç»“æœ ora ä¹Ÿç¬¦åˆæˆ‘ä»¬çš„éœ€è¦ã€‚é‚£æˆ‘ä»¬ç°åœ¨å°±å®‰è£…è¿™ä¸¤ä¸ª npm åŒ…ï¼š

```bash
$ npm install commander ora
```

å°‘è®¸ç­‰å¾…åï¼Œå¯ä»¥çœ‹åˆ° package.json å¤šäº†ä¸€ä¸ªéå¸¸é‡è¦çš„ `dependencies` å­—æ®µï¼š

```json
"dependencies": {
  "commander": "^4.0.1",
  "ora": "^4.0.3"
}
```

è¿™ä¸ªå­—æ®µä¸­å°±è®°å½•äº†æˆ‘ä»¬è¿™ä¸ªé¡¹ç›®çš„**ç›´æ¥ä¾èµ–**ã€‚ä¸**ç›´æ¥ä¾èµ–**ç›¸å¯¹çš„å°±æ˜¯**é—´æ¥ä¾èµ–**ï¼Œä¾‹å¦‚ commander å’Œ ora çš„ä¾èµ–ï¼Œæˆ‘ä»¬é€šå¸¸ä¸ç”¨å…³å¿ƒã€‚æ‰€æœ‰çš„ npm åŒ…ï¼ˆç›´æ¥ä¾èµ–å’Œé—´æ¥ä¾èµ–ï¼‰å…¨éƒ¨éƒ½å­˜æ”¾åœ¨é¡¹ç›®çš„ node_modules ç›®å½•ä¸­ã€‚

{% note info %}
**æç¤º**

node_modules é€šå¸¸æœ‰å¾ˆå¤šçš„æ–‡ä»¶ï¼Œå› æ­¤ä¸ä¼šåŠ å…¥åˆ° Git ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ï¼Œä½ ä»ç½‘ä¸Šä¸‹è½½çš„ npm é¡¹ç›®ä¸€èˆ¬ä¹Ÿåªä¼šæœ‰ package.jsonï¼Œè¿™æ—¶å€™åªéœ€è¿è¡Œ `npm install`ï¼ˆåé¢ä¸è·Ÿä»»ä½•å†…å®¹ï¼‰ï¼Œå°±å¯ä»¥ä¸‹è½½å¹¶å®‰è£…æ‰€æœ‰ä¾èµ–äº†ã€‚
{% endnote %}

æ•´ä¸ª package.json ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```json package.json https://github.com/mRcfps/nodejs-quickstart/blob/f2a1b0c/package.json æŸ¥çœ‹å®Œæ•´ä»£ç 
{
  "name": "timer",
  "version": "1.0.0",
  "description": "A cool timer",
  "main": "timer.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/mRcfps/nodejs-quickstart.git"
  },
  "author": "mRcfps",
  "license": "ISC",
  "bugs": {
    "url": "https://github.com/mRcfps/nodejs-quickstart/issues"
  },
  "homepage": "https://github.com/mRcfps/nodejs-quickstart#readme",
  "dependencies": {
    "commander": "^4.0.1",
    "ora": "^4.0.3"
  }
}
```

### å…³äºç‰ˆæœ¬å·

åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œç‰ˆæœ¬å·æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œä¸åŒç‰ˆæœ¬çš„è½¯ä»¶å­˜åœ¨æˆ–å¤§æˆ–å°çš„å·®å¼‚ã€‚npm é‡‡ç”¨äº†è¯­ä¹‰ç‰ˆæœ¬å·ï¼ˆSemantic Versioningï¼Œç®€ç§° [semver](https://semver.org/lang/zh-CN/)ï¼‰ï¼Œå…·ä½“è§„å®šå¦‚ä¸‹ï¼š

- ç‰ˆæœ¬æ ¼å¼ä¸ºï¼šä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·
- ä¸»ç‰ˆæœ¬å·çš„æ”¹å˜æ„å‘³ç€**ä¸å…¼å®¹çš„ API ä¿®æ”¹**
- æ¬¡ç‰ˆæœ¬å·çš„æ”¹å˜æ„å‘³ç€åšäº†**å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢**
- ä¿®è®¢å·çš„æ”¹å˜æ„å‘³ç€åšäº†**å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£**

{% note info %}
**æç¤º**

**å‘ä¸‹å…¼å®¹**çš„ç®€å•ç†è§£å°±æ˜¯**åŠŸèƒ½åªå¢ä¸å‡**ã€‚
{% endnote %}

å› æ­¤åœ¨ package.json çš„ `dependencies` å­—æ®µä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æŒ‡å®šç‰ˆæœ¬ï¼š

- **ç²¾ç¡®ç‰ˆæœ¬**ï¼šä¾‹å¦‚ `1.0.0`ï¼Œä¸€å®šåªä¼šå®‰è£…ç‰ˆæœ¬ä¸º `1.0.0` çš„ä¾èµ–
- **é”å®šä¸»ç‰ˆæœ¬å’Œæ¬¡ç‰ˆæœ¬**ï¼šå¯ä»¥å†™æˆ `1.0`ã€`1.0.x` æˆ– `~1.0.0`ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå®‰è£…ä¾‹å¦‚ `1.0.8` çš„ä¾èµ–
- **ä»…é”å®šä¸»ç‰ˆæœ¬**ï¼šå¯ä»¥å†™æˆ `1`ã€`1.x` æˆ– `^1.0.0`ï¼ˆ `npm install` é»˜è®¤é‡‡ç”¨çš„å½¢å¼ï¼‰ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå®‰è£…ä¾‹å¦‚ `1.1.0` çš„ä¾èµ–
- **æœ€æ–°ç‰ˆæœ¬**ï¼šå¯ä»¥å†™æˆ `*` æˆ– `x`ï¼Œé‚£ä¹ˆç›´æ¥å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼ˆä¸æ¨èï¼‰

ä½ ä¹Ÿè®¸æ³¨æ„åˆ°äº† npm è¿˜åˆ›å»ºäº†ä¸€ä¸ª package-lock.jsonï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯ç”¨æ¥**é”å®šå…¨éƒ¨ç›´æ¥ä¾èµ–å’Œé—´æ¥ä¾èµ–çš„ç²¾ç¡®ç‰ˆæœ¬å·**ï¼Œæˆ–è€…è¯´æä¾›äº†å…³äº node_modules ç›®å½•çš„ç²¾ç¡®æè¿°ï¼Œä»è€Œç¡®ä¿åœ¨è¿™ä¸ªé¡¹ç›®ä¸­å¼€å‘çš„æ‰€æœ‰äººéƒ½èƒ½æœ‰å®Œå…¨ä¸€è‡´çš„ npm ä¾èµ–ã€‚

### ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Š

æˆ‘ä»¬åœ¨å¤§è‡´è¯»äº†ä¸€ä¸‹ commander å’Œ ora çš„æ–‡æ¡£ä¹‹åï¼Œå°±å¯ä»¥å¼€å§‹ç”¨èµ·æ¥äº†ï¼Œä¿®æ”¹ timer.js ä»£ç å¦‚ä¸‹ï¼š

```js timer.js https://github.com/mRcfps/nodejs-quickstart/blob/f2a1b0c/timer.js æŸ¥çœ‹å®Œæ•´ä»£ç 
[tuture-add]const program = require('commander');
[tuture-add]const ora = require('ora');
const printProgramInfo = require('./info');
const datetime = require('./datetime');

[tuture-del]const waitTime = Number(process.argv[3]);
[tuture-del]const message = process.argv[5];
[tuture-add]program
[tuture-add]  .option('-t, --time <number>', 'ç­‰å¾…æ—¶é—´ (ç§’)', 3)
[tuture-add]  .option('-m, --message <string>', 'è¦è¾“å‡ºçš„ä¿¡æ¯', 'Hello World')
[tuture-add]  .parse(process.argv);

setTimeout(() => {
[tuture-del]  console.log(message);
[tuture-del]}, waitTime * 1000);
[tuture-add]  spinner.stop();
[tuture-add]  console.log(program.message);
[tuture-add]}, program.time * 1000);

printProgramInfo();
console.log('å½“å‰æ—¶é—´', datetime.getCurrentTime());
[tuture-add]const spinner = ora('æ­£åœ¨åŠ è½½ä¸­ï¼Œè¯·ç¨å ...').start();
```

è¿™æ¬¡ï¼Œæˆ‘ä»¬å†æ¬¡è¿è¡Œ timer.jsï¼š

```bash
$ node timer.js --message "æ´ªè’ä¹‹åŠ›ï¼" --time 5
```

![](https://static.tuture.co/c/892fa12/power.gif)

è½¬èµ·æ¥äº†ï¼

## å°é²œ npm scripts

åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ç®€å•åœ°ä»‹ç»ä¸€ä¸‹ npm scriptsï¼Œä¹Ÿå°±æ˜¯ npm è„šæœ¬ã€‚ä¹‹å‰åœ¨ package.json ä¸­æåˆ°ï¼Œæœ‰ä¸ªå­—æ®µå« `scripts`ï¼Œè¿™ä¸ªå­—æ®µå°±å®šä¹‰äº†å…¨éƒ¨çš„ npm scriptsã€‚æˆ‘ä»¬å‘ç°åœ¨ç”¨ `npm init` æ—¶åˆ›å»ºçš„ package.json æ–‡ä»¶é»˜è®¤å°±æ·»åŠ äº†ä¸€ä¸ª `test` è„šæœ¬ï¼š

```json
"test": "echo \"Error: no test specified\" && exit 1"
```

é‚£ä¸€ä¸²å‘½ä»¤å°±æ˜¯ test è„šæœ¬å°†è¦æ‰§è¡Œçš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `npm test` å‘½ä»¤æ‰§è¡Œè¯¥è„šæœ¬ï¼š

```bash
$ npm test

> timer@1.0.0 test /Users/mRc/Tutorials/nodejs-quickstart
> echo "Error: no test specified" && exit 1

Error: no test specified
npm ERR! Test failed.  See above for more details.
```

åœ¨åˆæ­¥ä½“éªŒäº† npm scripts ä¹‹åï¼Œæˆ‘ä»¬æœ‰å¿…è¦äº†è§£ä¸€ä¸‹ npm scripts åˆ†ä¸ºä¸¤å¤§ç±»ï¼š

- **é¢„å®šä¹‰è„šæœ¬**ï¼šä¾‹å¦‚ `test`ã€`start`ã€`install`ã€`publish` ç­‰ç­‰ï¼Œç›´æ¥é€šè¿‡ `npm <scriptName>` è¿è¡Œï¼Œä¾‹å¦‚ `npm test`ï¼Œæ‰€æœ‰é¢„å®šä¹‰çš„è„šæœ¬å¯æŸ¥çœ‹[æ–‡æ¡£](https://docs.npmjs.com/misc/scripts#description)
- **è‡ªå®šä¹‰è„šæœ¬**ï¼šé™¤äº†ä»¥ä¸Šè‡ªå¸¦è„šæœ¬çš„å…¶ä»–è„šæœ¬ï¼Œéœ€è¦é€šè¿‡ `npm run <scriptName>` è¿è¡Œï¼Œä¾‹å¦‚ `npm run custom`

ç°åœ¨å°±è®©æˆ‘ä»¬å¼€å§‹ä¸º timer é¡¹ç›®æ·»åŠ ä¸¤ä¸ª npm scriptsï¼Œåˆ†åˆ«æ˜¯ `start` å’Œ `lint`ã€‚ç¬¬ä¸€ä¸ªæ˜¯é¢„å®šä¹‰çš„ï¼Œç”¨äºå¯åŠ¨æˆ‘ä»¬çš„ timer.jsï¼›ç¬¬äºŒä¸ªæ˜¯é™æ€ä»£ç æ£€æŸ¥ï¼Œç”¨äºåœ¨å¼€å‘æ—¶æ£€æŸ¥æˆ‘ä»¬çš„ä»£ç ã€‚é¦–å…ˆå®‰è£… [ESLint](http://eslint.cn/) npm åŒ…ï¼š

```bash
$ npm install eslint --save-dev
$ # æˆ–è€…
$ npm install eslint -D
```

æ³¨æ„åˆ°æˆ‘ä»¬åŠ äº†ä¸€ä¸ª `-D` æˆ– `--save-dev` é€‰é¡¹ï¼Œä»£è¡¨ `eslint` æ˜¯ä¸€ä¸ª**å¼€å‘ä¾èµ–**ï¼Œåœ¨å®é™…é¡¹ç›®å‘å¸ƒæˆ–éƒ¨ç½²æ—¶ä¸éœ€è¦ç”¨åˆ°ã€‚npm ä¼šæŠŠæ‰€æœ‰å¼€å‘ä¾èµ–æ·»åŠ åˆ° `devDependencies` å­—æ®µä¸­ã€‚ç„¶ååˆ†åˆ«æ·»åŠ  `start` å’Œ `lint` è„šæœ¬ï¼Œä»£ç å¦‚ä¸‹ï¼š

```json package.json https://github.com/mRcfps/nodejs-quickstart/blob/56e6c18/package.json æŸ¥çœ‹å®Œæ•´ä»£ç 
{
  "name": "timer",
  "version": "1.0.0",
  "description": "A cool timer",
  "main": "timer.js",
  "scripts": {
[tuture-add]    "lint": "eslint **/*.js",
[tuture-add]    "start": "node timer.js -m 'ä¸Šæ‰‹äº†' -t 3",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/mRcfps/nodejs-quickstart.git"
  },
  "author": "mRcfps",
  "license": "ISC",
  "bugs": {
    "url": "https://github.com/mRcfps/nodejs-quickstart/issues"
  },
  "homepage": "https://github.com/mRcfps/nodejs-quickstart#readme",
  "dependencies": {
    "commander": "^4.0.1",
    "ora": "^4.0.3"
[tuture-add]  },
[tuture-add]  "devDependencies": {
[tuture-add]    "eslint": "^6.7.2"
  }
}
```

ESLint çš„ä½¿ç”¨éœ€è¦ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œåˆ›å»º .eslintrc.js æ–‡ä»¶ï¼ˆæ³¨æ„æœ€å‰é¢æœ‰ä¸€ä¸ªç‚¹ï¼‰ï¼Œä»£ç å¦‚ä¸‹ï¼š

```js .eslintrc.js https://github.com/mRcfps/nodejs-quickstart/blob/56e6c18/.eslintrc.js æŸ¥çœ‹å®Œæ•´ä»£ç 
module.exports = {
    "env": {
        "es6": true,
        "node": true,
    },
    "extends": "eslint:recommended",
};
```

è¿è¡Œ `npm start`ï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸåœ°è¿è¡Œäº†æˆ‘ä»¬çš„ timer.js è„šæœ¬ï¼›è€Œè¿è¡Œ `npm run lint`ï¼Œæ²¡æœ‰è¾“å‡ºä»»ä½•ç»“æœï¼ˆä»£è¡¨é™æ€æ£€æŸ¥é€šè¿‡ï¼‰ã€‚

npm scripts çœ‹ä¸Šå»å¹³æ·¡æ— å¥‡ï¼Œä½†æ˜¯å´èƒ½ä¸ºé¡¹ç›®å¼€å‘æä¾›éå¸¸ä¾¿åˆ©çš„å·¥ä½œæµã€‚ä¾‹å¦‚ï¼Œä¹‹å‰æ„å»ºä¸€ä¸ªé¡¹ç›®éœ€è¦éå¸¸å¤æ‚çš„å‘½ä»¤ï¼Œä½†æ˜¯å¦‚æœä½ å®ç°äº†ä¸€ä¸ª `build` npm è„šæœ¬ï¼Œé‚£ä¹ˆå½“ä½ çš„åŒäº‹æ‹¿åˆ°è¿™ä»½ä»£ç æ—¶ï¼Œåªéœ€ç®€å•åœ°æ‰§è¡Œ `npm run build` å°±å¯ä»¥å¼€å§‹æ„å»ºï¼Œè€Œæ— éœ€å…³å¿ƒèƒŒåçš„æŠ€æœ¯ç»†èŠ‚ã€‚åœ¨åç»­çš„ Node.js æˆ–æ˜¯å‰ç«¯å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬ä¼šåœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨å„ç§ npm scripts æ¥å®šä¹‰æˆ‘ä»¬çš„å·¥ä½œæµï¼Œå¤§å®¶æ…¢æ…¢å°±ä¼šé¢†ä¼šåˆ°å®ƒçš„å¼ºå¤§äº†ã€‚

## ä¸‹æ¬¡å†è§ï¼šç›‘å¬ exit äº‹ä»¶

åœ¨è¿™ç¯‡æ•™ç¨‹çš„æœ€åä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è®©ä½ ç®€å•åœ°æ„Ÿå— Node çš„äº‹ä»¶æœºåˆ¶ã€‚Node çš„äº‹ä»¶æœºåˆ¶æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œè¶³å¤Ÿè®²åŠæœ¬ä¹¦ï¼Œä½†è¿™ç¯‡æ•™ç¨‹å¸Œæœ›èƒ½é€šè¿‡ä¸€ä¸ªéå¸¸ç®€å•çš„å®ä¾‹ï¼Œè®©ä½ å¯¹ Node äº‹ä»¶æœ‰ä¸ªåˆæ­¥çš„äº†è§£ã€‚

{% note info %}
**æç¤º**

å¦‚æœä½ æœ‰è¿‡åœ¨ç½‘é¡µï¼ˆæˆ–å…¶ä»–ç”¨æˆ·ç•Œé¢ï¼‰å¼€å‘ä¸­ç¼–å†™äº‹ä»¶å¤„ç†ï¼ˆä¾‹å¦‚é¼ æ ‡ç‚¹å‡»ï¼‰çš„ç»éªŒï¼Œé‚£ä¹ˆä½ ä¸€å®šä¼šè§‰å¾— Node ä¸­å¤„ç†äº‹ä»¶çš„æ–¹å¼ä¼¼æ›¾ç›¸è¯†è€Œåˆç¬¦åˆç›´è§‰ã€‚
{% endnote %}

æˆ‘ä»¬åœ¨å‰é¢ç®€å•åœ°æäº†ä¸€ä¸‹å›è°ƒå‡½æ•°ã€‚å®é™…ä¸Šï¼Œå›è°ƒå‡½æ•°å’Œäº‹ä»¶æœºåˆ¶å…±åŒç»„æˆäº† Node çš„å¼‚æ­¥ä¸–ç•Œã€‚å…·ä½“è€Œè¨€ï¼ŒNode ä¸­çš„äº‹ä»¶éƒ½æ˜¯é€šè¿‡ `events` æ ¸å¿ƒæ¨¡å—ä¸­çš„ `EventEmitter` è¿™ä¸ªç±»å®ç°çš„ã€‚`EventEmitter` åŒ…æ‹¬ä¸¤ä¸ªæœ€å…³é”®çš„æ–¹æ³•ï¼š

- `on`ï¼šç”¨æ¥ç›‘å¬äº‹ä»¶çš„å‘ç”Ÿ
- `emit`ï¼šç”¨æ¥è§¦å‘æ–°çš„äº‹ä»¶

è¯·çœ‹ä¸‹é¢è¿™ä¸ªä»£ç ç‰‡æ®µï¼š

```javascript
const EventEmitter = require('events').EventEmitter;
const emitter = new EventEmitter();

// ç›‘å¬ connect äº‹ä»¶ï¼Œæ³¨å†Œå›è°ƒå‡½æ•°
emitter.on('connect', function (username) {
  console.log(username + 'å·²è¿æ¥');
});

// è§¦å‘ connect äº‹ä»¶ï¼Œå¹¶ä¸”åŠ ä¸Šä¸€ä¸ªå‚æ•°ï¼ˆå³ä¸Šé¢çš„ usernameï¼‰
emitter.emit('connect', 'ä¸€åªå›¾é›€');
```

è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œå°±ä¼šè¾“å‡ºä»¥ä¸‹å†…å®¹ï¼š

```
ä¸€åªå›¾é›€å·²è¿æ¥
```

å¯ä»¥è¯´ï¼ŒNode ä¸­å¾ˆå¤šå¯¹è±¡éƒ½ç»§æ‰¿è‡ª `EventEmitter`ï¼ŒåŒ…æ‹¬æˆ‘ä»¬ç†Ÿæ‚‰çš„ `process` å…¨å±€å¯¹è±¡ã€‚åœ¨ä¹‹å‰çš„ timer.js è„šæœ¬ä¸­ï¼Œæˆ‘ä»¬ç›‘å¬ `exit` äº‹ä»¶ï¼ˆå³ Node è¿›ç¨‹ç»“æŸï¼‰ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„å›è°ƒå‡½æ•°æ‰“å°â€œä¸‹æ¬¡å†è§â€çš„ä¿¡æ¯ï¼š

```js timer.js https://github.com/mRcfps/nodejs-quickstart/blob/50ab5a4/timer.js æŸ¥çœ‹å®Œæ•´ä»£ç 
const program = require('commander');
const ora = require('ora');
const printProgramInfo = require('./info');
const datetime = require('./datetime');

program
  .option('-t, --time <number>', 'ç­‰å¾…æ—¶é—´ (ç§’)', 3)
  .option('-m, --message <string>', 'è¦è¾“å‡ºçš„ä¿¡æ¯', 'Hello World')
  .parse(process.argv);

setTimeout(() => {
  spinner.stop();
  console.log(program.message);
}, program.time * 1000);

[tuture-add]process.on('exit', () => {
[tuture-add]  console.log('ä¸‹æ¬¡å†è§~');
[tuture-add]});
[tuture-add] 
printProgramInfo();
console.log('å½“å‰æ—¶é—´', datetime.getCurrentTime());
const spinner = ora('æ­£åœ¨åŠ è½½ä¸­ï¼Œè¯·ç¨å ...').start();
```

è¿è¡Œåï¼Œä¼šåœ¨ç¨‹åºé€€å‡ºåæ‰“å°â€œä¸‹æ¬¡å†è§~â€çš„å­—ç¬¦ä¸²ã€‚ä½ å¯èƒ½ä¼šé—®ï¼Œä¸ºå•¥ä¸èƒ½åœ¨ `setTimeout` çš„å›è°ƒå‡½æ•°ä¸­æ·»åŠ ç¨‹åºé€€å‡ºçš„é€»è¾‘å‘¢ï¼Ÿå› ä¸ºé™¤äº†æ­£å¸¸è¿è¡Œç»“æŸï¼ˆä¹Ÿå°±æ˜¯ç­‰å¾…äº†æŒ‡å®šçš„æ—¶é—´ï¼‰ï¼Œæˆ‘ä»¬çš„ç¨‹åºå¾ˆæœ‰å¯èƒ½ä¼šå› ä¸ºå…¶ä»–åŸå› é€€å‡ºï¼ˆä¾‹å¦‚æŠ›å‡ºå¼‚å¸¸ï¼Œæˆ–è€…ç”¨ `process.exit` å¼ºåˆ¶é€€å‡ºï¼‰ï¼Œè¿™æ—¶å€™é€šè¿‡ç›‘å¬ `exit` äº‹ä»¶ï¼Œå°±å¯ä»¥åœ¨ç¡®ä¿æ‰€æœ‰æƒ…å†µä¸‹éƒ½èƒ½æ‰§è¡Œ `exit` äº‹ä»¶çš„å›è°ƒå‡½æ•°ã€‚å¦‚æœä½ è§‰å¾—è¿˜æ˜¯ä¸èƒ½ç†è§£çš„è¯ï¼Œå¯ä»¥çœ‹ä¸‹é¢è¿™å¼ ç¤ºæ„å›¾ï¼š

![](https://static.tuture.co/c/892fa12/exit.png)

{% note info %}
**æç¤º**

`process` å¯¹è±¡è¿˜æ”¯æŒå…¶ä»–å¸¸ç”¨çš„äº‹ä»¶ï¼Œä¾‹å¦‚ `SIGINT`ï¼ˆç”¨æˆ·æŒ‰ Ctrl+C æ—¶è§¦å‘ï¼‰ç­‰ç­‰ï¼Œå¯å‚è€ƒè¿™ç¯‡[æ–‡æ¡£](https://javascript.ruanyifeng.com/nodejs/process.html#toc10)ã€‚
{% endnote %}

è¿™ç¯‡ Node.js å¿«é€Ÿå…¥é—¨æ•™ç¨‹åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½å¤Ÿæˆä¸ºä½ è¿›ä¸€æ­¥æ¢ç´¢ Node.js æˆ–æ˜¯å‰ç«¯å¼€å‘çš„åŸºçŸ³ã€‚exit äº‹ä»¶å·²ç»è§¦å‘ï¼Œé‚£æˆ‘ä»¬ä¹Ÿä¸‹æ¬¡å†è§å•¦~

{% note primary %}
**ä¸»è¦**

æ­¤æ•™ç¨‹å±äº[Node.js åç«¯å·¥ç¨‹å¸ˆå­¦ä¹ è·¯çº¿](https://github.com/tuture-dev/nodejs-roadmap)çš„ä¸€éƒ¨åˆ†ï¼Œç‚¹å‡»å¯æŸ¥çœ‹å…¨éƒ¨å†…å®¹ã€‚
{% endnote %}