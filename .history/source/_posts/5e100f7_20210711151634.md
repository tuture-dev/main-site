---
title: 'Taro å°ç¨‹åºå¼€å‘å¤§å‹å®æˆ˜ï¼ˆå››ï¼‰ï¼šä½¿ç”¨ Hooks ç‰ˆçš„ Redux å®ç°åº”ç”¨çŠ¶æ€ç®¡ç†'
description: 'éšç€çŠ¶æ€å¢å¤šï¼ŒçŠ¶æ€æå‡çš„æ“ä½œä¹Ÿéšç€å¢å¤šï¼Œå¯¼è‡´ä¿å­˜è¿™äº›çŠ¶æ€çš„çˆ¶ç»„ä»¶ä¼šè‡ƒè‚¿ä¸å ªï¼Œè€Œä¸”æ¯æ¬¡çŠ¶æ€çš„æ”¹å˜éœ€è¦å½±å“å¾ˆå¤šä¸­é—´ç»„ä»¶ï¼Œå¸¦æ¥æå¤§çš„æ€§èƒ½å¼€é”€ã€‚åœ¨è¿™ç¯‡é•¿æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ç”¨ Hooks ç‰ˆçš„ Redux æ¥è§£å†³çŠ¶æ€ç®¡ç†çš„éš¾é¢˜ï¼Œè€Œè®© Taro ä¸“æ³¨äºæ¸²æŸ“ç”¨æˆ·ç•Œé¢ã€‚'
tags: ['Taro', 'Redux']
categories: ['å°ç¨‹åº', 'Taro', 'è¿›é˜¶']
date: 2020-01-15T10:16:40.222Z
photos:
  - https://static.powerformer.com/c/34a473b/taro-cover-4.jpg
---

<div class="profileBox">
  <div class="avatarBox">
    <a href="https://github.com/tuture-dev"><img src="/images/avatars/tuture-dev.jpg" alt="" class="avatar"></a>
  </div>
  <div class="rightBox">
    <div class="infoBox">
    <a href="https://github.com/tuture-dev"><p class="nickName">@tuture-dev</p></a>
  </div>
  <div class="codeBox">
    <a href="https://github.com/tuture-dev/ultra-club"><span class="codeText">æŸ¥çœ‹ä»£ç </span></a>
  </div>
  </div>
</div>

## åŒå‰‘åˆç’§ï¼šHooks + Redux

æ¬¢è¿ç»§ç»­é˜…è¯»ã€ŠTaro å°ç¨‹åºå¼€å‘å¤§å‹å®æˆ˜ã€‹ç³»åˆ—ï¼Œå‰æƒ…å›é¡¾ï¼š

- [ç†Ÿæ‚‰çš„ Reactï¼Œç†Ÿæ‚‰çš„ Hooks](https://tuture.co/2019/12/25/34a473b/)ï¼šæˆ‘ä»¬ç”¨ React å’Œ Hooks å®ç°äº†ä¸€ä¸ªéå¸¸ç®€å•çš„æ·»åŠ å¸–å­çš„åŸå‹
- [å¤šé¡µé¢è·³è½¬å’Œ Taro UI ç»„ä»¶åº“](https://tuture.co/2019/12/25/af69225/)ï¼šæˆ‘ä»¬ç”¨ Taro è‡ªå¸¦çš„è·¯ç”±åŠŸèƒ½å®ç°äº†å¤šé¡µé¢è·³è½¬ï¼Œå¹¶ç”¨ Taro UI ç»„ä»¶åº“å‡çº§äº†åº”ç”¨ç•Œé¢
- [å®ç°å¾®ä¿¡å’Œæ”¯ä»˜å®å¤šç«¯ç™»å½•](https://tuture.co/2019/12/25/5e10118/)ï¼šå®ç°äº†å¾®ä¿¡ã€æ”¯ä»˜å®ä»¥åŠæ™®é€šç™»å½•å’Œé€€å‡ºç™»å½•

å¦‚æœä½ è·Ÿç€æ•²åˆ°äº†è¿™é‡Œï¼Œä½ ä¸€å®šä¼šå‘ç°ç°åœ¨çš„çŠ¶æ€ç®¡ç†å’Œæ•°æ®æµè¶Šæ¥è¶Šè‡ƒè‚¿ï¼Œç»„ä»¶çŠ¶æ€çš„æ›´æ–°éå¸¸å¤æ‚ã€‚åœ¨è¿™ä¸€ç¯‡ä¸­ï¼Œæˆ‘ä»¬å°†å¼€å§‹ç”¨ Redux é‡æ„ã€‚

å¦‚æœä½ ä¸ç†Ÿæ‚‰ Reduxï¼Œæ¨èé˜…è¯»æˆ‘ä»¬çš„ã€ŠRedux åŒ…æ•™åŒ…ä¼šã€‹ç³»åˆ—æ•™ç¨‹ï¼š

- [Redux åŒ…æ•™åŒ…ä¼šï¼ˆä¸€ï¼‰ï¼šè§£æ•‘ React çŠ¶æ€å±æœº](https://tuture.co/2019/11/28/1fe175a/)
- [Redux åŒ…æ•™åŒ…ä¼šï¼ˆäºŒï¼‰ï¼šè¶çƒ­æ‰“é“ï¼Œå®Œå…¨é‡æ„](https://tuture.co/2019/11/28/d129c56/)
- [Redux åŒ…æ•™åŒ…ä¼šï¼ˆä¸‰ï¼‰ï¼šå„å¸å…¶èŒï¼Œé‡æ‹¾åˆå¿ƒ](https://tuture.co/2019/11/28/a3b94eb/)

å¦‚æœä½ å¸Œæœ›ç›´æ¥ä»è¿™ä¸€æ­¥å¼€å§‹ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
git clone -b redux-start https://github.com/tuture-dev/ultra-club.git
cd ultra-club
```

{% note info %}
**æç¤º**

è¿™ä¸€ç¯‡çš„å†…å®¹å¾ˆé•¿ï¼Œè¦æ•²çš„ä»£ç å¾ˆå¤šï¼Œå»ºè®®å…ˆæ”¶è—ï¼Œåœ¨æœ‰ç©ºçš„æ—¶å€™æŠ½å‡ºä¸€å¤§å—æ—¶é—´å»å®è·µå“¦ã€‚ç›¸ä¿¡ç»è¿‡è¿™ä¸€ç¯‡çš„æ´—ç¤¼ï¼Œä¸ä»…èƒ½å¯¹ Redux çš„ç†è§£æ›´ä¸Šä¸€å±‚æ¥¼ï¼ŒTaro çš„å¼€å‘åŠŸåŠ›ä¹Ÿèƒ½å¤§å¢ï¼
{% endnote %}

å†™åˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å‘ç°çŠ¶æ€å·²ç»æœ‰ç‚¹å¤šäº†ï¼Œè€Œä¸” `src/pages/mine/mine.jsx` æ–‡ä»¶æ˜¯ä¼—å¤šçŠ¶æ€çš„é¡¶å±‚ç»„ä»¶ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„æ™®é€šç™»å½•æŒ‰é’® `src/components/LoginButton/index.jsx` ç»„ä»¶å’Œæˆ‘ä»¬çš„ `src/components/Footer/index.jsx` ç»„ä»¶ï¼Œæˆ‘ä»¬é€šè¿‡ç‚¹å‡»æ™®é€šç™»å½•æŒ‰é’®æ‰“å¼€ç™»å½•å¼¹çª—çš„çŠ¶æ€ `isOpened` éœ€è¦åœ¨ `LoginButton` é‡Œé¢è¿›è¡Œæ“ä½œï¼Œç„¶åè¿›è€Œå½±å“åˆ° `Footer` ç»„ä»¶å†…çš„ `FloatLayout` å¼¹çª—ç»„ä»¶ï¼Œåƒè¿™ç§æ¶‰åŠåˆ°å¤šä¸ªå­ç»„ä»¶è¿›è¡Œé€šä¿¡ï¼Œæˆ‘ä»¬å°†çŠ¶æ€ä¿å­˜åˆ°å…¬å…±çˆ¶ç»„ä»¶ä¸­çš„æ–¹å¼åœ¨ React ä¸­å«åš â€çŠ¶æ€æå‡â€œã€‚

ä½†æ˜¯éšç€çŠ¶æ€å¢å¤šï¼ŒçŠ¶æ€æå‡çš„çŠ¶æ€ä¹Ÿéšç€å¢å¤šï¼Œå¯¼è‡´ä¿å­˜è¿™äº›çŠ¶æ€çš„çˆ¶ç»„ä»¶ä¼šè‡ƒè‚¿ä¸å ªï¼Œè€Œä¸”æ¯æ¬¡çŠ¶æ€çš„æ”¹å˜éœ€è¦å½±å“å¾ˆå¤šä¸­é—´ç»„ä»¶ï¼Œå¸¦æ¥æå¤§çš„æ€§èƒ½å¼€é”€ï¼Œè¿™ç§çŠ¶æ€ç®¡ç†çš„éš¾é¢˜æˆ‘ä»¬ä¸€èˆ¬äº¤ç»™ä¸“é—¨çš„çŠ¶æ€ç®¡ç†å®¹å™¨ Redux æ¥åšï¼Œè€Œè®© React ä¸“æ³¨äºæ¸²æŸ“ç”¨æˆ·ç•Œé¢ã€‚

Redux ä¸ä»…å¯ä»¥ä¿è¯çŠ¶æ€çš„å¯é¢„æµ‹æ€§ï¼Œè¿˜èƒ½ä¿è¯çŠ¶æ€çš„å˜åŒ–åªå’Œå¯¹åº”çš„ç»„ä»¶ç›¸å…³ï¼Œä¸å½±å“åˆ°æ— å…³çš„ç»„ä»¶ï¼Œå…³äº Redux çš„è¯¦ç»†å‰–æçš„å®æˆ˜æ•™ç¨‹å¯ä»¥å‚è€ƒå›¾é›€ç¤¾åŒºçš„ï¼š[Redux åŒ…æ•™åŒ…ä¼šç³»åˆ—æ–‡ç« ](https://tuture.co/2019/11/28/1fe175a/)ã€‚

åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ç»“åˆ React Hooks å’Œ Redux æ¥é‡æ„æˆ‘ä»¬çŠ¶æ€ç®¡ç†ã€‚

### å®‰è£…ä¾èµ–

é¦–å…ˆæˆ‘ä»¬å…ˆæ¥å®‰è£…ä½¿ç”¨ Redux å¿…è¦çš„ä¾èµ–ï¼š

```Bash
$ yarn add redux @tarojs/redux @tarojs/redux-h5  redux-logger
# æˆ–è€…ä½¿ç”¨ npm
$ npm install --save redux @tarojs/redux @tarojs/redux-h5 redux-logger
```

```json package.json https://github.com/tuture-dev/ultra-club/blob/a3cf715/package.json æŸ¥çœ‹å®Œæ•´ä»£ç 
// ...
  "dependencies": {
    "@tarojs/components": "2.0.0-beta.10",
    "@tarojs/components-qa": "2.0.0-beta.10",
[tuture-add]    "@tarojs/redux": "^2.0.0-beta.12",
[tuture-add]    "@tarojs/redux-h5": "^2.0.0-beta.12",
    "@tarojs/router": "2.0.0-beta.10",
    "@tarojs/taro": "2.0.0-beta.10",
    "@tarojs/taro-alipay": "2.0.0-beta.10",
    // ...
    "nerv-devtools": "^1.5.5",
    "nervjs": "^1.5.5",
    "prop-types": "^15.7.2",
[tuture-add]    "redux": "^4.0.5",
[tuture-add]    "redux-logger": "^3.0.6",
    "taro-ui": "^2.2.4"
  },
  "devDependencies": {
    // ...
```

å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†æˆ‘ä»¬ç†Ÿæ‚‰çš„ `redux` ä¾èµ–ï¼Œä»¥åŠç”¨æ¥æ‰“å° Action çš„ä¸­é—´ä»¶ `redux-logger` å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªé¢å¤–çš„åŒ…ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ Taro ä¸­ï¼ŒRedux åŸç»‘å®šåº“ `react-redux` è¢«æ›¿æ¢æˆäº† `@tarojs/redux` å’Œ `@tarojs/redux-h5`ï¼Œå‰è€…ç”¨åœ¨å°ç¨‹åºä¸­ï¼Œåè€…ç”¨åœ¨ H5 é¡µé¢ä¸­ï¼ŒTaro å¯¹åŸ `react-redux` è¿›è¡Œäº†å°è£…å¹¶æä¾›äº†ä¸ react-redux API å‡ ä¹ä¸€è‡´çš„åŒ…æ¥è®©å¼€å‘äººå‘˜è·å¾—æ›´åŠ è‰¯å¥½çš„å¼€å‘ä½“éªŒã€‚

### åˆ›å»º Redux Store

Redux çš„ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µä¸ºï¼šStoreï¼ŒActionï¼ŒReducersï¼š

- Storeï¼šä¿å­˜ç€å…¨å±€çš„çŠ¶æ€ï¼Œæœ‰ç€ â€æ•°æ®çš„å”¯ä¸€çœŸç›¸æ¥æºä¹‹ç§°â€œã€‚
- Actionï¼šå‘èµ·ä¿®æ”¹ Store ä¸­ä¿å­˜çŠ¶æ€çš„åŠ¨ä½œï¼Œæ˜¯ä¿®æ”¹çŠ¶æ€çš„å”¯ä¸€æ‰‹æ®µã€‚
- Reducersï¼šä¸€ä¸ªä¸ªçš„çº¯å‡½æ•°ï¼Œç”¨äºå“åº” Actionï¼Œå¯¹ Store ä¸­çš„çŠ¶æ€è¿›è¡Œä¿®æ”¹ã€‚

å¥½çš„ï¼Œå¤ä¹ äº†ä¸€ä¸‹ Redux çš„æ¦‚å¿µä¹‹åï¼Œæˆ‘ä»¬é©¬ä¸Šæ¥åˆ›å»º Storeï¼ŒRedux çš„æœ€ä½³å®è·µæ¨èæˆ‘ä»¬åœ¨å°† Store ä¿å­˜åœ¨ `store` æ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬åœ¨ `src` æ–‡ä»¶å¤¹ä¸‹é¢åˆ›å»º `store` æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»º `index.js` æ¥ç¼–å†™æˆ‘ä»¬çš„ Storeï¼š

```js src/store/index.js https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/store/index.js æŸ¥çœ‹å®Œæ•´ä»£ç 
import { createStore, applyMiddleware } from 'redux';
import { createLogger } from 'redux-logger';
import rootReducer from '../reducers';

const middlewares = [createLogger()];

export default function configStore() {
  const store = createStore(rootReducer, applyMiddleware(...middlewares));
  return store;
}
```

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å¯¼å‡ºäº†ä¸€ä¸ª `configureStore` å‡½æ•°ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºå¹¶è¿”å› Storeï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨åˆ°äº† `redux-logger` ä¸­é—´ä»¶ï¼Œç”¨äºåœ¨å‘èµ· Action æ—¶ï¼Œåœ¨æ§åˆ¶å°æ‰“å° Action åŠå…¶å‰å Store ä¸­çš„ä¿å­˜çš„çŠ¶æ€ä¿¡æ¯ã€‚

è¿™é‡Œæˆ‘ä»¬çš„ `createstore` æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š`rootReducer` å’Œ `applyMiddleware(...middlewares)` ã€‚

`rootReducer` æ˜¯å“åº” `action` çš„ `reducer`ï¼Œè¿™é‡Œæˆ‘ä»¬å¯¼å‡ºäº†ä¸€ä¸ª `rootReducer`ï¼Œä»£è¡¨ç»„åˆäº†æ‰€æœ‰çš„ `reducer` ï¼Œæˆ‘ä»¬å°†åœ¨åé¢ "ç»„åˆ User å’Œ Post Reducerâ€œ ä¸­è®²åˆ°å®ƒã€‚

`createStore` å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°æˆ‘ä»¬ä½¿ç”¨äº† `redux` ä¸ºæˆ‘ä»¬æä¾›çš„å·¥å…·å‡½æ•° `applyMiddleware` æ¥åœ¨ Redux ä¸­æ³¨å…¥éœ€è¦ä½¿ç”¨çš„ä¸­é—´ä»¶ï¼Œå› ä¸ºå®ƒæ¥æ”¶çš„å‚æ•°æ˜¯ `(args1, args2, args3, ..., argsn)` çš„å½¢å¼ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ç”¨äº†æ•°ç»„å±•å¼€è¿ç®—ç¬¦ `...` æ¥å±•å¼€ `middlewares` æ•°ç»„ã€‚

### ç¼–å†™ User Reducer

åˆ›å»ºå®Œ Store ä¹‹åï¼Œæˆ‘ä»¬æ¥åœ¨æ¥ç¼–å†™ Reducerã€‚å›åˆ°æˆ‘ä»¬çš„é¡µé¢é€»è¾‘ï¼Œæˆ‘ä»¬åœ¨åº•éƒ¨æœ‰ä¸¤ä¸ª Tab æ ï¼Œä¸€ä¸ªä¸º â€œé¦–é¡µâ€ï¼Œä¸€ä¸ªä¸º â€œæˆ‘çš„â€ï¼Œåœ¨ â€é¦–é¡µâ€œ é‡Œé¢ä¸»è¦æ˜¯å±•ç¤ºä¸€åˆ—æ–‡ç« å’Œå…è®¸æ·»åŠ æ–‡ç« ç­‰ï¼Œåœ¨ â€æˆ‘çš„â€œ é‡Œé¢ä¸»è¦æ˜¯å…è®¸ç”¨æˆ·è¿›è¡Œç™»å½•å¹¶å±•ç¤ºç™»å½•ä¿¡æ¯ï¼Œæ‰€ä»¥æ•´ä½“ä¸Šæˆ‘ä»¬çš„é€»è¾‘æœ‰ä¸¤ç±»ï¼Œæˆ‘ä»¬åˆ†åˆ«å°†å…¶å‘½åä¸º `post` å’Œ `user`ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†åˆ›å»ºå¤„ç†è¿™ä¸¤ç±»é€»è¾‘çš„ reducersã€‚

Reducer çš„é€»è¾‘å½¢å¦‚ `(state, action) => newState`ï¼Œå³æ¥æ”¶ä¸Šä¸€æ­¥ state ä»¥åŠä¿®æ”¹ state çš„åŠ¨ä½œ actionï¼Œç„¶åè¿”å›ä¿®æ”¹åçš„æ–°çš„ stateï¼Œå®ƒæ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œæ„å‘³ç€æˆ‘ä»¬ä¸èƒ½çªå˜çš„ä¿®æ”¹ stateã€‚

æ¨èï¼š

```JavaScript
newState = { ...state, prop: newValue }
```

ä¸æ¨èï¼š

```JavaScript
state.prop = newValue
```

Redux æ¨èçš„æœ€ä½³å®è·µæ˜¯åˆ›å»ºç‹¬ç«‹çš„ `reducers` æ–‡ä»¶å¤¹ï¼Œåœ¨é‡Œé¢ä¿å­˜æˆ‘ä»¬çš„ä¸€ä¸ªä¸ª reducer æ–‡ä»¶ã€‚æˆ‘ä»¬åœ¨ `src` æ–‡ä»¶å¤¹ä¸‹åˆ›å»º `reducers` æ–‡ä»¶å¤¹ï¼Œåœ¨é‡Œé¢åˆ›å»º `user.js` æ–‡ä»¶ï¼Œå¹¶åŠ å…¥æˆ‘ä»¬çš„ User Reducer ç›¸åº”çš„å†…å®¹å¦‚ä¸‹ï¼š

```js src/reducers/user.js https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/reducers/user.js æŸ¥çœ‹å®Œæ•´ä»£ç 
import { SET_LOGIN_INFO, SET_IS_OPENED } from '../constants/';

const INITIAL_STATE = {
  avatar: '',
  nickName: '',
  isOpened: false,
};

export default function user(state = INITIAL_STATE, action) {
  switch (action.type) {
    case SET_IS_OPENED: {
      const { isOpened } = action.payload;

      return { ...state, isOpened };
    }

    case SET_LOGIN_INFO: {
      const { avatar, nickName } = action.payload;

      return { ...state, nickName, avatar };
    }

    default:
      return state;
  }
}
```

æˆ‘ä»¬åœ¨ `user.js` ä¸­ç”³æ˜äº† User Reducer çš„åˆå§‹çŠ¶æ€ `INITIAL_STATE`ï¼Œå¹¶å°†å®ƒèµ‹å€¼ç»™ `user` å‡½æ•° state çš„é»˜è®¤å€¼ï¼Œå®ƒæ¥æ”¶å¾…å“åº”çš„ actionï¼Œåœ¨ `user` å‡½æ•°å†…éƒ¨å°±æ˜¯ä¸€ä¸ª `switch` è¯­å¥æ ¹æ® `action.type` è¿›è¡Œåˆ¤æ–­ï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„é€»è¾‘ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦æœ‰ä¸¤ä¸ªç±»å‹ï¼š`SET_IS_OPENED` ç”¨äºä¿®æ”¹ `isOpened` å±æ€§ï¼Œ`SET_LOGIN_INFO` ç”¨äºä¿®æ”¹ `avatar` å’Œ `nickName` å±æ€§ï¼Œå½“ `switch` è¯­å¥ä¸­æ²¡æœ‰åŒ¹é…åˆ°ä»»ä½• `action.type` å€¼æ—¶ï¼Œå®ƒè¿”å›åŸ stateã€‚

{% note info %}
**æç¤º**

æ ¹æ® Redux æœ€è¿‘å®è·µï¼Œè¿™é‡Œçš„ `SET_IS_OPENED` å’Œ `SET_LOGIN_INFO` å¸¸é‡ä¸€èˆ¬ä¿å­˜åˆ° `constants` æ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬å°†é©¬ä¸Šåˆ›å»ºå®ƒã€‚è¿™é‡Œä½¿ç”¨å¸¸é‡è€Œä¸æ˜¯ç›´æ¥ç¡¬ç¼–ç å­—ç¬¦ä¸²çš„ç›®çš„æ˜¯ä¸ºäº†ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚
{% endnote %}

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ›å»º `src/reducer/user.js` ä¸­ä¼šç”¨åˆ°çš„å¸¸é‡ï¼Œæˆ‘ä»¬åœ¨ `src` æ–‡ä»¶å¤¹ä¸‹åˆ›å»º `constants` æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»º `user.js` æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­æ·»åŠ å†…å®¹å¦‚ä¸‹ï¼š

```js src/constants/user.js https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/constants/user.js æŸ¥çœ‹å®Œæ•´ä»£ç 
export const SET_IS_OPENED = 'MODIFY_IS_OPENED';
export const SET_LOGIN_INFO = 'SET_LOGIN_INFO';
```

### ç¼–å†™ Post Reducer

ä¸ºäº†å“åº” `post` é€»è¾‘çš„çŠ¶æ€ä¿®æ”¹ï¼Œæˆ‘ä»¬åˆ›å»ºåœ¨ `src/reducers` ä¸‹åˆ›å»º `post.js`ï¼Œå¹¶åœ¨å…¶ä¸­ç¼–å†™ç›¸åº”çš„å†…å®¹å¦‚ä¸‹ï¼š

```js src/reducers/post.js https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/reducers/post.js æŸ¥çœ‹å®Œæ•´ä»£ç 
import { SET_POSTS, SET_POST_FORM_IS_OPENED } from '../constants/';

import avatar from '../images/avatar.png';

const INITIAL_STATE = {
  posts: [
    {
      title: 'æ³°ç½—å¥¥ç‰¹æ›¼',
      content: 'æ³°ç½—æ˜¯å¥¥ç‰¹ä¹‹çˆ¶å’Œå¥¥ç‰¹ä¹‹æ¯å”¯ä¸€çš„äº²ç”Ÿå„¿å­',
      user: {
        nickName: 'å›¾é›€é…±',
        avatar,
      },
    },
  ],
  isOpened: false,
};

export default function post(state = INITIAL_STATE, action) {
  switch (action.type) {
    case SET_POSTS: {
      const { post } = action.payload;
      return { ...state, posts: state.posts.concat(post) };
    }

    case SET_POST_FORM_IS_OPENED: {
      const { isOpened } = action.payload;

      return { ...state, isOpened };
    }

    default:
      return state;
  }
}
```

å¯ä»¥çœ‹åˆ°ï¼ŒÂ Post Reducer çš„å½¢å¼å’Œ User Reducer ç±»ä¼¼ï¼Œæˆ‘ä»¬å°†ä¹‹å‰éœ€è¦å¤šç»„ä»¶ä¸­å…±äº«çš„çŠ¶æ€ `posts` å’Œ `isOpened` æå–å‡ºæ¥ä¿å­˜åœ¨ `post` çš„çŠ¶æ€é‡Œï¼Œè¿™é‡Œçš„ `post` å‡½æ•°ä¸»è¦å“åº” `SET_POSTS` é€»è¾‘ï¼Œç”¨äºæ·»åŠ æ–°çš„ `post` åˆ° `posts` çŠ¶æ€ç§ï¼Œä»¥åŠ `SET_POST_FORM_IS_OPENED` é€»è¾‘ï¼Œç”¨æˆ·è®¾ç½® `isOpened` çŠ¶æ€ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ›å»º `src/reducer/post.js` ä¸­ä¼šç”¨åˆ°çš„å¸¸é‡ï¼Œæˆ‘ä»¬åœ¨ `src/constants` æ–‡ä»¶å¤¹ä¸‹åˆ›å»º `user.js` æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­æ·»åŠ å†…å®¹å¦‚ä¸‹ï¼š

```js src/constants/post.js https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/constants/post.js æŸ¥çœ‹å®Œæ•´ä»£ç 
export const SET_POSTS = 'SET_POSTS';
export const SET_POST_FORM_IS_OPENED = 'SET_POST_FORM_IS_OPENED';
```

çœ¼å°–çš„åŒå­¦å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œæˆ‘ä»¬åœ¨ `src/reducers/user.js` å’Œ `src/reducers/post.js` ä¸­å¯¼å…¥éœ€è¦ä½¿ç”¨çš„å¸¸é‡æ—¶éƒ½æ˜¯ä» `../constants` çš„å½¢å¼ï¼Œé‚£æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ `src/constants` æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºäº†ä¸€ä¸ª `index.js` æ–‡ä»¶ï¼Œç”¨äºç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰çš„å¸¸é‡ï¼Œè¿™ä¹Ÿæ˜¯ä»£ç å¯ç»´æŠ¤æ€§çš„ä¸€ç§å°è¯•ã€‚

```js src/constants/index.js https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/constants/index.js æŸ¥çœ‹å®Œæ•´ä»£ç 
export * from './user';
export * from './post';
```

### ç»„åˆ User å’Œ Post Reducer

æˆ‘ä»¬åœ¨ä¹‹å‰å°†æ•´ä¸ªå…¨å±€çš„å“åº”é€»è¾‘åˆ†åˆ«æ‹†åˆ†åˆ°äº† `src/reducers/user.js` å’Œ `src/reducers/post.js` ä¸­ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥æŠŠå“åº”é€»è¾‘æ‹†åˆ†åˆ°å¾ˆå¤šä¸ªå¾ˆå°çš„å‡½æ•°å•å…ƒï¼Œæå¤§å¢åŠ äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

ä½†æœ€ç»ˆæˆ‘ä»¬è¿˜æ˜¯è¦å°†è¿™äº›æ‹†åˆ†çš„é€»è¾‘ç»„åˆæˆä¸€ä¸ªé€»è¾‘æ ‘ï¼Œå¹¶å°†å…¶ä½œä¸ºå‚æ•°ä¼ ç»™ `createStore` å‡½æ•°æ¥ä½¿ç”¨ã€‚

Redux ä¸ºæˆ‘ä»¬æä¾›äº† `combineReducers` æ¥ç»„åˆè¿™äº›æ‹†åˆ†çš„é€»è¾‘ï¼Œæˆ‘ä»¬åœ¨ `src/reducers` æ–‡ä»¶å¤¹ä¸‹åˆ›å»º `index.js` æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­ç¼–å†™å¦‚ä¸‹å†…å®¹ï¼š

```js src/reducers/index.js https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/reducers/index.js æŸ¥çœ‹å®Œæ•´ä»£ç 
import { combineReducers } from 'redux';

import user from './user';
import post from './post';

export default combineReducers({
  user,
  post,
});
```

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å¯¼å…¥äº† `user.js` å’Œ `post.js`ï¼Œå¹¶ä½¿ç”¨å¯¹è±¡ç®€ä»‹å†™æ³•ä¼ ç»™ `combineReducers` å‡½æ•°å¹¶å¯¼å‡ºï¼Œé€šè¿‡ `combineReducers` å°†é€»è¾‘è¿›è¡Œç»„åˆå¹¶å¯¼å‡ºä¸º `rootReducer` ä½œä¸ºå‚æ•°åœ¨æˆ‘ä»¬çš„ `src/store/index.js` çš„ `createStore` å‡½æ•°ä¸­ä½¿ç”¨ã€‚

è¿™é‡Œçš„ `combineReducers` å‡½æ•°ä¸»è¦å®Œæˆä¸¤ä»¶äº‹ï¼š

- ç»„åˆ user Reducer å’Œ post Reducer ä¸­çš„çŠ¶æ€ï¼Œå¹¶å°†å…¶åˆå¹¶æˆä¸€é¢—å½¢å¦‚ `{% raw %}{ user, post }{% endraw %}` çš„çŠ¶æ€æ ‘ï¼Œå…¶ä¸­ `user` å±æ€§ä¿å­˜è¿™ user Reducer çš„çŠ¶æ€ï¼Œ`post` å±æ€§ä¿å­˜ç€ post Reducer çš„çŠ¶æ€ã€‚
- åˆ†å‘ Actionï¼Œå½“ç»„ä»¶ä¸­ `dispatch` ä¸€ä¸ª Actionï¼ŒÂ `combineReducers` ä¼šéå† user Reducer å’Œ post Reducerï¼Œå½“åŒ¹é…åˆ°ä»»ä¸€ Reducer çš„ `switch` è¯­å¥æ—¶ï¼Œå°±ä¼šå“åº”è¿™ä¸ª Actionã€‚

{% note info %}
**æç¤º**

æˆ‘ä»¬å°†é©¬ä¸Šåœ¨ä¹‹åè®²è§£å¦‚ä½•åœ¨ç»„ä»¶ä¸­ `dispatch` Actionã€‚
{% endnote %}

### æ•´åˆ Redux å’Œ React

å½“æˆ‘ä»¬ç¼–å†™äº† reducers åˆ›å»ºäº† store ä¹‹åï¼Œä¸‹ä¸€æ­¥è¦è€ƒè™‘çš„å°±æ˜¯å¦‚ä½•å°† Redux æ•´åˆè¿› Reactï¼Œæˆ‘ä»¬æ‰“å¼€ `src/app.js`ï¼Œå¯¹å…¶ä¸­çš„å†…å®¹ä½œå‡ºå¦‚ä¸‹ä¿®æ”¹ï¼š

```jsx src/app.jsx https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/app.jsx æŸ¥çœ‹å®Œæ•´ä»£ç 
import Taro, { Component } from '@tarojs/taro'
[tuture-del]import Index from './pages/index'
[tuture-add]import { Provider } from '@tarojs/redux'

[tuture-add]import configStore from './store'
[tuture-add]import Index from './pages/index'
import './app.scss'

// å¦‚æœéœ€è¦åœ¨ h5 ç¯å¢ƒä¸­å¼€å¯ React Devtools
// ...
//   require('nerv-devtools')
// }

[tuture-add]const store = configStore()
[tuture-add]
class App extends Component {
  config = {
    pages: ['pages/index/index', 'pages/mine/mine', 'pages/post/post'],
    // ...
  // åœ¨ App ç±»ä¸­çš„ render() å‡½æ•°æ²¡æœ‰å®é™…ä½œç”¨
  // è¯·å‹¿ä¿®æ”¹æ­¤å‡½æ•°
  render() {
[tuture-del]    return <Index />
[tuture-add]    return (
[tuture-add]      <Provider store={store}>
[tuture-add]        <Index />
[tuture-add]      </Provider>
[tuture-add]    )
  }
}

// ...
```

å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„å†…å®¹ä¸»è¦ä¿®æ”¹äº†ä¸‰éƒ¨åˆ†ï¼š

- æˆ‘ä»¬å¯¼å…¥äº† `configureStore`ï¼Œå¹¶è°ƒç”¨å®ƒè·å– `store`ã€‚
- æ¥ç€æˆ‘ä»¬ä» Redux å¯¹åº”çš„ Taro ç»‘å®šåº“ `@tarojs/redux` ä¸­å¯¼å‡º `Provider`ï¼Œå®ƒæ¶è®¾èµ· Redux å’Œ React äº¤æµçš„æ¡¥æ¢ã€‚
- æœ€åæˆ‘ä»¬ç”¨ `Provider` åŒ…è£¹æˆ‘ä»¬ä¹‹å‰çš„æ ¹ç»„ä»¶ï¼Œå¹¶å°† `store` ä½œä¸ºå…¶å±æ€§ä¼ å…¥ï¼Œè¿™æ ·åç»­çš„ç»„ä»¶å°±å¯ä»¥é€šè¿‡è·å–åˆ° `store` é‡Œé¢ä¿å­˜çš„çŠ¶æ€ã€‚

### Hooks ç‰ˆçš„ Action åˆå°é²œ

å‡†å¤‡å¥½äº† Store å’Œ Reducerï¼Œåˆæ•´åˆäº† Redux å’Œ Reactï¼Œæ˜¯æ—¶å€™æ¥ä½“éªŒä¸€ä¸‹ Redux çŠ¶æ€ç®¡ç†å®¹å™¨çš„å…ˆè¿›æ€§äº†ï¼Œä¸è¿‡ä¸ºäº†ä½¿ç”¨ Hooks ç‰ˆæœ¬çš„ Actionï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆæ¥è®²ä¸€è®²ä¼šç”¨åˆ°çš„ Hooksã€‚

#### useDispatch Hooks

è¿™ä¸ª Hooks è¿”å› Redux store çš„ `dispatch` å¼•ç”¨ã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥ dispatch actionsã€‚

è®²å®Œ useDispatch Hooksï¼Œæˆ‘ä»¬é©¬ä¸Šæ¥å®è·µä¸€æ³¢ï¼Œé¦–å…ˆæå®šæˆ‘ä»¬ â€æ™®é€šç™»å½•â€œ çš„ Redux åŒ–é—®é¢˜ï¼Œè®©æˆ‘ä»¬æ‰“å¼€ `src/components/LoginButton/index.js`ï¼Œå¯¹å…¶ä¸­å†…å®¹ä½œå‡ºç›¸åº”çš„ä¿®æ”¹å¦‚ä¸‹ï¼š

```js src/components/LoginButton/index.js https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/components/LoginButton/index.js æŸ¥çœ‹å®Œæ•´ä»£ç 
import Taro from '@tarojs/taro'
import { AtButton } from 'taro-ui'
[tuture-add]import { useDispatch } from '@tarojs/redux'
[tuture-add]
[tuture-add]import { SET_IS_OPENED } from '../../constants'

export default function LoginButton(props) {
[tuture-add]  const dispatch = useDispatch()
[tuture-add]
  return (
[tuture-del]    <AtButton type="primary" onClick={props.handleClick}>
[tuture-add]    <AtButton
[tuture-add]      type="primary"
[tuture-add]      onClick={() =>
[tuture-add]        dispatch({ type: SET_IS_OPENED, payload: { isOpened: true } })
[tuture-add]      }
[tuture-add]    >
      æ™®é€šç™»å½•
    </AtButton>
  )
// ...
```

å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„å†…å®¹ä¸»è¦æœ‰å››å—æ”¹åŠ¨ï¼š

- é¦–å…ˆæˆ‘ä»¬ä» `@tarojs/redux` ä¸­å¯¼å‡º `useDispatch` APIã€‚
- æ¥ç€æˆ‘ä»¬ä»ä¹‹å‰å®šä¹‰çš„å¸¸é‡æ–‡ä»¶ä¸­å¯¼å‡º `SET_IS_OPENED` å¸¸é‡ã€‚
- ç„¶åï¼Œæˆ‘ä»¬åœ¨ `LoginButton` å‡½æ•°å¼ç»„ä»¶ä¸­è°ƒç”¨ `useDispatch` Hooks æ¥è¿”å›æˆ‘ä»¬çš„ `dispatch` å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥ dispatch action æ¥ä¿®æ”¹ Redux store çš„çŠ¶æ€
- æœ€åæˆ‘ä»¬å°† `AtButton` çš„ `onClick` æ¥æ”¶çš„å›è°ƒå‡½æ•°è¿›è¡Œæ›¿æ¢ï¼Œå½“æŒ‰é’®ç‚¹å‡»æ—¶ï¼Œæˆ‘ä»¬å‘èµ·ä¸€ä¸ª `type` ä¸º `SET_IS_OPENED` çš„ actionï¼Œå¹¶ä¼ é€’äº†ä¸€ä¸ª `payload` å‚æ•°ï¼Œç”¨äºå°† Redux store é‡Œé¢å¯¹åº”çš„ `user` å±æ€§ä¸­çš„ `isOpened` ä¿®æ”¹ä¸º `true`ã€‚

æå®šå®Œ â€æ™®é€šç™»å½•â€œï¼Œæˆ‘ä»¬æ¥ç€æ¥æ”¶æ‹¾ä¸€ä¸‹ â€å¾®ä¿¡ç™»å½•â€œ çš„é€»è¾‘ï¼Œæ‰“å¼€ `src/components/WeappLoginButton/index.js` æ–‡ä»¶ï¼Œå¯¹æ–‡ä»¶çš„å†…å®¹ä½œå‡ºå¦‚ä¸‹ä¿®æ”¹ï¼š

```js src/components/WeappLoginButton/index.js https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/components/WeappLoginButton/index.js æŸ¥çœ‹å®Œæ•´ä»£ç 
import Taro, { useState } from '@tarojs/taro'
import { Button } from '@tarojs/components'
[tuture-add]import { useDispatch } from '@tarojs/redux'

import './index.scss'
[tuture-add]import { SET_LOGIN_INFO } from '../../constants'

[tuture-del]export default function LoginButton(props) {
[tuture-add]export default function WeappLoginButton(props) {
  const [isLogin, setIsLogin] = useState(false)

[tuture-add]  const dispatch = useDispatch()
[tuture-add]
  async function onGetUserInfo(e) {
    setIsLogin(true)

    const { avatarUrl, nickName } = e.detail.userInfo
[tuture-del]    await props.setLoginInfo(avatarUrl, nickName)
[tuture-add]
[tuture-add]    await Taro.setStorage({
[tuture-add]      key: 'userInfo',
[tuture-add]      data: { avatar: avatarUrl, nickName },
[tuture-add]    })
[tuture-add]
[tuture-add]    dispatch({
[tuture-add]      type: SET_LOGIN_INFO,
[tuture-add]      payload: {
[tuture-add]        avatar: avatarUrl,
[tuture-add]        nickName,
[tuture-add]      },
[tuture-add]    })

    setIsLogin(false)
  }
 // ...
```

å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„æ”¹åŠ¨å’Œä¹‹å‰åœ¨ â€æ™®é€šç™»å½•â€œ é‡Œé¢çš„æ”¹åŠ¨ç±»ä¼¼ï¼š

- æˆ‘ä»¬å¯¼å‡ºäº† `useDispatch` é’©å­
- å¯¼å‡ºäº† `SET_LOGIN_INFO` å¸¸é‡
- ç„¶åæˆ‘ä»¬å°†ä¹‹å‰è°ƒç”¨çˆ¶ç»„ä»¶ä¼ ä¸‹çš„ `setLoginInfo` æ–¹æ³•æ”¹æˆäº† dispatch `type` ä¸º `SET_LOGIN_INFO` çš„ actionï¼Œå› ä¸ºæˆ‘ä»¬çš„ `avatar` å’Œ `nickName` çŠ¶æ€å·²ç»åœ¨ `store` ä¸­çš„ `user` å±æ€§ä¸­å®šä¹‰äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹ä¹Ÿæ˜¯éœ€è¦é€šè¿‡ dispatch action æ¥ä¿®æ”¹ï¼Œæœ€åæˆ‘ä»¬å°†ä¹‹å‰å®šä¹‰åœ¨çˆ¶ç»„ä»¶ä¸­çš„ `Taro.setStorage` è®¾ç½®ç¼“å­˜çš„æ–¹æ³•ç§»åŠ¨åˆ°äº†å­ç»„ä»¶ä¸­ï¼Œä»¥ä¿è¯ç›¸å…³ä¿¡æ¯çš„æ”¹åŠ¨å…·æœ‰ä¸€è‡´æ€§ã€‚

æœ€åæˆ‘ä»¬æ¥æå®š â€æ”¯ä»˜å®ç™»å½•â€œ çš„ Redux é€»è¾‘ï¼Œæ‰“å¼€ `src/components/AlipayLoginButton/index.js` å¯¹æ–‡ä»¶å†…å®¹ä½œå‡ºå¯¹åº”çš„ä¿®æ”¹å¦‚ä¸‹ï¼š

```js src/components/AlipayLoginButton/index.js https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/components/AlipayLoginButton/index.js æŸ¥çœ‹å®Œæ•´ä»£ç 
import Taro, { useState } from '@tarojs/taro'
import { Button } from '@tarojs/components'
[tuture-add]import { useDispatch } from '@tarojs/redux'

import './index.scss'
[tuture-add]import { SET_LOGIN_INFO } from '../../constants'

[tuture-del]export default function LoginButton(props) {
[tuture-add]export default function AlipayLoginButton(props) {
  const [isLogin, setIsLogin] = useState(false)
[tuture-add]  const dispatch = useDispatch()

  async function onGetAuthorize(res) {
    setIsLogin(true)
    // ...
      userInfo = JSON.parse(userInfo.response).response
      const { avatar, nickName } = userInfo

[tuture-del]      await props.setLoginInfo(avatar, nickName)
[tuture-add]      await Taro.setStorage({
[tuture-add]        key: 'userInfo',
[tuture-add]        data: { avatar, nickName },
[tuture-add]      })
[tuture-add]
[tuture-add]      dispatch({
[tuture-add]        type: SET_LOGIN_INFO,
[tuture-add]        payload: {
[tuture-add]          avatar,
[tuture-add]          nickName,
[tuture-add]        },
[tuture-add]      })
    } catch (err) {
      console.log('onGetAuthorize ERR: ', err)
    }
 // ...
```

å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„æ”¹åŠ¨å’Œä¹‹å‰åœ¨ â€å¾®ä¿¡ç™»å½•â€œ é‡Œé¢çš„æ”¹åŠ¨å‡ ä¹ä¸€æ ·ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å°±ä¸åœ¨é‡å¤è®²è§£å•¦ :)

### useSelector Hooks æ¥æ§åœº

ä¸€è·¯è·Ÿä¸‹æ¥çš„åŒå­¦å¯èƒ½æœ‰ç‚¹æ˜ç™½æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ Redux æˆ‘ä»¬ä¹‹å‰çš„ä»£ç ï¼Œè€Œæˆ‘ä»¬é‡æ„çš„æ€è·¯ä¹Ÿæ˜¯å…ˆä» `src/pages/mine/mine.jsx` ä¸­çš„ `src/components/Header/index.jsx` å¼€å§‹ï¼Œæå®šå®Œ `Header.jsx` é‡Œé¢çš„æ‰€æœ‰ç™»å½•æŒ‰é’®ä¹‹åï¼Œæ¥ä¸‹æ¥åº”è¯¥å°±è½®åˆ° `Header.jsx` å†…çš„æœ€åä¸€ä¸ªç»„ä»¶ `src/components/LoggedMine/index.jsx` äº†ã€‚

å› ä¸ºåœ¨ `LoggedMine` ç»„ä»¶ä¸­æˆ‘ä»¬è¦ç”¨åˆ° useSelector Hooksï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å…ˆæ¥è®²ä¸€ä¸‹è¿™ä¸ª Hooksã€‚

#### useSelector Hooks

`useSelector` å…è®¸ä½ ä½¿ç”¨ selector å‡½æ•°ä»ä¸€ä¸ª Redux Store ä¸­è·å–æ•°æ®ã€‚

Selector å‡½æ•°å¤§è‡´ç›¸å½“äº `connect` å‡½æ•°çš„ `mapStateToProps` å‚æ•°ã€‚Selector ä¼šåœ¨ç»„ä»¶æ¯æ¬¡æ¸²æŸ“æ—¶è°ƒç”¨ã€‚`useSelector` åŒæ ·ä¼šè®¢é˜… Redux storeï¼Œåœ¨ Redux action è¢« dispatch æ—¶è°ƒç”¨ã€‚

ä½† `useSelector` è¿˜æ˜¯å’Œ `mapStateToProps` æœ‰ä¸€äº›ä¸åŒï¼š

- ä¸åƒ `mapStateToProps` åªè¿”å›å¯¹è±¡ä¸€æ ·ï¼ŒSelector å¯èƒ½ä¼šè¿”å›ä»»ä½•å€¼ã€‚
- å½“ä¸€ä¸ª action dispatch æ—¶ï¼Œ`useSelector` ä¼šæŠŠ selector çš„å‰åè¿”å›å€¼åšä¸€æ¬¡æµ…å¯¹æ¯”ï¼Œå¦‚æœä¸åŒï¼Œç»„ä»¶ä¼šå¼ºåˆ¶æ›´æ–°ã€‚
- Selector å‡½æ•°ä¸æ¥å— `ownProps` å‚æ•°ã€‚ä½† selector å¯ä»¥é€šè¿‡é—­åŒ…è®¿é—®å‡½æ•°å¼ç»„ä»¶ä¼ é€’ä¸‹æ¥çš„ propsã€‚

å¥½çš„ï¼Œäº†è§£äº† `useSelector` çš„æ¦‚å¿µä¹‹åï¼Œæˆ‘ä»¬é©¬ä¸Šæ¥å®æ“ä¸€ä¸‹ï¼Œæ‰“å¼€ `src/components/LoggedMine/index.jsx` æ–‡ä»¶ï¼Œå¯¹å…¶ä¸­çš„å†…å®¹ä½œå‡ºå¦‚ä¸‹çš„ä¿®æ”¹ï¼š

```jsx src/components/LoggedMine/index.jsx https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/components/LoggedMine/index.jsx æŸ¥çœ‹å®Œæ•´ä»£ç 
import Taro from '@tarojs/taro'
import { View, Image } from '@tarojs/components'
[tuture-del]import PropTypes from 'prop-types'
[tuture-add]import { useSelector } from '@tarojs/redux'
[tuture-add]import { AtAvatar } from 'taro-ui'

import './index.scss'
[tuture-del]import avatar from '../../images/avatar.png'

export default function LoggedMine(props) {
[tuture-del]  const { userInfo = {} } = props
[tuture-add]  const nickName = useSelector(state => state.user.nickName)
[tuture-add]  const avatar = useSelector(state => state.user.avatar)
[tuture-add]
  function onImageClick() {
    Taro.previewImage({
[tuture-del]      urls: [userInfo.avatar],
[tuture-add]      urls: [avatar],
    })
  }

  return (
    <View className="logged-mine">
[tuture-del]      <Image
[tuture-del]        src={userInfo.avatar ? userInfo.avatar : avatar}
[tuture-del]        className="mine-avatar"
[tuture-del]        onClick={onImageClick}
[tuture-del]      />
[tuture-del]      <View className="mine-nickName">
[tuture-del]        {userInfo.nickName ? userInfo.nickName : 'å›¾é›€é…±'}
[tuture-del]      </View>
[tuture-del]      <View className="mine-username">{userInfo.username}</View>
[tuture-add]      {avatar ? (
[tuture-add]        <Image src={avatar} className="mine-avatar" onClick={onImageClick} />
[tuture-add]      ) : (
[tuture-add]        <AtAvatar size="large" circle text="é›€" />
[tuture-add]      )}
[tuture-add]      <View className="mine-nickName">{nickName}</View>
    </View>
  )
}
[tuture-del]
[tuture-del]LoggedMine.propTypes = {
[tuture-del]  avatar: PropTypes.string,
[tuture-del]  nickName: PropTypes.string,
[tuture-del]  username: PropTypes.string,
[tuture-del]}
```

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¸Šé¢çš„ä»£ç ä¸»è¦æœ‰å››å¤„æ”¹åŠ¨ï¼š

- é¦–å…ˆæˆ‘ä»¬ä» `@tarojs/redux` ä¸­å¯¼å‡ºäº† `useSelector` Hooksã€‚
- æ¥ç€æˆ‘ä»¬ä½¿ç”¨äº†ä¸¤æ¬¡ `useSelector` åˆ†åˆ«ä» Redux Store é‡Œé¢è·å–äº† `nickName` å’Œ `avatar`ï¼Œå®ƒä»¬ä½äº `state.user` å±æ€§ä¸‹ã€‚
- æ¥ç€æˆ‘ä»¬å°†ä¹‹å‰ä» `props` é‡Œé¢è·å–åˆ°çš„ `nickName` å’Œ `avatar` æ›¿æ¢æˆæˆ‘ä»¬ä» Redux store é‡Œé¢è·å–åˆ°çŠ¶æ€ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸ºäº†ç”¨æˆ·ä½“éªŒï¼Œä» `taro-ui` ä¸­å¯¼å‡ºäº†ä¸€ä¸ª `AtAvatar` ç»„ä»¶ç”¨äºå±•ç¤ºåœ¨æ²¡æœ‰ `avatar` æ—¶çš„é»˜è®¤å¤´åƒã€‚
- æœ€åï¼Œåœ¨ç‚¹å‡»å¤´åƒè¿›è¡Œé¢„è§ˆçš„ `onImageClick` æ–¹æ³•é‡Œé¢ï¼Œæˆ‘ä»¬ä½¿ç”¨ä» Redux store é‡Œé¢è·å–åˆ°çš„ `avatar`ã€‚

æ˜¯æ—¶å€™æ”¶å‰²æœ€åä¸€æ³¢ â€éŸ­èœâ€œ äº†ï¼Œè®©æˆ‘ä»¬å½»åº•å®Œæˆ `Header/index.js` çš„ Redux åŒ–ï¼Œæ‰“å¼€ `src/components/Header/index.js` ï¼Œå¯¹å…¶ä¸­çš„å†…å®¹åšå‡ºç›¸åº”çš„ä¿®æ”¹å¦‚ä¸‹ï¼š

```js src/components/Header/index.js https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/components/Header/index.js æŸ¥çœ‹å®Œæ•´ä»£ç 
import Taro from '@tarojs/taro'
import { View } from '@tarojs/components'
import { AtMessage } from 'taro-ui'
[tuture-add]import { useSelector } from '@tarojs/redux'

import LoggedMine from '../LoggedMine'
import LoginButton from '../LoginButton'
// ...
import './index.scss'

export default function Header(props) {
[tuture-add]  const nickName = useSelector(state => state.user.nickName)
[tuture-add]
[tuture-add]  // åŒå–åæ¥æ„é€ å­—ç¬¦ä¸²å¯¹åº”çš„å¸ƒå°”å€¼ï¼Œç”¨äºæ ‡å¿—æ­¤æ—¶æ˜¯å¦ç”¨æˆ·å·²ç»ç™»å½•
[tuture-add]  const isLogged = !!nickName
[tuture-add]
  const isWeapp = Taro.getEnv() === Taro.ENV_TYPE.WEAPP
  const isAlipay = Taro.getEnv() === Taro.ENV_TYPE.ALIPAY

  return (
    <View className="user-box">
      <AtMessage />
[tuture-del]      <LoggedMine userInfo={props.userInfo} />
[tuture-del]      {!props.isLogged && (
[tuture-add]      <LoggedMine />
[tuture-add]      {!isLogged && (
        <View className="login-button-box">
[tuture-del]          <LoginButton handleClick={props.handleClick} />
[tuture-del]          {isWeapp && <WeappLoginButton setLoginInfo={props.setLoginInfo} />}
[tuture-del]          {isAlipay && <AlipayLoginButton setLoginInfo={props.setLoginInfo} />}
[tuture-add]          <LoginButton />
[tuture-add]          {isWeapp && <WeappLoginButton />}
[tuture-add]          {isAlipay && <AlipayLoginButton />}
        </View>
      )}
    </View>
  // ...
```

å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„ä»£ç ä¸»è¦æœ‰äº”å¤„ä¸»è¦çš„å˜åŠ¨ï¼š

- é¦–å…ˆæˆ‘ä»¬å¯¼å‡ºäº† `useSelector` Hooksã€‚
- æ¥ç€æˆ‘ä»¬ä½¿ç”¨ `useSelector` ä¸­å–åˆ°æˆ‘ä»¬éœ€è¦çš„ `nickName` å±æ€§ï¼Œç”¨äºè¿›è¡ŒåŒå–åè½¬æ¢æˆå¸ƒå°”å€¼ `isLogged`ï¼Œè¡¨ç¤ºæ˜¯å¦ç™»å½•ã€‚
- æ¥ç€æˆ‘ä»¬å°†ä¹‹å‰ä»çˆ¶ç»„ä»¶è·å–çš„ `props.isLogged` å±æ€§æ›¿æ¢æˆæ–°çš„ä» `isLogged` å€¼
- æ¥ç€ï¼Œæˆ‘ä»¬å»æ‰ â€æ™®é€šç™»å½•â€ æŒ‰é’®ä¸Šä¸å†éœ€è¦çš„ `handleClick` å±æ€§å’Œ â€œå¾®ä¿¡ç™»å½•â€ã€â€œæ”¯ä»˜å®ç™»å½•â€ ä¸Šé¢ä¸å†éœ€è¦çš„ `setLoginInfo` å±æ€§ã€‚
- æœ€åï¼Œæˆ‘ä»¬å»æ‰ `LoggedMine` ç»„ä»¶ä¸Šä¸å†éœ€è¦çš„ `userInfo` å±æ€§ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åœ¨ç»„ä»¶å†…éƒ¨ä»ä½¿ç”¨ `useSelector` Hooks ä»ç»„ä»¶å†…éƒ¨è·å–äº†ã€‚

### æå®š Footer çš„ Redux åŒ–

æœ¬æ¥è¿™ä¸ªå°æ ‡é¢˜æˆ‘æ˜¯ä¸æƒ³èµ·çš„ï¼Œä½†æ˜¯å› ä¸ºï¼Œæ˜¯å§ï¼Œå¤§å®¶ä¸Šé¢åœ¨æ²¡æœ‰å°æ ‡é¢˜çš„æƒ…å†µä¸‹çœ‹äº†è¿™ä¹ˆä¹…ï¼Œå¯èƒ½å·²ç»åºŸï¼ˆç´¯ï¼‰äº†ï¼Œæ‰€ä»¥æˆ‘å°±è´´å¿ƒçš„åŠ ä¸Šä¸€ä¸ªå°æ ‡é¢˜ï¼Œå¸®åŠ©ä½ å®šä½æ¥ä¸‹æ¥è®²è§£çš„é‡å¿ƒã€‚

æ˜¯çš„æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦é‡æ„ â€œæˆ‘çš„" tab é¡µé¢ä¸­çš„ä¸‹åŠéƒ¨åˆ†ç»„ä»¶ `src/components/Footer/index.js` æˆ‘ä»¬éµå¾ªè‡ªé¡¶å‘ä¸‹çš„æ–¹å¼æ¥é‡æ„ï¼Œé¦–å…ˆæ˜¯ `src/components/Logout/index.js` æ–‡ä»¶ï¼Œæˆ‘ä»¬æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå¯¹å…¶ä¸­å†…å®¹ä½œå‡ºå¦‚ä¸‹ä¿®æ”¹ï¼š

```js src/components/Logout/index.js https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/components/Logout/index.js æŸ¥çœ‹å®Œæ•´ä»£ç 
[tuture-del]import Taro from '@tarojs/taro'
[tuture-add]import Taro, { useState } from '@tarojs/taro'
import { AtButton } from 'taro-ui'
[tuture-add]import { useDispatch } from '@tarojs/redux'
[tuture-add]
[tuture-add]import { SET_LOGIN_INFO } from '../../constants'

export default function LoginButton(props) {
[tuture-add]  const [isLogout, setIsLogout] = useState(false)
[tuture-add]  const dispatch = useDispatch()
[tuture-add]
[tuture-add]  async function handleLogout() {
[tuture-add]    setIsLogout(true)
[tuture-add]
[tuture-add]    try {
[tuture-add]      await Taro.removeStorage({ key: 'userInfo' })
[tuture-add]
[tuture-add]      dispatch({
[tuture-add]        type: SET_LOGIN_INFO,
[tuture-add]        payload: {
[tuture-add]          avatar: '',
[tuture-add]          nickName: '',
[tuture-add]        },
[tuture-add]      })
[tuture-add]    } catch (err) {
[tuture-add]      console.log('removeStorage ERR: ', err)
[tuture-add]    }
[tuture-add]
[tuture-add]    setIsLogout(false)
[tuture-add]  }
[tuture-add]
  return (
[tuture-del]    <AtButton
[tuture-del]      type="secondary"
[tuture-del]      full
[tuture-del]      loading={props.loading}
[tuture-del]      onClick={props.handleLogout}
[tuture-del]    >
[tuture-add]    <AtButton type="secondary" full loading={isLogout} onClick={handleLogout}>
      é€€å‡ºç™»å½•
    </AtButton>
  )
// ...
```

è¿™ä¸€æ­¥å¯èƒ½æ˜¯æœ€èƒ½ä½“ç°å¼•å…¥ Redux è¿›è¡ŒçŠ¶æ€ç®¡ç†å¸¦æ¥å¥½å¤„çš„ä¸€æ­¥äº† â€“ æˆ‘ä»¬å°†ä¹‹å‰è‡³ä¸Šè€Œä¸‹çš„ React çŠ¶æ€ç®¡ç†é€»è¾‘å‹å¹³ï¼Œä½¿å¾—åº•å±‚ç»„ä»¶å¯ä»¥åœ¨è‡ªèº«ä¸­å°±è§£å†³å“åº”çš„çŠ¶æ€å’Œé€»è¾‘é—®é¢˜ã€‚

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¸Šé¢çš„æ–‡ä»¶ä¸­ä¸»è¦æœ‰äº”å¤„æ”¹åŠ¨ï¼š

- é¦–å…ˆæˆ‘ä»¬ä» `@tarojs/taro` é‡Œé¢å¯¼å‡º `useState` Hooksã€‚
- æ¥ç€æˆ‘ä»¬å°†ä¹‹å‰åœ¨ `src/pages/mine/mine.js` ä¸­å®šä¹‰çš„ `isLogout` çŠ¶æ€ç§»åŠ¨åˆ°ç»„ä»¶ `Logout` ç»„ä»¶å†…éƒ¨æ¥ï¼Œå› ä¸ºå®ƒåªå’Œæ­¤ç»„ä»¶æœ‰å…³ç³»ã€‚
- æ¥ç€æˆ‘ä»¬ç”¨ `isLogout` æ›¿æ¢åœ¨ `AtButton` é‡Œé¢ç”¨åˆ°çš„ `props.loading` å±æ€§ã€‚
- ç„¶åï¼Œæˆ‘ä»¬è€ƒè™‘å°†ä¹‹å‰æŒ‰é’®ç‚¹å‡»è°ƒç”¨ `props.handleLogout` Redux åŒ–ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªç‚¹å‡»ä¹‹åçš„å›è°ƒå‡½æ•° `handleLogout` åœ¨ç»„ä»¶å†…éƒ¨å®šä¹‰ã€‚
- æœ€åï¼Œæˆ‘ä»¬ä» `@tarojs/redux` ä¸­å¯¼å…¥ `useDispatch` Hooksï¼Œå¹¶åœ¨ç»„ä»¶ä¸­è°ƒç”¨æˆæˆ‘ä»¬éœ€è¦çš„ `dispatch` å‡½æ•°ï¼Œæ¥ç€æˆ‘ä»¬åœ¨ `handleLogout` å‡½æ•°ä¸­å» dispatch ä¸€ä¸ª `SET_LOGIN_INFO` action æ¥é‡ç½® Store ä¸­çš„ `nickName` å’Œ `avatar` å±æ€§ã€‚

{% note info %}
**æç¤º**

è¿™é‡Œæˆ‘ä»¬åœ¨ç»„ä»¶å†…å®šä¹‰çš„ `handleLogout` å‡½æ•°å’Œæˆ‘ä»¬ä¹‹å‰åœ¨ `src/pages/mine/mine.js` ä¸­å®šä¹‰çš„ç±»ä¼¼ï¼Œåªæ˜¯ä½¿ç”¨ dispatch action çš„æ–¹å¼æ›¿æ¢äº†é‡ç½® `nickName` å’Œ `avatar` çš„éƒ¨åˆ†ã€‚
{% endnote %}

æå®šå®Œ `Logout` ç»„ä»¶ï¼Œæ¥ç€å°±æ˜¯ `LoginForm` ç»„ä»¶çš„é‡æ„äº†ï¼Œè®©æˆ‘ä»¬å¿«é©¬åŠ é­ï¼Œè®©å®ƒä¹Ÿæ¥å— Redux å…‰ç¯çš„æ´—ç¤¼å§ï¼

æ‰“å¼€ `src/components/LoginForm/index.jsx` ï¼Œå¯¹å…¶ä¸­çš„å†…å®¹ä½œå‡ºç›¸åº”çš„ä¿®æ”¹å¦‚ä¸‹ï¼š

```jsx src/components/LoginForm/index.jsx https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/components/LoginForm/index.jsx æŸ¥çœ‹å®Œæ•´ä»£ç 
import Taro, { useState } from '@tarojs/taro'
import { View, Form } from '@tarojs/components'
import { AtButton, AtImagePicker } from 'taro-ui'
[tuture-add]import { useDispatch } from '@tarojs/redux'

[tuture-add]import { SET_LOGIN_INFO, SET_IS_OPENED } from '../../constants'
import './index.scss'

export default function LoginForm(props) {
[tuture-add]  // Login Form ç™»å½•æ•°æ®
[tuture-add]  const [formNickName, setFormNickName] = useState('')
[tuture-add]  const [files, setFiles] = useState([])
  const [showAddBtn, setShowAddBtn] = useState(true)

[tuture-add]  const dispatch = useDispatch()
[tuture-add]
  function onChange(files) {
    if (files.length > 0) {
      setShowAddBtn(false)
[tuture-add]    } else {
[tuture-add]      setShowAddBtn(true)
    }

[tuture-del]    props.handleFilesSelect(files)
[tuture-add]    setFiles(files)
  }

  function onImageClick() {
    // ...
    })
  }

[tuture-add]  async function handleSubmit(e) {
[tuture-add]    e.preventDefault()
[tuture-add]
[tuture-add]    // é‰´æƒæ•°æ®
[tuture-add]    if (!formNickName || !files.length) {
[tuture-add]      Taro.atMessage({
[tuture-add]        type: 'error',
[tuture-add]        message: 'æ‚¨è¿˜æœ‰å†…å®¹æ²¡æœ‰å¡«å†™ï¼',
[tuture-add]      })
[tuture-add]
[tuture-add]      return
[tuture-add]    }
[tuture-add]
[tuture-add]    setShowAddBtn(true)
[tuture-add]
[tuture-add]    // æç¤ºç™»å½•æˆåŠŸ
[tuture-add]    Taro.atMessage({
[tuture-add]      type: 'success',
[tuture-add]      message: 'æ­å–œæ‚¨ï¼Œç™»å½•æˆåŠŸï¼',
[tuture-add]    })
[tuture-add]
[tuture-add]    // ç¼“å­˜åœ¨ storage é‡Œé¢
[tuture-add]    const userInfo = { avatar: files[0].url, nickName: formNickName }
[tuture-add]
[tuture-add]    // æ¸…ç©ºè¡¨å•çŠ¶æ€
[tuture-add]    setFiles([])
[tuture-add]    setFormNickName('')
[tuture-add]
[tuture-add]    // ç¼“å­˜åœ¨ storage é‡Œé¢
[tuture-add]    await Taro.setStorage({ key: 'userInfo', data: userInfo })
[tuture-add]
[tuture-add]    dispatch({ type: SET_LOGIN_INFO, payload: userInfo })
[tuture-add]
[tuture-add]    // å…³é—­å¼¹å‡ºå±‚
[tuture-add]    dispatch({ type: SET_IS_OPENED, payload: { isOpened: false } })
[tuture-add]  }
[tuture-add]
  return (
    <View className="post-form">
[tuture-del]      <Form onSubmit={props.handleSubmit}>
[tuture-add]      <Form onSubmit={handleSubmit}>
        <View className="login-box">
          <View className="avatar-selector">
            <AtImagePicker
              length={1}
              mode="scaleToFill"
              count={1}
[tuture-del]              files={props.files}
[tuture-add]              files={files}
              showAddBtn={showAddBtn}
              onImageClick={onImageClick}
              onChange={onChange}
            // ...
            className="input-nickName"
            type="text"
            placeholder="ç‚¹å‡»è¾“å…¥æ˜µç§°"
[tuture-del]            value={props.formNickName}
[tuture-del]            onInput={props.handleNickNameInput}
[tuture-add]            value={formNickName}
[tuture-add]            onInput={e => setFormNickName(e.target.value)}
          />
          <AtButton formType="submit" type="primary">
            ç™»å½•
          // ...
```

è¿™ä¸€æ­¥å’Œä¸Šä¸€æ­¥ç±»ä¼¼ï¼Œå¯èƒ½ä¹Ÿæ˜¯æœ€èƒ½ä½“ç°å¼•å…¥ Redux è¿›è¡ŒçŠ¶æ€ç®¡ç†å¸¦æ¥å¥½å¤„çš„ä¸€æ­¥äº†ï¼Œæˆ‘ä»¬åŒæ ·å°†ä¹‹å‰åœ¨é¡¶å±‚ç»„ä»¶ä¸­æä¾›çš„çŠ¶æ€å‹å¹³åˆ°äº†åº•å±‚ç»„ä»¶å†…éƒ¨ã€‚

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¸Šé¢çš„æ–‡ä»¶ä¸­ä¸»è¦æœ‰å››å¤„æ”¹åŠ¨ï¼š

- é¦–å…ˆæˆ‘ä»¬å°† `formNickName` å’Œ `files` ç­‰çŠ¶æ€æ”¾ç½®åˆ° `LoginForm` ç»„ä»¶å†…éƒ¨ï¼Œå¹¶ä½¿ç”¨ `useState` Hooks ç®¡ç†èµ·æ¥ï¼Œå› ä¸ºå®ƒä»¬åªå’Œæ­¤ç»„ä»¶æœ‰å…³ç³»ã€‚
- æ¥ç€ï¼Œæˆ‘ä»¬å°† `AtImagePicker` é‡Œé¢çš„ `props.files` æ›¿æ¢æˆ `files`ï¼Œå°†å®ƒçš„ `onChange` å›è°ƒå‡½æ•°å†…éƒ¨çš„è®¾ç½®æ”¹å˜çŠ¶æ€çš„ `props.handleFilesSelect(files)` æ›¿æ¢æˆ `setFiles(files)`ã€‚å¯ä»¥çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬è¿˜å¯¹ `files.length = 0` çš„å½¢å¼åšäº†ä¸€ä¸ªåˆ¤æ–­ï¼Œå½“æ²¡æœ‰é€‰æ‹©å›¾ç‰‡æ—¶ï¼Œè¦æŠŠæˆ‘ä»¬é€‰æ‹©å›¾ç‰‡çš„æŒ‰é’®æ˜¾ç¤ºå‡ºæ¥ã€‚
- æ¥ç€ï¼Œæˆ‘ä»¬å°† `Input` ç»„ä»¶çš„ `props.formNickName` æ›¿æ¢æˆ `formNickName`ï¼Œå°†ä¹‹å‰ `onInput` æ¥æ”¶çš„å›è°ƒå‡½æ•°æ¢æˆäº† `setFormNickName` çš„å½¢å¼æ¥è®¾ç½® `formNickName` çš„å˜åŒ–ã€‚
- æ¥ç€ï¼Œæˆ‘ä»¬å°†ä¹‹å‰æäº¤è¡¨å•éœ€è¦è°ƒç”¨çš„çˆ¶ç»„ä»¶æ–¹æ³• `props.handleSubmit` ç§»åŠ¨åˆ°ç»„ä»¶å†…éƒ¨æ¥å®šä¹‰ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ª `hanldeSubmit` ç»„åˆäº†ä¹‹å‰åœ¨ `src/components/Footer/index.jsx` å’Œ `src/pages/mine/mine.js` ç»„ä»¶é‡Œçš„ `handleSubmit` é€»è¾‘ï¼š
- æ¥ç€è¿›è¡Œæ•°æ®éªŒè¯ï¼Œä¸åˆè¦æ±‚çš„æ•°æ®å°±ä¼šè¢«é©³å›å¹¶æ˜¾ç¤ºé”™è¯¯ï¼ˆå…¶å®è¿™é‡Œåº”è¯¥æ˜¾ç¤ºè­¦å‘Š `warning`ï¼Œå½“æ—¶å†™ä»£ç æ—¶çŸ³ä¹å¿— ğŸ˜…ï¼‰ã€‚
- æ¥ç€å› ä¸º `LoginForm` è¡¨å•æ•°æ®è¦è¢«æ¸…é™¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†é€‰ä¸­å›¾ç‰‡çš„æŒ‰é’®åˆè®¾ç½®ä¸ºå¯æ˜¾ç¤ºçŠ¶æ€ã€‚
- æ¥ç€æç¤ºç™»å½•æˆåŠŸã€‚
- æ¸…ç©ºè¡¨å•çŠ¶æ€ã€‚
- å°†ç™»å½•æ•°æ®ç¼“å­˜åœ¨ `storage` é‡Œé¢ï¼Œåœ¨ Taro é‡Œé¢ä½¿ç”¨ `{% raw %}Taro.setStorage({ key, data }){% endraw %}` çš„å½¢å¼æ¥ç¼“å­˜ï¼Œå…¶ä¸­ `key` æ˜¯å­—ç¬¦ä¸²ï¼Œ`data` æ˜¯å­—ç¬¦ä¸²æˆ–è€…å¯¹è±¡ã€‚
- æœ€åæˆ‘ä»¬å¯¼å‡ºäº† `useDispatch` Hooksï¼Œä½¿ç”¨ `useDispatch` Hooks ç”Ÿæˆçš„ `dispatch` å‡½æ•°çš„å¼•ç”¨æ¥å‘èµ·æ›´æ–° Redux store çš„ action æ¥æ›´æ–°æœ¬åœ°æ•°æ®ï¼Œ`type` ä¸º `SET_LOGIN_INFO` çš„ action ç”¨æ¥æ›´æ–°ç”¨æˆ·ç™»å½•ä¿¡æ¯ï¼Œ`type` ä¸º `SET_IS_OPENED` çš„ action ç”¨æ¥æ›´æ–° `isOpened` å±æ€§ï¼Œå®ƒå°†å…³é—­å±•ç¤ºç™»å½•æ¡†çš„å¼¹å‡ºå±‚ `FloatLayout` ç»„ä»¶ã€‚

è®²åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„ `Footer` éƒ¨åˆ†çš„é‡æ„å¤§ä¸šè¿˜å‰©ä¸‹ä¸´é—¨ä¸€è„šäº†ã€‚è®©æˆ‘ä»¬æ‰“å¼€ `src/components/Footer/index.js` æ–‡ä»¶ï¼Œç«‹é©¬æ¥é‡æ„å®ƒï¼š

```js src/components/Footer/index.js https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/components/Footer/index.js æŸ¥çœ‹å®Œæ•´ä»£ç 
[tuture-del]import Taro, { useState } from '@tarojs/taro'
[tuture-add]import Taro from '@tarojs/taro'
import { View } from '@tarojs/components'
import { AtFloatLayout } from 'taro-ui'
[tuture-add]import { useSelector, useDispatch } from '@tarojs/redux'

import Logout from '../Logout'
import LoginForm from '../LoginForm'
import './index.scss'
[tuture-add]import { SET_IS_OPENED } from '../../constants'

export default function Footer(props) {
[tuture-del]  // Login Form ç™»å½•æ•°æ®
[tuture-del]  const [formNickName, setFormNickName] = useState('')
[tuture-del]  const [files, setFiles] = useState([])
[tuture-add]  const nickName = useSelector(state => state.user.nickName)

[tuture-del]  async function handleSubmit(e) {
[tuture-del]    e.preventDefault()
[tuture-add]  const dispatch = useDispatch()

[tuture-del]    // é‰´æƒæ•°æ®
[tuture-del]    if (!formNickName || !files.length) {
[tuture-del]      Taro.atMessage({
[tuture-del]        type: 'error',
[tuture-del]        message: 'æ‚¨è¿˜æœ‰å†…å®¹æ²¡æœ‰å¡«å†™ï¼',
[tuture-del]      })
[tuture-add]  // åŒå–åæ¥æ„é€ å­—ç¬¦ä¸²å¯¹åº”çš„å¸ƒå°”å€¼ï¼Œç”¨äºæ ‡å¿—æ­¤æ—¶æ˜¯å¦ç”¨æˆ·å·²ç»ç™»å½•
[tuture-add]  const isLogged = !!nickName

[tuture-del]      return
[tuture-del]    }
[tuture-del]
[tuture-del]    // æç¤ºç™»å½•æˆåŠŸ
[tuture-del]    Taro.atMessage({
[tuture-del]      type: 'success',
[tuture-del]      message: 'æ­å–œæ‚¨ï¼Œç™»å½•æˆåŠŸï¼',
[tuture-del]    })
[tuture-del]
[tuture-del]    // ç¼“å­˜åœ¨ storage é‡Œé¢
[tuture-del]    const userInfo = { avatar: files[0].url, nickName: formNickName }
[tuture-del]    await props.handleSubmit(userInfo)
[tuture-del]
[tuture-del]    // æ¸…ç©ºè¡¨å•çŠ¶æ€
[tuture-del]    setFiles([])
[tuture-del]    setFormNickName('')
[tuture-del]  }
[tuture-add]  // ä½¿ç”¨ useSelector Hooks è·å– Redux Store æ•°æ®
[tuture-add]  const isOpened = useSelector(state => state.user.isOpened)

  return (
    <View className="mine-footer">
[tuture-del]      {props.isLogged && (
[tuture-del]        <Logout loading={props.isLogout} handleLogout={props.handleLogout} />
[tuture-del]      )}
[tuture-add]      {isLogged && <Logout />}
      <View className="tuture-motto">
[tuture-del]        {props.isLogged ? 'From å›¾é›€ç¤¾åŒº with Love â¤' : 'æ‚¨è¿˜æœªç™»å½•'}
[tuture-add]        {isLogged ? 'From å›¾é›€ç¤¾åŒº with Love â¤' : 'æ‚¨è¿˜æœªç™»å½•'}
      </View>
      <AtFloatLayout
[tuture-del]        isOpened={props.isOpened}
[tuture-add]        isOpened={isOpened}
        title="ç™»å½•"
[tuture-del]        onClose={() => props.handleSetIsOpened(false)}
[tuture-add]        onClose={() =>
[tuture-add]          dispatch({ type: SET_IS_OPENED, payload: { isOpened: false } })
[tuture-add]        }
      >
[tuture-del]        <LoginForm
[tuture-del]          formNickName={formNickName}
[tuture-del]          files={files}
[tuture-del]          handleSubmit={e => handleSubmit(e)}
[tuture-del]          handleNickNameInput={e => setFormNickName(e.target.value)}
[tuture-del]          handleFilesSelect={files => setFiles(files)}
[tuture-del]        />
[tuture-add]        <LoginForm />
      </AtFloatLayout>
    </View>
  )
// ...
```

å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ä»£ç ä¸»è¦æœ‰äº”å¤„æ”¹åŠ¨ï¼š

- é¦–å…ˆæˆ‘ä»¬å·²ç»å°† `nickName` æŠ½å–åˆ° Redux store ä¿å­˜çš„çŠ¶æ€ä¸­ï¼Œæ‰€ä»¥ä¹‹å‰ä»çˆ¶ç»„ä»¶è·å–çš„ `props.isLogged` åˆ¤æ–­æ˜¯å¦ç™»å½•çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬ç§»åŠ¨åˆ°ç»„ä»¶å†…éƒ¨æ¥ï¼Œä½¿ç”¨ `useSelector` Hooks ä» Redux store ä»è·å– `nickName` å±æ€§ï¼Œè¿›è¡ŒåŒå–åæ“ä½œæˆå¸ƒå°”å€¼æ¥è¡¨ç¤ºæ˜¯å¦å·²ç»ç™»å½•çš„ `isLogged` å±æ€§ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥æ›¿æ¢ä¹‹å‰çš„ `props.isLogged` å±æ€§ã€‚
- æ¥ç€ï¼Œå°±æ˜¯å–ä»£ä¹‹å‰ä»çˆ¶ç»„ä»¶è·å–çš„ `props.isOpened` å±æ€§ï¼Œæˆ‘ä»¬ä½¿ç”¨ `useSelector` Hooks ä» Redux store ä¸­è·å–å¯¹åº”çš„ `isOpened` å±æ€§ï¼Œç„¶åæ›¿æ¢ä¹‹å‰çš„ `props.isOpened`ï¼Œç”¨æˆ·æ§åˆ¶ç™»å½•æ¡†çª—å£çš„å¼¹å‡ºå±‚ `AtFloatLayout` çš„æ‰“å¼€å’Œå…³é—­ã€‚
- æ¥ç€ï¼Œæˆ‘ä»¬å°†ä¹‹å‰ `AtFloatLayout` å…³é—­æ—¶ï¼ˆ`onClose`ï¼‰çš„å›è°ƒå‡½æ•°æ›¿æ¢æˆ dispatch ä¸€ä¸ª `type` ä¸º `SET_IS_OPENED` çš„ action æ¥è®¾ç½® `isOpened` å±æ€§å°† `AtFloatLayout` å…³é—­ã€‚
- æ¥ç€ï¼Œæˆ‘ä»¬å¼€å§‹ç§»é™¤ `Logout` å’Œ `LoginForm` ç»„ä»¶ä¸Šä¸å†éœ€è¦ä¼ é€’çš„å±æ€§ï¼Œå› ä¸ºåœ¨å¯¹åº”çš„ç»„ä»¶ä¸­æˆ‘ä»¬å·²ç»å£°æ˜äº†å¯¹åº”çš„å±æ€§äº†ã€‚
- æœ€åï¼Œæˆ‘ä»¬åˆ æ‰ä¹‹å‰å®šä¹‰åœ¨ `Footer` ç»„ä»¶å†…çš„ `formNickName` å’Œ `files` ç­‰çŠ¶æ€ï¼Œä»¥åŠä¸å†éœ€è¦çš„ `handleSubmit` å‡½æ•°ï¼Œå› ä¸ºå®ƒå·²ç»åœ¨ `LoginForm` é‡Œé¢å®šä¹‰äº†ã€‚

### å®Œæˆ â€œæˆ‘çš„â€ é¡µé¢é‡æ„

ç†Ÿæ‚‰å¥—è·¯çš„åŒå­¦å¯èƒ½éƒ½çŸ¥é“èµ·è¿™ä¸ªæ ‡é¢˜çš„å«ä¹‰äº†å§ ğŸ˜ã€‚

æˆ‘ä»¬ä¸€è·¯æ‰“æ€ªé‡æ„åˆ°è¿™é‡Œï¼Œç›¸æ¯”çœ¼å°–çš„äººå·²ç»æ‘¸æ¸…æ¥š Redux çš„å¥—è·¯äº†ï¼Œç»“åˆ Redux æ¥å†™ React ä»£ç ï¼Œå°±å¥½æ¯” â€œåƒé‡Œä¹‹å ¤ï¼Œå§‹äºå’åœŸâ€ ä¸€èˆ¬ï¼Œæˆ‘ä»¬å…ˆæŠŠæ‰€æœ‰ç»†å°çš„åˆ†æ”¯ç»„ä»¶æå®šï¼Œè¿›è€Œä¸€æ­¥ä¸€æ­¥å‘é¡¶å±‚ç»„ä»¶è¿›å‘ï¼Œä»¥å®Œæˆæ‰€æœ‰ç»„ä»¶çš„ç¼–å†™ã€‚

è€Œè¿™ä¸ª `src/pages/mine/mine.jsx` ç»„ä»¶å°±æ˜¯ â€œæˆ‘çš„â€ è¿™ä¸€ tab é¡µé¢çš„é¡¶å±‚ç»„ä»¶äº†ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬åœ¨ â€œæˆ‘çš„â€ é¡µé¢éœ€è¦é‡æ„çš„æœ€åä¸€ä¸ªé¡µé¢äº†ï¼Œæ˜¯çš„ï¼Œæˆ‘ä»¬é©¬ä¸Šå°±è¦è¾¾åˆ°ç¬¬ä¸€é˜¶æ®µæ€§èƒœåˆ©äº† âœŒï¸ã€‚ç°åœ¨å°±æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå¯¹å…¶ä¸­çš„å†…å®¹ä½œå‡ºå¦‚ä¸‹çš„ä¿®æ”¹ï¼š

```jsx src/pages/mine/mine.jsx https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/pages/mine/mine.jsx æŸ¥çœ‹å®Œæ•´ä»£ç 
[tuture-del]import Taro, { useState, useEffect } from '@tarojs/taro'
[tuture-add]import Taro, { useEffect } from '@tarojs/taro'
import { View } from '@tarojs/components'
[tuture-add]import { useDispatch } from '@tarojs/redux'

import { Header, Footer } from '../../components'
import './mine.scss'
[tuture-add]import { SET_LOGIN_INFO } from '../../constants'

export default function Mine() {
[tuture-del]  const [nickName, setNickName] = useState('')
[tuture-del]  const [avatar, setAvatar] = useState('')
[tuture-del]  const [isOpened, setIsOpened] = useState(false)
[tuture-del]  const [isLogout, setIsLogout] = useState(false)
[tuture-del]
[tuture-del]  // åŒå–åæ¥æ„é€ å­—ç¬¦ä¸²å¯¹åº”çš„å¸ƒå°”å€¼ï¼Œç”¨äºæ ‡å¿—æ­¤æ—¶æ˜¯å¦ç”¨æˆ·å·²ç»ç™»å½•
[tuture-del]  const isLogged = !!nickName
[tuture-add]  const dispatch = useDispatch()

  useEffect(() => {
    async function getStorage() {
      // ...
        const { data } = await Taro.getStorage({ key: 'userInfo' })

        const { nickName, avatar } = data
[tuture-del]        setAvatar(avatar)
[tuture-del]        setNickName(nickName)
[tuture-add]
[tuture-add]        // æ›´æ–° Redux Store æ•°æ®
[tuture-add]        dispatch({ type: SET_LOGIN_INFO, payload: { nickName, avatar } })
      } catch (err) {
        console.log('getStorage ERR: ', err)
      }
    // ...
    getStorage()
  })

[tuture-del]  async function setLoginInfo(avatar, nickName) {
[tuture-del]    setAvatar(avatar)
[tuture-del]    setNickName(nickName)
[tuture-del]
[tuture-del]    try {
[tuture-del]      await Taro.setStorage({
[tuture-del]        key: 'userInfo',
[tuture-del]        data: { avatar, nickName },
[tuture-del]      })
[tuture-del]    } catch (err) {
[tuture-del]      console.log('setStorage ERR: ', err)
[tuture-del]    }
[tuture-del]  }
[tuture-del]
[tuture-del]  async function handleLogout() {
[tuture-del]    setIsLogout(true)
[tuture-del]
[tuture-del]    try {
[tuture-del]      await Taro.removeStorage({ key: 'userInfo' })
[tuture-del]
[tuture-del]      setAvatar('')
[tuture-del]      setNickName('')
[tuture-del]    } catch (err) {
[tuture-del]      console.log('removeStorage ERR: ', err)
[tuture-del]    }
[tuture-del]
[tuture-del]    setIsLogout(false)
[tuture-del]  }
[tuture-del]
[tuture-del]  function handleSetIsOpened(isOpened) {
[tuture-del]    setIsOpened(isOpened)
[tuture-del]  }
[tuture-del]
[tuture-del]  function handleClick() {
[tuture-del]    handleSetIsOpened(true)
[tuture-del]  }
[tuture-del]
[tuture-del]  async function handleSubmit(userInfo) {
[tuture-del]    // ç¼“å­˜åœ¨ storage é‡Œé¢
[tuture-del]    await Taro.setStorage({ key: 'userInfo', data: userInfo })
[tuture-del]
[tuture-del]    // è®¾ç½®æœ¬åœ°ä¿¡æ¯
[tuture-del]    setAvatar(userInfo.avatar)
[tuture-del]    setNickName(userInfo.nickName)
[tuture-del]
[tuture-del]    // å…³é—­å¼¹å‡ºå±‚
[tuture-del]    setIsOpened(false)
[tuture-del]  }
[tuture-del]
  return (
    <View className="mine">
[tuture-del]      <Header
[tuture-del]        isLogged={isLogged}
[tuture-del]        userInfo={{ avatar, nickName }}
[tuture-del]        handleClick={handleClick}
[tuture-del]        setLoginInfo={setLoginInfo}
[tuture-del]      />
[tuture-del]      <Footer
[tuture-del]        isLogged={isLogged}
[tuture-del]        isOpened={isOpened}
[tuture-del]        isLogout={isLogout}
[tuture-del]        handleLogout={handleLogout}
[tuture-del]        handleSetIsOpened={handleSetIsOpened}
[tuture-del]        handleSubmit={handleSubmit}
[tuture-del]      />
[tuture-add]      <Header />
[tuture-add]      <Footer />
    </View>
  )
}
 // ...
```

å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„ä»£ç åšäº†ä¸€ä¸‹äº”å¤„æ”¹åŠ¨ï¼š

- æˆ‘ä»¬å¯¼å…¥äº† `useDispatch` Hooks å’Œ `SET_LOGIN_INFO` å¸¸é‡ï¼Œå¹¶æŠŠä¹‹å‰åœ¨ `getStorage` æ–¹æ³•é‡Œé¢è®¾ç½® `nickName` å’Œ `avatar` çš„æ“ä½œæ›¿æ¢æˆäº† dispatch ä¸€ä¸ª `type` ä¸º `SET_LOGIN_INFO` çš„ actionã€‚
- æ¥ç€æˆ‘ä»¬åˆ é™¤ä¸å†éœ€è¦çš„ `formNickName`ã€`files`ã€`isLogout`ã€`isOpened` çŠ¶æ€ï¼Œä»¥åŠ `setLoginInfo`ã€`handleLogout`ã€`handleSetIsOpened`ã€`handleClick` ã€`handleSubmit` æ–¹æ³•ã€‚
- æœ€åæˆ‘ä»¬åˆ é™¤ `Header` å’Œ `Footer` ç»„ä»¶ä¸Šä¸å†ä¸éœ€è¦çš„å±æ€§ã€‚

å¤§åŠŸå‘Šæˆ ğŸ¥ˆï¼è¿™é‡Œç»™ä½ é¢å‘ä¸€ä¸ªé“¶ç‰Œï¼Œä»¥å¥–åŠ±ä½ èƒ½ä¸€ç›´åšæŒé˜…è¯»å¹¶è·Ÿåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬è¿™ä¸€ç¯‡æ•™ç¨‹å¾ˆé•¿å¾ˆé•¿ï¼Œèƒ½è·Ÿä¸‹æ¥çš„éƒ½ä¸å®¹æ˜“ï¼Œå¸Œæœ›ä½ èƒ½åœ¨å¿ƒé‡Œæˆ–ç”¨å®é™…è¡ŒåŠ¨ç»™è‡ªå·±é¼“é¼“æŒ ğŸ‘ã€‚

å°æ†©ä¸€ä¸‹ï¼Œæ¢å¤ç²¾åŠ›ï¼Œæ•´è£…å¾…å‘ï¼å¾ˆå¤šåŒå­¦å¯èƒ½å¾ˆå¥½å¥‡äº†ï¼Œä¸ºä»€ä¹ˆè¿˜åªèƒ½æ‹¿ä¸€ä¸ªé“¶ç‰Œå‘¢ï¼Ÿé‚£æ˜¯å› ä¸ºæˆ‘ä»¬çš„é‡æ„è¿›ç¨‹æ‰èµ°äº†ä¸€åŠå‘€ âœŒï¸ï¼Œä½†æ˜¯ä¸è¦æ‹…å¿ƒï¼Œæˆ‘ä»¬æ‰€æœ‰æ–°çš„ä¸œè¥¿éƒ½å·²ç»è®²å®Œäº†ï¼Œæ¥ä¸‹æ¥å°±åªæ˜¯ä¸€äº›æ”¶å°¾å·¥ä½œäº†ï¼Œå½“ä½ èƒ½åšæŒåˆ°ç»ˆç‚¹çš„æ—¶å€™ï¼Œä¼šæœ‰æƒŠå–œç­‰ç€ä½ å“¦ï¼åŠ æ²¹å§éªšå¹´ ğŸ’ªã€‚

### å¼€å§‹é‡æ„ â€œé¦–é¡µâ€ ä¹‹æ—…

æˆ‘ä»¬ä¾ç„¶æŒ‰ç…§ä¹‹å‰çš„å¥—è·¯ï¼Œä»æœ€åº•å±‚çš„ç»„ä»¶å¼€å§‹é‡æ„ï¼Œé¦–å…ˆæ˜¯æˆ‘ä»¬çš„ç™»å½•æ¡†å¼¹å‡ºå±‚ `LoginForm` ç»„ä»¶ï¼Œè®©æˆ‘ä»¬æ‰“å¼€ `src/components/PostForm/index.jsx` æ–‡ä»¶ï¼Œå¯¹å…¶ä¸­çš„å†…å®¹ä½œå‡ºç›¸åº”çš„ä¿®æ”¹å¦‚ä¸‹ï¼š

```jsx src/components/PostForm/index.jsx https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/components/PostForm/index.jsx æŸ¥çœ‹å®Œæ•´ä»£ç 
[tuture-del]import Taro from '@tarojs/taro'
[tuture-del]import { View, Form, Input, Textarea, Button } from '@tarojs/components'
[tuture-add]import Taro, { useState } from '@tarojs/taro'
[tuture-add]import { View, Form, Input, Textarea } from '@tarojs/components'
import { AtButton } from 'taro-ui'
[tuture-add]import { useDispatch, useSelector } from '@tarojs/redux'

import './index.scss'
[tuture-add]import { SET_POSTS, SET_POST_FORM_IS_OPENED } from '../../constants'

export default function PostForm(props) {
[tuture-add]  const [formTitle, setFormTitle] = useState('')
[tuture-add]  const [formContent, setFormContent] = useState('')
[tuture-add]
[tuture-add]  const nickName = useSelector(state => state.user.nickName)
[tuture-add]  const avatar = useSelector(state => state.user.avatar)
[tuture-add]
[tuture-add]  const dispatch = useDispatch()
[tuture-add]
[tuture-add]  async function handleSubmit(e) {
[tuture-add]    e.preventDefault()
[tuture-add]
[tuture-add]    if (!formTitle || !formContent) {
[tuture-add]      Taro.atMessage({
[tuture-add]        message: 'æ‚¨è¿˜æœ‰å†…å®¹æ²¡æœ‰å¡«å†™å®Œå“¦',
[tuture-add]        type: 'warning',
[tuture-add]      })
[tuture-add]
[tuture-add]      return
[tuture-add]    }
[tuture-add]
[tuture-add]    dispatch({
[tuture-add]      type: SET_POSTS,
[tuture-add]      payload: {
[tuture-add]        post: {
[tuture-add]          title: formTitle,
[tuture-add]          content: formContent,
[tuture-add]          user: { nickName, avatar },
[tuture-add]        },
[tuture-add]      },
[tuture-add]    })
[tuture-add]
[tuture-add]    setFormTitle('')
[tuture-add]    setFormContent('')
[tuture-add]
[tuture-add]    dispatch({
[tuture-add]      type: SET_POST_FORM_IS_OPENED,
[tuture-add]      payload: { isOpened: false },
[tuture-add]    })
[tuture-add]
[tuture-add]    Taro.atMessage({
[tuture-add]      message: 'å‘è¡¨æ–‡ç« æˆåŠŸ',
[tuture-add]      type: 'success',
[tuture-add]    })
[tuture-add]  }
[tuture-add]
  return (
    <View className="post-form">
[tuture-del]      <Form onSubmit={props.handleSubmit}>
[tuture-add]      <Form onSubmit={handleSubmit}>
        <View>
          <View className="form-hint">æ ‡é¢˜</View>
          <Input
            className="input-title"
            type="text"
            placeholder="ç‚¹å‡»è¾“å…¥æ ‡é¢˜"
[tuture-del]            value={props.formTitle}
[tuture-del]            onInput={props.handleTitleInput}
[tuture-add]            value={formTitle}
[tuture-add]            onInput={e => setFormTitle(e.target.value)}
          />
          <View className="form-hint">æ­£æ–‡</View>
          <Textarea
            placeholder="ç‚¹å‡»è¾“å…¥æ­£æ–‡"
            className="input-content"
[tuture-del]            value={props.formContent}
[tuture-del]            onInput={props.handleContentInput}
[tuture-add]            value={formContent}
[tuture-add]            onInput={e => setFormContent(e.target.value)}
          />
          <AtButton formType="submit" type="primary">
            æäº¤
          // ...
```

è¿™ä¸ªæ–‡ä»¶çš„å½¢å¼å’Œæˆ‘ä»¬ä¹‹å‰çš„ `src/components/LoginForm/index.jsx` æ–‡ä»¶ç±»ä¼¼ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¸Šé¢çš„æ–‡ä»¶ä¸­ä¸»è¦æœ‰å››å¤„æ”¹åŠ¨ï¼š

- é¦–å…ˆæˆ‘ä»¬å°† `formTitle` å’Œ `formContent ` ç­‰çŠ¶æ€æ”¾ç½®åˆ° `PostForm` ç»„ä»¶å†…éƒ¨ï¼Œå¹¶ä½¿ç”¨ `useState` Hooks ç®¡ç†èµ·æ¥ï¼Œå› ä¸ºå®ƒä»¬åªå’Œæ­¤ç»„ä»¶æœ‰å…³ç³»ã€‚
- æ¥ç€ï¼Œæˆ‘ä»¬å°† `Input ` é‡Œé¢çš„ `props.formTitle` æ›¿æ¢æˆ `formTitle`ï¼Œå°†å®ƒçš„ `onInput ` å›è°ƒå‡½æ•°å†…éƒ¨çš„è®¾ç½®æ”¹å˜çŠ¶æ€çš„ `props. handleTitleInput` æ›¿æ¢æˆ `setFormTitle(e.target.value)` çš„å›è°ƒå‡½æ•°ã€‚
- æ¥ç€ï¼Œæˆ‘ä»¬å°† `Textarea ` ç»„ä»¶çš„ `props. formContent ` æ›¿æ¢æˆ `formContent `ï¼Œå°†ä¹‹å‰ `onInput` æ¥æ”¶çš„å›è°ƒå‡½æ•°æ¢æˆäº† `setFormContent ` çš„å½¢å¼æ¥è®¾ç½® `formContent` çš„å˜åŒ–ã€‚
- æœ€åï¼Œæˆ‘ä»¬å°†ä¹‹å‰æäº¤è¡¨å•éœ€è¦è°ƒç”¨çš„çˆ¶ç»„ä»¶æ–¹æ³• `props.handleSubmit` ç§»åŠ¨åˆ°ç»„ä»¶å†…éƒ¨æ¥å®šä¹‰ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ª `hanldeSubmit` å’Œæˆ‘ä»¬ä¹‹å‰å®šä¹‰åœ¨ `src/pages/index/index.js` ç»„ä»¶é‡Œçš„ `handleSubmit` é€»è¾‘ç±»ä¼¼ï¼š
- æ¥ç€è¿›è¡Œæ•°æ®éªŒè¯ï¼Œä¸åˆè¦æ±‚çš„æ•°æ®å°±ä¼šè¢«é©³å›å¹¶æ˜¾ç¤ºè­¦å‘Šï¼ˆè¿™é‡Œæˆ‘ä»¬åˆæ˜¾ç¤ºå¯¹äº† ğŸ˜…ï¼‰ã€‚
- æ¥ç€ dispatch ä¸€ä¸ª `type` ä¸º `SET_POSTS` çš„ actionï¼Œå°†æ–°å‘è¡¨çš„ post æ·»åŠ åˆ° Redux store å¯¹åº”çš„ `posts` æ•°ç»„ä¸­ã€‚æˆ‘ä»¬æ³¨æ„åˆ°è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ `useSelector` Hooks ä» Redux store é‡Œé¢è·å–äº† `nickName` å’Œ `avatar` å±æ€§ï¼Œå¹¶æŠŠå®ƒä»¬ç»„åˆåˆ° `post.user` å±æ€§é‡Œï¼Œéšç€ action çš„ payload ä¸€èµ·è¢« dispatchï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ª `user` å±æ€§æ ‡å¿—å‘å¸–çš„ç”¨æˆ·å±æ€§ã€‚
- æ¸…ç©ºè¡¨å•çŠ¶æ€ã€‚
- æ¥ç€æˆ‘ä»¬ dispatch ä¸€ä¸ª `type` ä¸º `SET_POST_FORM_IS_OPENED ` çš„ action ç”¨æ¥æ›´æ–° `isOpened` å±æ€§ï¼Œå®ƒå°†å…³é—­å±•ç¤ºå‘è¡¨å¸–å­çš„è¡¨å•å¼¹å‡ºå±‚ `FloatLayout` ç»„ä»¶ã€‚
- æœ€åæç¤ºå‘å¸–æˆåŠŸã€‚

æ¥ç€æ˜¯æˆ‘ä»¬ â€œé¦–é¡µâ€ é¡µé¢ç»„ä»¶å¦å¤–ä¸€ä¸ªåº•å±‚å­ç»„ä»¶ `PostCard`ï¼Œå®ƒä¸»è¦ç”¨äºå±•ç¤ºä¸€ä¸ªå¸–å­ï¼Œè®©æˆ‘ä»¬ `src/components/PostCard/index.jsx` æ–‡ä»¶ï¼Œå¯¹å…¶ä¸­çš„å†…å®¹ä½œå‡ºå¯¹åº”çš„ä¿®æ”¹å¦‚ä¸‹ï¼š

```jsx src/components/PostCard/index.jsx https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/components/PostCard/index.jsx æŸ¥çœ‹å®Œæ•´ä»£ç 
import Taro from '@tarojs/taro'
import { View } from '@tarojs/components'
import classNames from 'classnames'
[tuture-add]import { AtAvatar } from 'taro-ui'

import './index.scss'

export default function PostCard(props) {
[tuture-add]  // æ³¨æ„ï¼š
[tuture-add]  const { title = '', content = '', user } = props.post
[tuture-add]  const { avatar, nickName } = user || {}
[tuture-add]
  const handleClick = () => {
    // å¦‚æœæ˜¯åˆ—è¡¨ï¼Œé‚£ä¹ˆå°±å“åº”ç‚¹å‡»äº‹ä»¶ï¼Œè·³è½¬åˆ°å¸–å­è¯¦æƒ…
    if (props.isList) {
[tuture-del]      const { title, content } = this.props
      Taro.navigateTo({
[tuture-del]        url: `/pages/post/post?title=${title}&content=${content}`,
[tuture-add]        url: `/pages/post/post?postId=${props.postId}`,
      })
    }
  }

[tuture-add]  const slicedContent =
[tuture-add]    props.isList && content.length > 66
[tuture-add]      ? `${content.slice(0, 66)} ...`
[tuture-add]      : content
[tuture-add]
  return (
    <View
[tuture-del]      className={classNames('postcard', { postcard__isList: props.isList })}
[tuture-add]      className={classNames('at-article', { postcard__isList: props.isList })}
      onClick={handleClick}
    >
[tuture-del]      <View className="post-title">{props.title}</View>
[tuture-del]      <View className="post-content">{props.content}</View>
[tuture-add]      <View className="post-header">
[tuture-add]        <View className="at-article__h1">{title}</View>
[tuture-add]        <View className="profile-box">
[tuture-add]          <AtAvatar circle size="small" image={avatar} />
[tuture-add]          <View className="at-article__info post-nickName">{nickName}</View>
[tuture-add]        </View>
[tuture-add]      </View>
[tuture-add]      <View className="at-article__content">
[tuture-add]        <View className="at-article__section">
[tuture-add]          <View className="at-article__p">{slicedContent}</View>
[tuture-add]        </View>
[tuture-add]      </View>
    </View>
  )
}

PostCard.defaultProps = {
  isList: '',
[tuture-add]  post: [],
}
```

å¯ä»¥çœ‹åˆ°è¿™ä¸ªç»„ä»¶åŸºæœ¬ä¸ä¿æœ‰è‡ªå·±çš„çŠ¶æ€ï¼Œå®ƒæ¥æ”¶æ¥è‡ªçˆ¶ç»„ä»¶çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å¯¹å®ƒçš„ä¿®æ”¹ä¸»è¦æœ‰ä¸‹é¢äº”ä¸ªéƒ¨åˆ†ï¼š

- å°†ä¹‹å‰çš„ç›´æ¥è·å– `props.title` å’Œ `props.content` æ”¾åˆ°äº† `props.post` å±æ€§ä¸­ï¼Œæˆ‘ä»¬ä» `props.post` å±æ€§ä¸­å¯¼å‡ºæˆ‘ä»¬éœ€è¦å±•ç¤ºçš„ `title` å’Œ `content`ï¼Œè¿˜è¦ä¸€ä¸ªé¢å¤–çš„ `user` å±æ€§ï¼Œå®ƒåº”è¯¥æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¿å­˜ç€å‘å¸–äººçš„ç”¨æˆ·å±æ€§ï¼Œæˆ‘ä»¬ä½¿ç”¨è§£æ„çš„æ–¹æ³•è·å– `user.avatar` å’Œ `user.nickName` çš„å€¼ã€‚
- æ¥ç€æˆ‘ä»¬çœ‹åˆ° `return` çš„ç»„ä»¶ç»“æ„å‘ç”Ÿäº†å¾ˆå¤§çš„å˜åŒ–ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸ºäº†æ–¹ä¾¿ï¼Œä½¿ç”¨äº† `taro-ui` æä¾›ç»™æˆ‘ä»¬çš„ `Article` æ–‡ç« æ ·å¼ç»„ä»¶ï¼Œç”¨äºå±•ç¤ºç±»ä¼¼å¾®ä¿¡å…¬ä¼—å·æ–‡ç« é¡µçš„ä¸€äº›æ ·å¼ï¼Œå¯ä¾›ç”¨æˆ·å¿«é€Ÿ  å‘ˆç°æ–‡ç« å†…å®¹ï¼Œå¯ä»¥è¯¦æƒ…å¯ä»¥æŸ¥çœ‹ [taro-ui é“¾æ¥](https://taro-ui.jd.com/#/docs/article)ï¼Œæœ‰äº† `taro-ui` åŠ æŒï¼Œæˆ‘ä»¬å°±é¢å¤–çš„å±•ç¤ºäº†å‘è¡¨æ­¤æ–‡ç« çš„ç”¨æˆ·å¤´åƒï¼ˆ`avatar`ï¼‰å’Œæ˜µç§°ï¼ˆ`nickName`ï¼‰ã€‚
- æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬å¯¹åŸ `content` åšäº†ä¸€ç‚¹ä¿®æ”¹ï¼Œå½“ `PostCard` ç»„ä»¶åœ¨æ–‡ç« åˆ—è¡¨ä¸­è¢«å¼•ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯¹å†…å®¹é•¿åº¦è¿›è¡Œæˆªæ–­ï¼Œå½“è¶…è¿‡ 66 å­—ç¬¦æ—¶ï¼Œæˆ‘ä»¬å°±æˆªæ–­å®ƒï¼Œå¹¶åŠ ä¸Šçœç•¥å· `...`ã€‚
- æœ€åï¼Œæˆ‘ä»¬æ”¹åŠ¨äº† `handleClick` æ–¹æ³•ï¼Œä¹‹å‰æ˜¯åœ¨è·³è½¬è·¯ç”±çš„é¡µé¢è·¯å¾„é‡Œç›´æ¥å¸¦ä¸ŠæŸ¥è¯¢å‚æ•° `title` å’Œ `content` ï¼Œå½“æˆ‘ä»¬è¦ä¼ é€’çš„å†…å®¹å¤šäº†ï¼Œè¿™ä¸ªè·¯å¾„å°±ä¼šæ˜¾å¾—å¾ˆè‡ƒè‚¿ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¼ é€’æ­¤æ–‡ç« å¯¹åº”çš„ `id`ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡æ­¤ `id` å–åˆ°å®Œæ•´çš„ `post` æ•°æ®ï¼Œä½¿è·¯å¾„ä¿æŒç®€æ´ï¼Œè¿™ä¹Ÿæ˜¯æœ€ä½³å®è·µçš„æ¨èåšæ³•ã€‚

æ¥ç€æˆ‘ä»¬è¡¥å……ä¸€ä¸‹åœ¨ `PostCard` ç»„ä»¶é‡Œé¢ä¼šç”¨åˆ°çš„æ ·å¼ï¼Œæ‰“å¼€ `src/components/PostCard/index.scss` æ–‡ä»¶ï¼Œè¡¥å……å’Œæ”¹è¿›å¯¹åº”çš„æ ·å¼å¦‚ä¸‹ï¼š

```scss src/components/PostCard/index.scss https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/components/PostCard/index.scss æŸ¥çœ‹å®Œæ•´ä»£ç 
[tuture-add]@import '~taro-ui/dist/style/components/article.scss';
[tuture-add]
.postcard {
  margin: 30px;
  padding: 20px;
}

.postcard__isList {
[tuture-del]  border: 1px solid #ddd;
[tuture-add]  border-bottom: 1px solid #ddd;
[tuture-add]  padding-bottom: 20px;
[tuture-add]}
[tuture-add]
[tuture-add].post-header {
[tuture-add]  display: flex;
[tuture-add]  flex-direction: column;
[tuture-add]  align-items: center;
}

[tuture-del].post-title {
[tuture-del]  font-weight: bolder;
[tuture-del]  margin-bottom: 10px;
[tuture-add].profile-box {
[tuture-add]  display: flex;
[tuture-add]  flex-direction: row;
[tuture-add]  align-items: center;
}

[tuture-del].post-content {
[tuture-del]  font-size: medium;
[tuture-del]  color: #666;
[tuture-add].post-nickName {
[tuture-add]  color: #777;
}
```

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ›´æ–°äº†ä¸€äº›æ ·å¼ï¼Œç„¶åå¼•å…¥äº† `taro-ui` æä¾›ç»™æˆ‘ä»¬çš„ `article` æ–‡ç« æ ·å¼ã€‚

é‡æ„å®Œ â€œé¦–é¡µâ€ é¡µé¢ç»„ä»¶çš„æ‰€æœ‰åº•å±‚ç»„ä»¶ï¼Œæˆ‘ä»¬å¼€å§‹å®Œæˆæœ€ç»ˆçš„é¡¶å±‚ç»„ä»¶ï¼Œæ‰“å¼€ `src/pages/index/index.jsx` æ–‡ä»¶ï¼Œå¯¹ç›¸åº”çš„å†…å®¹ä¿®æ”¹å¦‚ä¸‹ï¼š

```jsx src/pages/index/index.jsx https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/pages/index/index.jsx æŸ¥çœ‹å®Œæ•´ä»£ç 
[tuture-del]import Taro, { useState } from '@tarojs/taro'
[tuture-del]import { View } from '@tarojs/components'
[tuture-add]import Taro, { useEffect } from '@tarojs/taro'
[tuture-add]import { View, Text } from '@tarojs/components'
import { AtFab, AtFloatLayout, AtMessage } from 'taro-ui'
[tuture-add]import { useSelector, useDispatch } from '@tarojs/redux'

import { PostCard, PostForm } from '../../components'
import './index.scss'
[tuture-add]import { SET_POST_FORM_IS_OPENED, SET_LOGIN_INFO } from '../../constants'

export default function Index() {
[tuture-del]  const [posts, setPosts] = useState([
[tuture-del]    {
[tuture-del]      title: 'æ³°ç½—å¥¥ç‰¹æ›¼',
[tuture-del]      content: 'æ³°ç½—æ˜¯å¥¥ç‰¹ä¹‹çˆ¶å’Œå¥¥ç‰¹ä¹‹æ¯å”¯ä¸€çš„äº²ç”Ÿå„¿å­ã€‚',
[tuture-del]    },
[tuture-del]  ])
[tuture-del]  const [formTitle, setFormTitle] = useState('')
[tuture-del]  const [formContent, setFormContent] = useState('')
[tuture-del]  const [isOpened, setIsOpened] = useState(false)
[tuture-add]  const posts = useSelector(state => state.post.posts) || []
[tuture-add]  const isOpened = useSelector(state => state.post.isOpened)
[tuture-add]  const nickName = useSelector(state => state.user.nickName)

[tuture-del]  function handleSubmit(e) {
[tuture-del]    e.preventDefault()
[tuture-add]  const isLogged = !!nickName

[tuture-del]    const newPosts = posts.concat({ title: formTitle, content: formContent })
[tuture-del]    setPosts(newPosts)
[tuture-del]    setFormTitle('')
[tuture-del]    setFormContent('')
[tuture-del]    setIsOpened(false)
[tuture-add]  const dispatch = useDispatch()

[tuture-del]    Taro.atMessage({
[tuture-del]      message: 'å‘è¡¨æ–‡ç« æˆåŠŸ',
[tuture-del]      type: 'success',
[tuture-del]    })
[tuture-add]  useEffect(() => {
[tuture-add]    async function getStorage() {
[tuture-add]      try {
[tuture-add]        const { data } = await Taro.getStorage({ key: 'userInfo' })
[tuture-add]
[tuture-add]        const { nickName, avatar } = data
[tuture-add]
[tuture-add]        // æ›´æ–° Redux Store æ•°æ®
[tuture-add]        dispatch({ type: SET_LOGIN_INFO, payload: { nickName, avatar } })
[tuture-add]      } catch (err) {
[tuture-add]        console.log('getStorage ERR: ', err)
[tuture-add]      }
[tuture-add]    }
[tuture-add]
[tuture-add]    getStorage()
[tuture-add]  })
[tuture-add]
[tuture-add]  function setIsOpened(isOpened) {
[tuture-add]    dispatch({ type: SET_POST_FORM_IS_OPENED, payload: { isOpened } })
  }

[tuture-add]  function handleClickEdit() {
[tuture-add]    if (!isLogged) {
[tuture-add]      Taro.atMessage({
[tuture-add]        type: 'warning',
[tuture-add]        message: 'æ‚¨è¿˜æœªç™»å½•å“¦ï¼',
[tuture-add]      })
[tuture-add]    } else {
[tuture-add]      setIsOpened(true)
[tuture-add]    }
[tuture-add]  }
[tuture-add]
[tuture-add]  console.log('posts', posts)
[tuture-add]
  return (
    <View className="index">
      <AtMessage />
      {posts.map((post, index) => (
[tuture-del]        <PostCard
[tuture-del]          key={index}
[tuture-del]          title={post.title}
[tuture-del]          content={post.content}
[tuture-del]          isList
[tuture-del]        />
[tuture-add]        <PostCard key={index} postId={index} post={post} isList />
      ))}
      <AtFloatLayout
        isOpened={isOpened}
        title="å‘è¡¨æ–°æ–‡ç« "
        onClose={() => setIsOpened(false)}
      >
[tuture-del]        <PostForm
[tuture-del]          formTitle={formTitle}
[tuture-del]          formContent={formContent}
[tuture-del]          handleSubmit={e => handleSubmit(e)}
[tuture-del]          handleTitleInput={e => setFormTitle(e.target.value)}
[tuture-del]          handleContentInput={e => setFormContent(e.target.value)}
[tuture-del]        />
[tuture-add]        <PostForm />
      </AtFloatLayout>
      <View className="post-button">
[tuture-del]        <AtFab onClick={() => setIsOpened(true)}>
[tuture-add]        <AtFab onClick={handleClickEdit}>
          <Text className="at-fab__icon at-icon at-icon-edit"></Text>
        </AtFab>
      </View>
    // ...
```

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¸Šé¢çš„å†…å®¹æœ‰ä»¥ä¸‹äº”å¤„æ”¹åŠ¨ï¼š

- é¦–å…ˆæˆ‘ä»¬å¯¼å‡ºäº† `useSelector` é’©å­ï¼Œç„¶åä» Redux store ä¸­è·å–äº† `posts` ã€`isOpened` å’Œ `nickName` ç­‰å±æ€§ã€‚
- æ¥ç€ï¼Œæˆ‘ä»¬å°†ä¹‹å‰å®šä¹‰åœ¨ `PostCard` ç»„ä»¶ä¸Šçš„å±æ€§è¿›è¡Œäº†ä¸€æ¬¡æ¢è¡€ï¼Œä¹‹å‰æ˜¯ç›´æ¥ä¼ é€’ `title` å’Œ `content` å±æ€§ï¼Œç°åœ¨æˆ‘ä»¬ä¼ é€’æ•´ä¸ª `post` å±æ€§ï¼Œå¹¶ä¸”é¢å¤–ä¼ é€’äº†ä¸€ä¸ª `postId` å±æ€§ï¼Œç”¨äºåœ¨ `PostCard` é‡Œé¢ç‚¹å‡»è·³è½¬è·¯ç”±æ—¶è¿›è¡Œæ ‡æ³¨ã€‚
- æ¥ç€ï¼Œæˆ‘ä»¬å»æ‰ `PostForm` ç»„ä»¶ä¸Šé¢çš„æ‰€æœ‰å±æ€§ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åœ¨ç»„ä»¶å†…éƒ¨å®šä¹‰äº†å®ƒä»¬ã€‚
- æ¥ç€ï¼Œæˆ‘ä»¬ä½¿ç”¨ `useEffect` Hooksï¼Œåœ¨é‡Œé¢å®šä¹‰å¹¶è°ƒç”¨äº† `getStorage` æ–¹æ³•ï¼Œè·å–äº†æˆ‘ä»¬ä¿å­˜åœ¨ `storage` é‡Œé¢çš„ç”¨æˆ·ç™»å½•ä¿¡æ¯ï¼Œå¦‚æœç”¨æˆ·ç™»å½•äº†ï¼Œæˆ‘ä»¬ dispatch ä¸€ä¸ª `type` ä¸º `SET_LOGIN_INFO` çš„ actionï¼Œå°†è¿™ä»½ç™»å½•ä¿¡æ¯ä¿å­˜åœ¨ Redux store é‡Œé¢ä»¥ä¾›åç»­ä½¿ç”¨ã€‚
- æœ€åï¼Œæˆ‘ä»¬å°† `AtFab` çš„ `onClick` å›è°ƒå‡½æ•°æ›¿æ¢æˆ `handleClickEdit`ï¼Œåœ¨å…¶ä¸­å¯¹ç”¨æˆ·ç‚¹å‡»è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœç”¨æˆ·æœªç™»å½•ï¼Œé‚£ä¹ˆå¼¹å‡ºè­¦å‘Šï¼Œå‘ŠçŸ¥ç”¨æˆ·ï¼Œå¦‚æœç”¨æˆ·å·²ç»ç™»å½•ï¼Œé‚£ä¹ˆå°± dispatch ä¸€ä¸ª `type` ä¸º `SET_POST_FORM_IS_OPENED` çš„ action å»è®¾ç½® `isOpened` å±æ€§ï¼Œæ‰“å¼€å‘å¸–çš„å¼¹å‡ºå±‚ï¼Œå…è®¸ç”¨æˆ·è¿›è¡Œå‘å¸–æ“ä½œã€‚

### ä»¥é‡æ„ â€œæ–‡ç« è¯¦æƒ…â€ é¡µç»“æŸ

æœ€åï¼Œè®©æˆ‘ä»¬åšæŒä¸€ä¸‹ï¼Œè·‘èµ¢é‡æ„å·¥ä½œçš„æœ€åä¸€å…¬é‡Œ ğŸ’ªï¼å®Œæˆ â€œæ–‡ç« è¯¦æƒ…â€ é¡µçš„é‡æ„ã€‚

è®©æˆ‘ä»¬æ‰“å¼€ `src/pages/post/post.jsx` æ–‡ä»¶ï¼Œå¯¹å…¶ä¸­çš„å†…å®¹ä½œå‡ºç›¸åº”çš„ä¿®æ”¹å¦‚ä¸‹ï¼š

```jsx src/pages/post/post.jsx https://github.com/tuture-dev/ultra-club/blob/a3cf715/src/pages/post/post.jsx æŸ¥çœ‹å®Œæ•´ä»£ç 
import Taro, { useRouter } from '@tarojs/taro'
import { View } from '@tarojs/components'
[tuture-del]import { PostCard } from '../../components'
[tuture-add]import { useSelector } from '@tarojs/redux'

[tuture-add]import { PostCard } from '../../components'
import './post.scss'

export default function Post() {
  const router = useRouter()
[tuture-del]  const { params } = router
[tuture-add]  const { postId } = router.params
[tuture-add]
[tuture-add]  const posts = useSelector(state => state.post.posts)
[tuture-add]  const post = posts[postId]
[tuture-add]
[tuture-add]  console.log('posts', posts, postId)

  return (
    <View className="post">
[tuture-del]      <PostCard title={params.title} content={params.content} />
[tuture-add]      <PostCard post={post} />
    </View>
  )
}
 // ...
```

å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„æ–‡ä»¶åšäº†ä»¥ä¸‹å››å¤„ä¿®æ”¹ï¼š

- æˆ‘ä»¬ä» `router.params` ä¸­å¯¼å‡ºäº† `postId`ï¼Œå› ä¸ºä¹‹å‰æˆ‘ä»¬åœ¨ `PostCard` é‡Œé¢ç‚¹å‡»è·³è½¬çš„è·¯å¾„å‚æ•°ä½¿ç”¨äº† `postId`ã€‚
- æ¥ç€æˆ‘ä»¬å¯¼å…¥å¹¶ä½¿ç”¨ `useSelector` Hooks è·å–äº†ä¿å­˜åœ¨ Redux store ä¸­çš„ `posts` å±æ€§ï¼Œç„¶åä½¿ç”¨ä¸Šä¸€æ­¥è·å–åˆ°çš„ `postId`ï¼Œæ¥è·å–æˆ‘ä»¬æœ€ç»ˆè¦æ¸²æŸ“çš„ `post` å±æ€§ã€‚
- æœ€åï¼Œæˆ‘ä»¬å°†ä¼ ç»™ `PostCard` çš„å±æ€§æ”¹æˆä¸Šä¸€æ­¥è·å–åˆ°çš„ `post` ã€‚

{% note warning %}
**æ³¨æ„**

è¿™é‡Œçš„ `console.log` æ˜¯è°ƒè¯•æ—¶ä½¿ç”¨çš„ï¼Œç”Ÿäº§ç¯å¢ƒä¸­å»ºè®®åˆ æ‰ã€‚
{% endnote %}

### æŸ¥çœ‹æ•ˆæœ

å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æœªç™»å½•çŠ¶æ€ä¸‹ï¼Œä¼šæç¤ºè¯·ç™»å½•ï¼š

![](https://static.powerformer.com/c/34a473b/16f5496be4b20794.gif)

åœ¨å·²ç™»å½•çš„æƒ…å†µä¸‹ï¼Œå‘å¸–å­ä¼šæ˜¾ç¤ºå½“å‰ç™»å½•ç”¨æˆ·çš„å¤´åƒå’Œæ˜µç§°ï¼š

![](https://static.powerformer.com/c/34a473b/16f5494e116f47f6.gif)

### å°ç»“

æœ‰å¹¸ï¼åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ Redux é‡æ„ä¹‹æ—…çš„ä¸‡é‡Œé•¿å¾å°±è·‘å®Œäº†ï¼è®©æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹æˆ‘ä»¬åœ¨è¿™ä¸€å°èŠ‚ä¸­å­¦åˆ°äº†é‚£äº›ä¸œè¥¿ã€‚

- é¦–å…ˆæˆ‘ä»¬è®²è§£äº†ä½¿ç”¨ Redux çš„åˆè¡·ï¼Œæ¥ç€æˆ‘ä»¬å®‰è£…äº†ç›¸å…³ä¾èµ–ï¼Œç„¶åå¼•å‡ºäº† Redux ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µï¼šStoreã€Actionã€Reducersï¼Œæ¥ç€æˆ‘ä»¬åˆ›å»ºäº†åº”ç”¨éœ€è¦çš„ä¸¤ä¸ª Reducerï¼š`post` å’Œ `user`ï¼›æ¥ç€æˆ‘ä»¬å°†å°† Redux å’Œ React æ•´åˆèµ·æ¥ï¼›å› ä¸º Action æ˜¯ä»ç»„ä»¶ä¸­ dispatch å‡ºæ¥äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥ä¸‹æ¥å°±å¼€å§‹äº†ç»„ä»¶çš„é‡æ„ä¹‹æ—…ã€‚
- åœ¨é‡æ„ â€œæˆ‘çš„â€ é¡µé¢ç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬æŒ‰ç…§ Redux çš„æ€æƒ³ï¼Œä»å®ƒçš„åº•å±‚ç»„ä»¶ä¸‰ä¸ªç™»å½•æŒ‰é’®é‡æ„å¼€å§‹ï¼Œæ¥ç€é‡æ„äº† `LoggedMine` ç»„ä»¶ï¼Œå†å¾€ä¸Šå°±æ˜¯ `Header` ç»„ä»¶ï¼›é‡æ„å®Œ `Header` ç»„ä»¶ä¹‹åï¼Œæˆ‘ä»¬æ¥ç€ä» `Footer` ç»„ä»¶çš„åº•å±‚ç»„ä»¶ `Logout` ç»„ä»¶å¼€å§‹é‡æ„ï¼Œç„¶åé‡æ„äº† `LoginForm` ç»„ä»¶ï¼Œæœ€åæ˜¯ `Footer` ç»„ä»¶ï¼Œé‡æ„å®Œ `Header` å’Œ `Footer` ç»„ä»¶ï¼Œæˆ‘ä»¬å¼€å§‹é‡æ„å…¶ä¸Šå±‚ç»„ä»¶ `mine` é¡µé¢ç»„ä»¶ï¼Œè‡ªæ­¤æˆ‘ä»¬å°±å®Œæˆäº† â€œæˆ‘çš„â€ é¡µé¢çš„é‡æ„ã€‚
- åœ¨é‡æ„ â€œé¦–é¡µâ€ é¡µé¢ç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬åŒæ ·æŒ‰ç…§ Redux çš„æ€æƒ³ï¼Œä»å®ƒçš„åº•å±‚ç»„ä»¶ `PostForm` ç»„ä»¶å¼€å§‹ï¼Œæ¥ç€æ˜¯ `PostCard` ç»„ä»¶ï¼Œæœ€åå†å›åˆ°é¡¶å±‚ç»„ä»¶ `index` é¦–é¡µé¡µé¢ç»„ä»¶ã€‚

åœ¨é‡æ„ â€œå¸–å­è¯¦æƒ…â€ é¡µé¢ç»„ä»¶æ—¶ï¼Œå› ä¸ºå…¶åº•å±‚ç»„ä»¶ `PostCard` å·²ç»é‡æ„è¿‡äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç›´æ¥é‡æ„äº† `post` å¸–å­è¯¦æƒ…é¡µé¢ç»„ä»¶ã€‚

èƒ½è·Ÿç€è¿™ä¹ˆé•¿çš„æ–‡ç« åšæŒåˆ°è¿™é‡Œï¼Œæˆ‘æƒ³ç»™ä½ é¼“ä¸ªæŒï¼Œä¹Ÿå¸Œæœ›ä½ èƒ½ç»™è‡ªå·±é¼“ä¸ªæŒï¼Œæˆ‘æƒ³ï¼Œæˆ‘å¯ä»¥éå¸¸è‚¯å®šä¸”è‡ªè±ªçš„é¢å¸ƒç»™ä½ ç¬¬ä¸€åçš„å¥–ç« äº† ğŸ¥‡ã€‚

ç»ˆäºï¼Œè¿™æ¼«é•¿çš„ç¬¬å››ç¯‡ç»“æŸäº†ã€‚åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ¥è§¦å°ç¨‹åºäº‘åå°å¼€å‘ï¼Œå¹¶åœ¨å‰ç«¯æ¥å…¥åå°æ•°æ®ã€‚
