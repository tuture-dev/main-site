<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <meta name="keywords" content="图雀社区,Tuture,Vue.js实战教程,微信小程序,Kotlin,React Native,Webpack,MVVM,React.js,Node.js,Redux,Django,MongoDB,Docker,JavaScript,Java,Go,Kubernetes,Nuxt,vue-router,react-router,小程序,跨端开发,Taro,react hooks,redux-saga,learn by doing,Web 前端实战教程,后端实战教程,小程序实战教程,移动端实战教程">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=7.4.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222">
  <link rel="manifest" href="/images/manifest.json">
  <meta name="msapplication-config" content="/images/browserconfig.xml">
  <link rel="alternate" href="/atom.xml" title="图雀社区" type="application/atom+xml">
  <meta name="google-site-verification" content="uDCHIeBD5phhUIjsHM8GYeoNBYWJuQIJBjgchamUcAI">
  <meta name="yandex-verification" content="90341ba6c811f41d">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.4.0',
    exturl: true,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":true,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":true,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: true,
    pangu: true,
    algolia: {
      appID: '73BSUE4RKU',
      apiKey: '0b7cce26a4734cb760080065b3c4a4a1',
      indexName: 'Tuture',
      hits: {"per_page":10},
      labels: {"input_placeholder":"搜索教程","hits_empty":"我们找不到你搜索的教程: ${query}","hits_stats":"在 ${time} ms 内找到 ${hits} 条结果"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="前面五篇教程我们已经基本实现了迷你全栈电商应用的界面展示以及功能逻辑，相信大家在这个过程中都收获颇丰，并且迈向了全栈工程师的第一步。但是我们却并不满足于此，我们还需要对我们的项目代码进行优化，使得我们的代码可读性更高，也更好维护。相信细心的你们已经感觉到了项目中的store实例实在是过于臃肿，因此，本篇教程就是带大家一起学习如何抽出 Getters 、 Mutations 和Actions 逻辑实">
<meta property="og:type" content="article">
<meta property="og:title" content="从零到部署：用 Vue 和 Express 实现迷你全栈电商应用（六）">
<meta property="og:url" content="https://tuture.co/2020/03/03/-Oixkkq/index.html">
<meta property="og:site_name" content="图雀社区">
<meta property="og:description" content="前面五篇教程我们已经基本实现了迷你全栈电商应用的界面展示以及功能逻辑，相信大家在这个过程中都收获颇丰，并且迈向了全栈工程师的第一步。但是我们却并不满足于此，我们还需要对我们的项目代码进行优化，使得我们的代码可读性更高，也更好维护。相信细心的你们已经感觉到了项目中的store实例实在是过于臃肿，因此，本篇教程就是带大家一起学习如何抽出 Getters 、 Mutations 和Actions 逻辑实">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://static.powerformer.com/c/092faf4/cover-6.jpg">
<meta property="article:published_time" content="2020-03-02T16:00:00.509Z">
<meta property="article:modified_time" content="2021-07-11T07:16:33.909Z">
<meta property="article:author" content="图雀社区">
<meta property="article:tag" content="Vue">
<meta property="article:tag" content="Vuex">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://static.powerformer.com/c/092faf4/cover-6.jpg">
  <link rel="canonical" href="https://tuture.co/2020/03/03/-Oixkkq/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>从零到部署：用 Vue 和 Express 实现迷你全栈电商应用（六） | 图雀社区</title>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-124499211-1"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-124499211-1');
    }
  </script>








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  <style>
    span.line.tuture-add {
      font-weight: bold;
    }

    span.line.tuture-del {
      opacity: 0.3;
    }

    .profileBox {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }

    .profileBox i {
      display: none;
    }

    .profileBox p {
      margin: 0;
      padding: 0;
    }

    .avatarBox {
      min-width: 60px;
    }

    .avatarBox .avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      margin: 0;
    }

    .avatarBox .avatar:hover {
      cursor: pointer;
    }

    .avatarBox {
      margin-right: 20px;
    }

    .rightBox {
      display:flex;
      flex-direction: row;
      justify-content: flex-start;
      align-items: center;
    }

    .infoBox {
      min-width: 100px;
    }

    .infoBox p {
      padding: 0;
      margin: 0;
    }

    .infoBox .nickName {
      font-weight: bold;
      font-size: 20px;
      color: #979797;
      text-decoration: none;
    }

    .infoBox .nickName:hover {
      cursor: pointer;
    }

    .infoBox .motto {
      font-size: 16px;
      color: #979797;
    }

    .codeBox {
      margin-left: 49px;
      min-width: 100px;
    }

    .codeBox a {
      text-decoration: none;
    }

    .codeBox .exturl {
      border: none;
    }

    .codeBox span.codeText {
      display: inline-block;
      width: 100px;
      height: 40px;
      border-radius: 4px;
      border: 1px solid #979797;
      color: #979797;
      text-align: center;
      line-height: 40px;
      text-decoration: none;;
      transition: all 0.2s ease-in-out;
    }

    .codeBox .codeText:hover {
      cursor: pointer;
      background-color: #979797;
      color: #ffffff;
    }

    @media screen and (max-width:652px) {
      .profileBox {
        align-items: center;
        flex-direction: column;
      }

      .infoBox {
        margin-bottom: 20px;
      }

      .infoBox .nickName {
        text-align: center;
      }

      .rightBox {
        flex-direction: column;
        align-items: flex-start;
      }

      .codeBox {
        margin-left: 0;
      }

      .avatarBox {
        margin-right: 0;
      }
    }

    @media screen and (max-width:500px) {
      .rightBox {
        align-items: center;
      }

      .infoBox {
        margin-bottom: 20px;
      }

      .infoBox .nickName {
        text-align: center;
      }

      .infoBox .motto {
        text-align: center;
      }
    }

    .vsys {
      display:none !important;
      }

      figcaption .exturl {
        float: right;
      }
  </style>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/styles/default.min.css">
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <div class="container">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">图雀社区</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">汇集精彩的实战技术教程</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    
      
      
        
      
        
      
        
      
        
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    
      
      
        
      
        
      
        
          
        
      
        
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">45</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    
      
      
        
      
        
          
        
      
        
      
        
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">22</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    
      
      
        
          
        
      
        
      
        
      
        
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">58</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-早报">
      
    
      
      
        
      
        
      
        
      
        
      
    

    <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvZGFpbHk="><i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>早报</span>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    
      
      
        
      
        
      
        
      
        
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-文档">
      
    
      
      
        
      
        
      
        
      
        
      
    

    <span class="exturl" data-url="aHR0cHM6Ly93d3cueXVxdWUuY29tL3R1dHVyZS9wcm9kdWN0LW1hbnVhbHM="><i class="menu-item-icon fa fa-fw fa-book"></i> <br>文档</span>

  </li>
      
      
      
        
        <li class="menu-item menu-item-faq">
      
    
      
      
        
      
        
      
        
      
        
      
    

    <a href="/FAQ" rel="section"><i class="menu-item-icon fa fa-fw fa-question"></i> <br>FAQ</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
      </li>
    
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input" id="search-input"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

  
</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZXByb2plY3QvaHVi" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></span>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="https://tuture.co/2020/03/03/-Oixkkq/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="图雀社区">
      <meta itemprop="description" content="图雀社区是一个供大家分享用 Tuture 写作工具完成的教程的一个平台。在这里，读者们可以尽情享受高质量且免费的实战教程，并能与作者和其他读者互动和讨论；而作者们也可以借此传播他们的技术知识，宣传他们的开源项目，找到自己输出内容的受众，加速技术的传播。">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="图雀社区">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">从零到部署：用 Vue 和 Express 实现迷你全栈电商应用（六）

          
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2020-03-03 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-03T00:00:00+08:00">2020-03-03</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-11 15:16:33" itemprop="dateModified" datetime="2021-07-11T15:16:33+08:00">2021-07-11</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%89%8D%E7%AB%AF/Vue/" itemprop="url" rel="index"><span itemprop="name">Vue</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%89%8D%E7%AB%AF/Vue/%E5%85%A5%E9%97%A8/" itemprop="url" rel="index"><span itemprop="name">入门</span></a></span>

                
                
              
            </span>
          

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
          
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>41k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>37 分钟</span>
            </span>
          
            <div class="post-description">前面五篇教程我们已经基本实现了迷你全栈电商应用的界面展示以及功能逻辑，相信大家在这个过程中都收获颇丰，并且迈向了全栈工程师的第一步。但是我们却并不满足于此，我们还需要对我们的项目代码进行优化，使得我们的代码可读性更高，也更好维护。相信细心的你们已经感觉到了项目中的store实例实在是过于臃肿，因此，本篇教程就是带大家一起学习如何抽出 Getters 、 Mutations 和Actions 逻辑实现store的“减重”以及如何干掉 mutation-types 硬编码。</div>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
            <div class="post-gallery-row">
              <img src="https://static.powerformer.com/c/092faf4/cover-6.jpg" itemprop="contentUrl">
            
          

          </div>
        </div>
        <div class="profileBox">
  <div class="avatarBox">
    <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXY=" title="https://github.com/tuture-dev"><img alt class="avatar" data-src="/images/avatars/tuture-dev.jpg"><i class="fa fa-external-link"></i></span>
  </div>
  <div class="rightBox">
    <div class="infoBox">
    <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXY=" title="https://github.com/tuture-dev"><p class="nickName">@tuture-dev</p><i class="fa fa-external-link"></i></span>
  </div>
  <div class="codeBox">
    <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5k" title="https://github.com/tuture-dev/vue-online-shop-frontend"><span class="codeText">查看代码</span><i class="fa fa-external-link"></i></span>
  </div>
  </div>
</div><a id="more"></a>

<h2 id="抽出-Getters-和-Mutations-逻辑"><a href="#抽出-Getters-和-Mutations-逻辑" class="headerlink" title="抽出 Getters 和 Mutations 逻辑"></a>抽出 Getters 和 Mutations 逻辑</h2><p>这一节我们来学习如何抽出在<code>store</code>实例中定义的复杂<code>getters</code>和<code>mutation</code>逻辑。</p>
<p>我们发现之前我们直接把所有的<code>getter</code>属性和方法都定义在了<code>store</code>实例中的<code>getters</code>属性中，所有的<code>mutation</code>属性也都定义在了<code>store</code>实例中的<code>mutations</code>属性中，这样显得<code>store</code>实例特别的累赘，因此我们可以通过对象展开运算符将这些复杂的逻辑抽取到对应的 <code>Getters</code> 和 <code>Mutations</code>文件中。</p>
<h3 id="重构-Admin-入口文件"><a href="#重构-Admin-入口文件" class="headerlink" title="重构 Admin 入口文件"></a>重构 Admin 入口文件</h3><p>首先我们做一点本土化，把之前的 <code>src/pages/admin/Index.vue</code> 中的英文导航改成中文版，方便查看；并且我们增加了查看生产商导航。</p>
<figure class="highlight html"><figcaption><span>src/pages/admin/Index.vue</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvZjBiNTY4NC9zcmMvcGFnZXMvYWRtaW4vSW5kZXgudnVl" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/f0b5684/src/pages/admin/Index.vue">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"admin-new"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-lg-3 col-md-3 col-sm-12 col-xs-12"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"admin-menu"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">              [tuture-del]</span><br><span class="line">              <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">"/admin"</span>&gt;</span>View Products<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span> [tuture-add]</span><br><span class="line">              <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">"/admin"</span>&gt;</span>查看商品<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">              [tuture-del]</span><br><span class="line">              <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">"/admin/new"</span>&gt;</span>New Products<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">              [tuture-add]</span><br><span class="line">              <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">"/admin/new"</span>&gt;</span>添加商品<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span> [tuture-add]</span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            [tuture-add]</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">              [tuture-add]</span><br><span class="line">              <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">"/admin/manufacturers"</span>&gt;</span>查看生产商<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里我们将有关商品的导航栏修改为中文版，让用户能够秒懂；除此之外我们又添加了有关制造商的导航，这里增加的是<strong>查看生产商</strong>导航，并添加了对应的导航跳转路径，该路径需要与对应路由参数一致。</p>
<h3 id="创建-Manufacturers-组件"><a href="#创建-Manufacturers-组件" class="headerlink" title="创建 Manufacturers 组件"></a>创建 Manufacturers 组件</h3><p>我们创建的<code>src/pages/admin/Manufacturers.vue</code>文件是本地制造商组件，用于展示制造商的信息。</p>
<figure class="highlight html"><figcaption><span>src/pages/admin/Manufacturers.vue</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvZjBiNTY4NC9zcmMvcGFnZXMvYWRtaW4vTWFudWZhY3R1cmVycy52dWU=" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/f0b5684/src/pages/admin/Manufacturers.vue">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>制造商<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">v-for</span>=<span class="string">"manufacturer in manufacturers"</span> <span class="attr">:key</span>=<span class="string">"manufacturer._id"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;manufacturer.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"modify"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">"'/admin/manufacturers/edit/' + manufacturer._id"</span></span></span><br><span class="line"><span class="tag">              &gt;</span>修改<span class="tag">&lt;/<span class="name">router-link</span></span></span><br><span class="line"><span class="tag">            &gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"remove"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">"removeManufacturer(manufacturer._id)"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">  table &#123;</span><br><span class="line">    margin: 0 auto;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">  <span class="selector-class">.modify</span> &#123;</span></span><br><span class="line">    color: blue;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">  <span class="selector-class">.remove</span> <span class="selector-tag">a</span> &#123;</span></span><br><span class="line">    color: red;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    created() &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">if</span> (<span class="keyword">this</span>.manufacturers.length === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.$store.dispatch(<span class="string">'allManufacturers'</span>);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;</span><br><span class="line">      manufacturers() &#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> <span class="keyword">this</span>.$store.getters.allManufacturers;</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      removeManufacturer(manufacturerId) &#123;</span><br><span class="line"><span class="actionscript">        <span class="comment">// 使用 JavaScript BOM 的 confirm 方法来询问用户是否删除此制造商</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> res = confirm(<span class="string">'是否删除此制造商？'</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// 如果用户同意，那么就删除此制造商</span></span></span><br><span class="line">        if (res) &#123;</span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.$store.dispatch(<span class="string">'removeManufacturer'</span>, &#123;</span></span><br><span class="line">            manufacturerId,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里首先定义了一个计算属性<code>manufacturers</code>，通过<code>this.$store.getters.allManufacturers</code>属性访问的形式调用对应的<code>getter</code>属性<code>allManufacturers</code>从本地获取<code>manufacturers</code>，并返回给计算属性<code>manufacturers</code>。</p>
<p>然后在该组件刚被创建时判断本地中是否存在<code>manufacturers</code>，如果没有则通过<code>this.$store.dispatch</code>分发到类型为<code>allManufacturers</code>的<code>action</code>中进行异步操作获取所有制造商，并将获取的制造商提交到对应的<code>mutation</code>中，在<code>mutation</code>中修改本地状态，将获取的所有制造商保存到本地。</p>
<p>最后利用<code>v-for</code>在表格中遍历<code>manufacturers</code>，每个制造商的信息在一行展示，除了信息之外还有两个功能（修改和删除制造商），点击修改则会根据<code>&#39;/admin/manufacturers/edit/&#39; + manufacturer._id</code>路由到指定页面；点击删除则会触发<code>removeManufacturer</code>事件，首先询问用户是否同意删除，若用户同意则将选中制造商的 id 作为载荷分发到类型为<code>removeManufacturer</code>的<code>action</code>中，在<code>action</code>中进行异步操作删除后端对应商品，并将对应商品 id 提交到对应的<code>mutation</code>中，在<code>mutation</code>中进行本地状态修改，删除本地对应的商品。</p>
<h3 id="重构-Products-组件"><a href="#重构-Products-组件" class="headerlink" title="重构 Products 组件"></a>重构 Products 组件</h3><p>根据<code>Manufacturers</code>组件的设计原则，我们需要再次进入<code>src/pages/admin/Products.vue</code>文件。按照<code>Manufacturers</code>组件的 UI 展示以及数据处理，将<code>Products</code>组件进行一下重构。</p>
<figure class="highlight html"><figcaption><span>src/pages/admin/Products.vue</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvZjBiNTY4NC9zcmMvcGFnZXMvYWRtaW4vUHJvZHVjdHMudnVl" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/f0b5684/src/pages/admin/Products.vue">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">[tuture-del]    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span></span><br><span class="line">[tuture-del]      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>This is Admin<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">[tuture-del]    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">[tuture-del]    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"body"</span>&gt;</span></span><br><span class="line">[tuture-del]      &#123;&#123; product.name &#125;&#125;</span><br><span class="line">[tuture-del]    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">[tuture-add]    <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table"</span>&gt;</span></span><br><span class="line">[tuture-add]      <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">[tuture-add]        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">[tuture-add]          <span class="tag">&lt;<span class="name">th</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">[tuture-add]          <span class="tag">&lt;<span class="name">th</span>&gt;</span>价格<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">[tuture-add]          <span class="tag">&lt;<span class="name">th</span>&gt;</span>制造商<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">[tuture-add]          <span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">[tuture-add]          <span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">[tuture-add]        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">[tuture-add]      <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">[tuture-add]      <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">[tuture-add]        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">v-for</span>=<span class="string">"product in products"</span> <span class="attr">:key</span>=<span class="string">"product._id"</span>&gt;</span></span><br><span class="line">[tuture-add]          <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;product.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">[tuture-add]          <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;product.price&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">[tuture-add]          <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;product.manufacturer.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">[tuture-add]          <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"modify"</span>&gt;</span><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">"'/admin/edit/' + product._id"</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">[tuture-add]          <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"remove"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">"removeProduct(product._id)"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">[tuture-add]        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">[tuture-add]      <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">[tuture-add]    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">[tuture-add]<span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-attr">[tuture-add]</span><span class="selector-tag">table</span> &#123;</span></span><br><span class="line"><span class="css"><span class="selector-attr">[tuture-add]</span>  <span class="selector-tag">margin</span>: 0 <span class="selector-tag">auto</span>;</span></span><br><span class="line"><span class="css"><span class="selector-attr">[tuture-add]</span>&#125;</span></span><br><span class="line"><span class="css"><span class="selector-attr">[tuture-add]</span></span></span><br><span class="line"><span class="css"><span class="selector-attr">[tuture-add]</span><span class="selector-class">.modify</span> &#123;</span></span><br><span class="line"><span class="css"><span class="selector-attr">[tuture-add]</span>  <span class="selector-tag">color</span>: <span class="selector-tag">blue</span>;</span></span><br><span class="line"><span class="css"><span class="selector-attr">[tuture-add]</span>&#125;</span></span><br><span class="line"><span class="css"><span class="selector-attr">[tuture-add]</span></span></span><br><span class="line"><span class="css"><span class="selector-attr">[tuture-add]</span><span class="selector-class">.remove</span> <span class="selector-tag">a</span> &#123;</span></span><br><span class="line"><span class="css"><span class="selector-attr">[tuture-add]</span>  <span class="selector-tag">color</span>: <span class="selector-tag">red</span>;</span></span><br><span class="line"><span class="css"><span class="selector-attr">[tuture-add]</span>&#125;</span></span><br><span class="line"><span class="css"><span class="selector-attr">[tuture-add]</span></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">[tuture-add]</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">[tuture-add]  created() &#123;</span><br><span class="line"><span class="actionscript">[tuture-add]    <span class="keyword">if</span> (<span class="keyword">this</span>.products.length === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="actionscript">[tuture-add]      <span class="keyword">this</span>.$store.dispatch(<span class="string">'allProducts'</span>);</span></span><br><span class="line">[tuture-add]    &#125;</span><br><span class="line">[tuture-add]  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">[tuture-del]    product() &#123;</span><br><span class="line"><span class="actionscript">[tuture-del]      <span class="keyword">return</span> <span class="keyword">this</span>.$store.getters.allProducts[<span class="number">0</span>];</span></span><br><span class="line">[tuture-add]    products() &#123;</span><br><span class="line"><span class="actionscript">[tuture-add]      <span class="keyword">return</span> <span class="keyword">this</span>.$store.getters.allProducts</span></span><br><span class="line">[tuture-add]    &#125;</span><br><span class="line">[tuture-add]  &#125;,</span><br><span class="line">[tuture-add]  methods: &#123;</span><br><span class="line">[tuture-add]    removeProduct(productId) &#123;</span><br><span class="line"><span class="actionscript">[tuture-add]      <span class="comment">// 使用 JavaScript BOM 的 confirm 方法来询问用户是否删除此商品</span></span></span><br><span class="line"><span class="actionscript">[tuture-add]      <span class="keyword">const</span> res = confirm(<span class="string">'是否删除此商品？'</span>);</span></span><br><span class="line">[tuture-add]</span><br><span class="line"><span class="actionscript">[tuture-add]      <span class="comment">// 如果用户同意，那么就删除此商品</span></span></span><br><span class="line">[tuture-add]      if (res) &#123;</span><br><span class="line"><span class="actionscript">[tuture-add]        <span class="keyword">this</span>.$store.dispatch(<span class="string">'removeProduct'</span>, &#123;</span></span><br><span class="line">[tuture-add]          productId,</span><br><span class="line">[tuture-add]        &#125;)</span><br><span class="line">[tuture-add]      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="actionscript"><span class="comment">// ...</span></span></span><br></pre></td></tr></table></figure>

<p>这部分代码逻辑与<code>src/pages/admin/Manufacturers.vue</code>文件中的代码逻辑相似，如果您理解了上面的代码逻辑，那么我们相信您对这里的代码也能融会贯通，所以这里就不再赘述了。</p>
<h3 id="添加路由信息"><a href="#添加路由信息" class="headerlink" title="添加路由信息"></a>添加路由信息</h3><p>我们已经创建了有关制造商的导航以及查看制造商组件，还需对其配置相应的路由参数才能实现跳转。因此再次进入<code>src/router/index.js</code>文件，这里我们导入了制造商组件并增加了制造商相关路由参数。</p>
<figure class="highlight js"><figcaption><span>src/router/index.js</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvZjBiNTY4NC9zcmMvcm91dGVyL2luZGV4Lmpz" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/f0b5684/src/router/index.js">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">import</span> New <span class="keyword">from</span> <span class="string">'@/pages/admin/New'</span>;</span><br><span class="line"><span class="keyword">import</span> Products <span class="keyword">from</span> <span class="string">'@/pages/admin/Products'</span>;</span><br><span class="line"><span class="keyword">import</span> Edit <span class="keyword">from</span> <span class="string">'@/pages/admin/Edit'</span>;</span><br><span class="line">[tuture-add]<span class="keyword">import</span> Manufacturers <span class="keyword">from</span> <span class="string">'@/pages/admin/Manufacturers'</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Router);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">          name: <span class="string">'Edit'</span>,</span><br><span class="line">          component: Edit,</span><br><span class="line">        &#125;,</span><br><span class="line">[tuture-add]        &#123;</span><br><span class="line">[tuture-add]          path: <span class="string">'manufacturers'</span>,</span><br><span class="line">[tuture-add]          name: <span class="string">'Manufacturers'</span>,</span><br><span class="line">[tuture-add]          component: Manufacturers,</span><br><span class="line">[tuture-add]        &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>把项目跑起来，点击<code>Admin</code>然后再点击<strong>查看生产商</strong>，我们可以看到从后端获取的所有生产商： 下面展示的就是从后端获取的制造商，并且我们可以对其进行修改和删除操作。</p>
<p><img alt data-src="https://imgkr2.cn-bj.ufileos.com/11f291f4-daa2-4d7b-80a3-305fd8840cef.png?UCloudPublicKey=TOKEN_8d8b72be-579a-4e83-bfd0-5f6ce1546f13&Signature=bUlzaK1%252BPpuYQhfzNYPVKpxfx9k%253D&Expires=1597417587"></p>
<h3 id="抽取-Getters-逻辑"><a href="#抽取-Getters-逻辑" class="headerlink" title="抽取 Getters 逻辑"></a>抽取 Getters 逻辑</h3><p>我们首先创建了<code>src/store/getters.js</code>文件，用于存放各种不同类型的<code>getter</code>属性和方法。这里我们导出了两个对象分别为<code>productGetters</code>和<code>manufacturerGetters</code>，前者包含了有关商品的<code>getter</code>属性与方法，后者包含了有关制造商的<code>getter</code>属性与方法。</p>
<figure class="highlight js"><figcaption><span>src/store/getters.js</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvZjBiNTY4NC9zcmMvc3RvcmUvZ2V0dGVycy5qcw==" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/f0b5684/src/store/getters.js">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> productGetters = &#123;</span><br><span class="line">  allProducts(state) &#123;</span><br><span class="line">    <span class="keyword">return</span> state.products;</span><br><span class="line">  &#125;,</span><br><span class="line">  productById: <span class="function">(<span class="params">state, getters</span>) =&gt;</span> <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (getters.allProducts.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> getters.allProducts.filter(<span class="function">(<span class="params">product</span>) =&gt;</span> product._id === id)[<span class="number">0</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> state.product;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> manufacturerGetters = &#123;</span><br><span class="line">  allManufacturers(state) &#123;</span><br><span class="line">    <span class="keyword">return</span> state.manufacturers;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在<code>productGetters</code>对象中定义的就是有关商品的<code>getter</code>属性和方法，如<code>allProducts</code>，<code>productById</code>等等；在<code>manufacturerGetters</code>对象中定义的就是有关制造商的<code>getter</code>属性和方法，如<code>allManufacturers</code>等等。</p>
<blockquote>
<p>我们可以采用属性调用和方法调用的方式调用这里的 getter(根据我们在 getter 对象中定义的是属性还是方法)</p>
</blockquote>
<h3 id="抽取-Mutations-逻辑"><a href="#抽取-Mutations-逻辑" class="headerlink" title="抽取 Mutations 逻辑"></a>抽取 Mutations 逻辑</h3><p>同样的我们创建了<code>src/store/mutations.js</code>文件，用于存放从<code>store</code>实例的<code>mutations</code>属性中抽取出来的各种<code>mutation</code>属性，这里我们定义了三个对象分别为<code>productMutations</code>，<code>cartMutations</code>以及<code>manufacturerMutations</code>。</p>
<figure class="highlight js"><figcaption><span>src/store/mutations.js</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvZjBiNTY4NC9zcmMvc3RvcmUvbXV0YXRpb25zLmpz" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/f0b5684/src/store/mutations.js">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> productMutations = &#123;</span><br><span class="line">  ALL_PRODUCTS(state) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  ALL_PRODUCTS_SUCCESS(state, payload) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; products &#125; = payload;</span><br><span class="line"></span><br><span class="line">    state.showLoader = <span class="literal">false</span>;</span><br><span class="line">    state.products = products;</span><br><span class="line">  &#125;,</span><br><span class="line">  PRODUCT_BY_ID(state) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  PRODUCT_BY_ID_SUCCESS(state, payload) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; product &#125; = payload;</span><br><span class="line">    state.product = product;</span><br><span class="line">  &#125;,</span><br><span class="line">  REMOVE_PRODUCT(state) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  REMOVE_PRODUCT_SUCCESS(state, payload) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; productId &#125; = payload;</span><br><span class="line">    state.products = state.products.filter(</span><br><span class="line">      (product) =&gt; product._id !== productId,</span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> cartMutations = &#123;</span><br><span class="line">  ADD_TO_CART(state, payload) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; product &#125; = payload;</span><br><span class="line">    state.cart.push(product);</span><br><span class="line">  &#125;,</span><br><span class="line">  REMOVE_FROM_CART(state, payload) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; productId &#125; = payload;</span><br><span class="line">    state.cart = state.cart.filter(<span class="function">(<span class="params">product</span>) =&gt;</span> product._id !== productId);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> manufacturerMutations = &#123;</span><br><span class="line">  ALL_MANUFACTURERS(state) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  ALL_MANUFACTURERS_SUCCESS(state, payload) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; manufacturers &#125; = payload;</span><br><span class="line"></span><br><span class="line">    state.showLoader = <span class="literal">false</span>;</span><br><span class="line">    state.manufacturers = manufacturers;</span><br><span class="line">  &#125;,</span><br><span class="line">  REMOVE_MANUFACTURER(state) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  REMOVE_MANUFACTURER_SUCCESS(state, payload) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; manufacturerId &#125; = payload;</span><br><span class="line">    state.manufacturers = state.manufacturers.filter(</span><br><span class="line">      (manufacturer) =&gt; manufacturer._id !== manufacturerId,</span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在<code>productMutations</code>对象中定义了有关商品响应 Vue 视图层以及<code>avtion</code>中提交的事件，比如<code>ALL_PRODUCTS</code>，<code>ALL_PRODUCTS_SUCCESS</code>，<code>PRODUCT_BY_ID</code>以及<code>PRODUCT_BY_ID_SUCCESS</code>等等。</p>
<p>在<code>cartMutations</code>对象中定义了有关购物车响应 Vue 视图层提交的事件，比如<code>ADD_TO_CART</code>，<code>REMOVE_FROM_CART</code>等等。</p>
<p>在<code>manufacturerMutations</code>对象中定义了有关制造商响应 Vue 视图层以及<code>avtion</code>中提交的事件，比如<code>ALL_MANUFACTURERS</code>，<code>ALL_MANUFACTURERS_SUCCESS</code>，<code>REMOVE_MANUFACTURER</code>以及<code>REMOVE_MANUFACTURER_SUCCESS</code>等等。</p>
<h3 id="重构-Store-实例"><a href="#重构-Store-实例" class="headerlink" title="重构 Store 实例"></a>重构 Store 实例</h3><p>我们将<code>store</code>实例中的<code>Getter</code>属性和<code>Mutation</code>属性抽出之后要再进行导入。再回到<code>src/store/index.js</code>文件，这里就是抽离<code>getters</code>和<code>mutations</code>逻辑之后的<code>store</code>实例，看起来是不是轻盈了很多，也增强了代码的可读性。</p>
<figure class="highlight js"><figcaption><span>src/store/index.js</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvZjBiNTY4NC9zcmMvc3RvcmUvaW5kZXguanM=" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/f0b5684/src/store/index.js">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"></span><br><span class="line">[tuture-add]<span class="keyword">import</span> &#123; productGetters, manufacturerGetters &#125; <span class="keyword">from</span> <span class="string">'./getters'</span>;</span><br><span class="line">[tuture-add]<span class="keyword">import</span> &#123; productMutations, cartMutations, manufacturerMutations &#125; <span class="keyword">from</span> <span class="string">'./mutations'</span>;</span><br><span class="line">[tuture-add]</span><br><span class="line"><span class="keyword">const</span> API_BASE = <span class="string">'http://localhost:3000/api/v1'</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Vuex);</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line">    manufacturers: [],</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">[tuture-del]    ADD_TO_CART(state, payload) &#123;</span><br><span class="line">[tuture-del]      <span class="keyword">const</span> &#123; product &#125; = payload;</span><br><span class="line">[tuture-del]      state.cart.push(product)</span><br><span class="line">[tuture-del]    &#125;,</span><br><span class="line">[tuture-del]    REMOVE_FROM_CART(state, payload) &#123;</span><br><span class="line">[tuture-del]      <span class="keyword">const</span> &#123; productId &#125; = payload</span><br><span class="line">[tuture-del]      state.cart = state.cart.filter(<span class="function"><span class="params">product</span> =&gt;</span> product._id !== productId)</span><br><span class="line">[tuture-del]    &#125;,</span><br><span class="line">[tuture-del]    ALL_PRODUCTS(state) &#123;</span><br><span class="line">[tuture-del]      state.showLoader = <span class="literal">true</span>;</span><br><span class="line">[tuture-del]    &#125;,</span><br><span class="line">[tuture-del]    ALL_PRODUCTS_SUCCESS(state, payload) &#123;</span><br><span class="line">[tuture-del]      <span class="keyword">const</span> &#123; products &#125; = payload;</span><br><span class="line">[tuture-del]</span><br><span class="line">[tuture-del]      state.showLoader = <span class="literal">false</span>;</span><br><span class="line">[tuture-del]      state.products = products;</span><br><span class="line">[tuture-del]    &#125;,</span><br><span class="line">[tuture-del]    PRODUCT_BY_ID(state) &#123;</span><br><span class="line">[tuture-del]      state.showLoader = <span class="literal">true</span>;</span><br><span class="line">[tuture-del]    &#125;,</span><br><span class="line">[tuture-del]    PRODUCT_BY_ID_SUCCESS(state, payload) &#123;</span><br><span class="line">[tuture-del]      state.showLoader = <span class="literal">false</span>;</span><br><span class="line">[tuture-del]</span><br><span class="line">[tuture-del]      <span class="keyword">const</span> &#123; product &#125; = payload;</span><br><span class="line">[tuture-del]      state.product = product;</span><br><span class="line">[tuture-del]    &#125;</span><br><span class="line">[tuture-add]    ...productMutations,</span><br><span class="line">[tuture-add]    ...cartMutations,</span><br><span class="line">[tuture-add]    ...manufacturerMutations,</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line">[tuture-del]    allProducts(state) &#123;</span><br><span class="line">[tuture-del]      <span class="keyword">return</span> state.products;</span><br><span class="line">[tuture-del]    &#125;,</span><br><span class="line">[tuture-del]    productById: <span class="function">(<span class="params">state, getters</span>) =&gt;</span> <span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-del]      <span class="keyword">if</span> (getters.allProducts.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">[tuture-del]        <span class="keyword">return</span> getters.allProducts.filter(<span class="function"><span class="params">p</span> =&gt;</span> p._id == id)[<span class="number">0</span>];</span><br><span class="line">[tuture-del]      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">[tuture-del]        <span class="keyword">return</span> state.product;</span><br><span class="line">[tuture-del]      &#125;</span><br><span class="line">[tuture-del]    &#125;</span><br><span class="line">[tuture-add]    ...productGetters,</span><br><span class="line">[tuture-add]    ...manufacturerGetters,</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    allProducts(&#123; commit &#125;) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">          product: response.data,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;)</span><br><span class="line">[tuture-del]    &#125;</span><br><span class="line">[tuture-add]    &#125;,</span><br><span class="line">[tuture-add]    removeProduct(&#123; commit &#125;, payload) &#123;</span><br><span class="line">[tuture-add]      commit(<span class="string">'REMOVE_PRODUCT'</span>);</span><br><span class="line">[tuture-add]</span><br><span class="line">[tuture-add]      <span class="keyword">const</span> &#123; productId &#125; = payload;</span><br><span class="line">[tuture-add]      axios.delete(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/products/<span class="subst">$&#123;productId&#125;</span>`</span>).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-add]        <span class="comment">// 返回 productId，用于删除本地对应的商品</span></span><br><span class="line">[tuture-add]        commit(<span class="string">'REMOVE_PRODUCT_SUCCESS'</span>, &#123;</span><br><span class="line">[tuture-add]          productId,</span><br><span class="line">[tuture-add]        &#125;);</span><br><span class="line">[tuture-add]      &#125;)</span><br><span class="line">[tuture-add]    &#125;,</span><br><span class="line">[tuture-add]    allManufacturers(&#123; commit &#125;) &#123;</span><br><span class="line">[tuture-add]      commit(<span class="string">'ALL_MANUFACTURERS'</span>);</span><br><span class="line">[tuture-add]</span><br><span class="line">[tuture-add]      axios.get(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/manufacturers`</span>).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-add]        commit(<span class="string">'ALL_MANUFACTURERS_SUCCESS'</span>, &#123;</span><br><span class="line">[tuture-add]          manufacturers: response.data,</span><br><span class="line">[tuture-add]        &#125;);</span><br><span class="line">[tuture-add]      &#125;)</span><br><span class="line">[tuture-add]    &#125;,</span><br><span class="line">[tuture-add]    removeManufacturer(&#123; commit &#125;, payload) &#123;</span><br><span class="line">[tuture-add]      commit(<span class="string">'REMOVE_MANUFACTURER'</span>);</span><br><span class="line">[tuture-add]</span><br><span class="line">[tuture-add]      <span class="keyword">const</span> &#123; manufacturerId &#125; = payload;</span><br><span class="line">[tuture-add]      axios.delete(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/manufacturers/<span class="subst">$&#123;manufacturerId&#125;</span>`</span>).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-add]        <span class="comment">// 返回 manufacturerId，用于删除本地对应的制造商</span></span><br><span class="line">[tuture-add]        commit(<span class="string">'REMOVE_MANUFACTURER_SUCCESS'</span>, &#123;</span><br><span class="line">[tuture-add]          manufacturerId,</span><br><span class="line">[tuture-add]        &#125;);</span><br><span class="line">[tuture-add]      &#125;)</span><br><span class="line">[tuture-add]    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这里首先导入了<code>getters</code>和<code>mutations</code>文件中导出的所有对象，然后在<code>store</code>实例的<code>getters</code>和<code>mutations</code>属性中通过对象展开运算符的方式将对应的属性和方法导入到<code>store</code>实例中。</p>
<blockquote>
<p><strong>对象展开运算符</strong>是 ES7 草案中的新特性，将一个对象当中的对象的一部分取出来成为一个新对象赋值给展开运算符的参数，然后插入到另外一个对象当中。例如：</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> shortcuts = &#123;</span><br><span class="line">  attr1: <span class="number">3</span>,</span><br><span class="line">  attr2: <span class="number">4</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> shortcuts2 = &#123;&#125;;</span><br><span class="line">shortcuts2 = &#123; ...shortcuts &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//上面的这种用法实际上相当于是：</span></span><br><span class="line">shortcuts2 = &#123; <span class="attr">attr1</span>: <span class="number">3</span>, <span class="attr">attr2</span>: <span class="number">4</span> &#125;;</span><br></pre></td></tr></table></figure>

<p>除此之外我们又在<code>actions</code>中添加了一些其他的<code>action</code>属性，因为此时<code>actions</code>还未被抽离，所以可能依然显得有些臃肿，不过在后面我们马上也会将它抽离出来。</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>这一节我们学习了如何抽出<code>Getters</code>和<code>Mutations</code>逻辑，减轻<code>store</code>实例中的负载：</p>
<ul>
<li>首先我们需要分别创建<code>getters</code>和<code>mutations</code>JS 文件，在两个 JS 文件中分别定义不同类型的<code>getters</code>和<code>mutations</code>对象并导出，然后在<code>getters</code>和<code>mutations</code>对象中定义相应的一些属性和方法。</li>
<li>在<code>store</code>的<code>index</code>文件中导入这些<code>getters</code>和<code>mutations</code>对象，并在<code>store</code>实例的<code>getters</code>和<code>mutations</code>属性中通过对象展开运算符混入这些对象。</li>
<li>我们可以使用<code>this.$store.getters.属性</code>和<code>this.$store.mutations.属性</code>的方式调用.</li>
</ul>
<h2 id="抽出-Actions-逻辑"><a href="#抽出-Actions-逻辑" class="headerlink" title="抽出 Actions 逻辑"></a>抽出 Actions 逻辑</h2><p>上一节我们学习了如何抽出<code>Getters</code>和<code>Mutations</code>逻辑，这一节我们以同样的方式抽出<code>Actions</code>逻辑。</p>
<h3 id="重构-Edit-组件"><a href="#重构-Edit-组件" class="headerlink" title="重构 Edit 组件"></a>重构 Edit 组件</h3><p><code>src/pages/admin/Edit.vue</code>是商品编辑组件，当触发<code>&#39;/admin/edit/&#39; + product._id</code>就会路由到指定商品信息编辑页面，然后对商品信息进行修改。</p>
<p>之前我们直接将展示商品信息的代码放在该组件中，但是我们发现展示商品信息这部分功能在新建商品和编辑商品组件中都需要使用，因此我们打算把这部分代码封装为一个展示商品信息的表单组件<code>ProductForm</code>，这样的话我们在新建商品和编辑商品组件中都能复用该组件。</p>
<p>除此之外我们还在该组件中添加了数据处理功能。</p>
<figure class="highlight html"><figcaption><span>src/pages/admin/Edit.vue</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvNDkwOTgwMy9zcmMvcGFnZXMvYWRtaW4vRWRpdC52dWU=" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/4909803/src/pages/admin/Edit.vue">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span></span><br><span class="line">      [tuture-del]</span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>This is Admin/Edit/&#123;&#123;$route.params.id&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">      [tuture-add]</span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>This is Admin/Edit<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    [tuture-add]</span><br><span class="line">    <span class="tag">&lt;<span class="name">product-form</span></span></span><br><span class="line"><span class="tag">      [<span class="attr">tuture-add</span>]</span></span><br><span class="line"><span class="tag">      @<span class="attr">save-product</span>=<span class="string">"updateProduct"</span></span></span><br><span class="line"><span class="tag">      [<span class="attr">tuture-add</span>]</span></span><br><span class="line"><span class="tag">      <span class="attr">:model</span>=<span class="string">"model"</span></span></span><br><span class="line"><span class="tag">      [<span class="attr">tuture-add</span>]</span></span><br><span class="line"><span class="tag">      <span class="attr">:manufacturers</span>=<span class="string">"manufacturers"</span></span></span><br><span class="line"><span class="tag">      [<span class="attr">tuture-add</span>]</span></span><br><span class="line"><span class="tag">      <span class="attr">:isEditing</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">      [<span class="attr">tuture-add</span>]</span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">product-form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">[tuture-add] [tuture-add]</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  [tuture-add]<span class="keyword">import</span> ProductForm <span class="keyword">from</span> <span class="string">'@/components/products/ProductForm.vue'</span>;</span></span><br><span class="line"><span class="javascript">  [tuture-add]<span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  [tuture-add]  created() &#123;</span><br><span class="line"><span class="actionscript">  [tuture-add]    <span class="keyword">const</span> &#123; name &#125; = <span class="keyword">this</span>.model;</span></span><br><span class="line">  [tuture-add]    if (!name) &#123;</span><br><span class="line"><span class="actionscript">  [tuture-add]      <span class="keyword">this</span>.$store.dispatch(<span class="string">'productById'</span>, &#123;</span></span><br><span class="line"><span class="actionscript">  [tuture-add]        productId: <span class="keyword">this</span>.$route.params[<span class="string">'id'</span>]</span></span><br><span class="line">  [tuture-add]      &#125;);</span><br><span class="line">  [tuture-add]    &#125;</span><br><span class="line">  [tuture-add]</span><br><span class="line"><span class="actionscript">  [tuture-add]    <span class="keyword">if</span> (<span class="keyword">this</span>.manufacturers.length === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="actionscript">  [tuture-add]      <span class="keyword">this</span>.$store.dispatch(<span class="string">'allManufacturers'</span>);</span></span><br><span class="line">  [tuture-add]    &#125;</span><br><span class="line">  [tuture-add]  &#125;,</span><br><span class="line">  [tuture-add]  computed: &#123;</span><br><span class="line">  [tuture-add]    manufacturers() &#123;</span><br><span class="line"><span class="actionscript">  [tuture-add]      <span class="keyword">return</span> <span class="keyword">this</span>.$store.getters.allManufacturers;</span></span><br><span class="line">  [tuture-add]    &#125;,</span><br><span class="line">  [tuture-add]    model() &#123;</span><br><span class="line"><span class="actionscript">  [tuture-add]      <span class="keyword">const</span> product = <span class="keyword">this</span>.$store.getters.productById(<span class="keyword">this</span>.$route.params[<span class="string">'id'</span>]);</span></span><br><span class="line">  [tuture-add]</span><br><span class="line"><span class="actionscript">  [tuture-add]      <span class="comment">// 这里返回 product 的拷贝，是为了在修改 product 的拷贝之后，在保存之前不修改本地 Vuex stire 的 product 属性</span></span></span><br><span class="line"><span class="actionscript">  [tuture-add]      <span class="keyword">return</span> &#123; ...product, manufacturer: &#123; ...product.manufacturer &#125; &#125;;</span></span><br><span class="line">  [tuture-add]    &#125;</span><br><span class="line">  [tuture-add]  &#125;,</span><br><span class="line">  [tuture-add]  methods: &#123;</span><br><span class="line">  [tuture-add]    updateProduct(product) &#123;</span><br><span class="line"><span class="actionscript">  [tuture-add]      <span class="keyword">this</span>.$store.dispatch(<span class="string">'updateProduct'</span>, &#123;</span></span><br><span class="line">  [tuture-add]        product,</span><br><span class="line">  [tuture-add]      &#125;)</span><br><span class="line">  [tuture-add]    &#125;</span><br><span class="line">  [tuture-add]  &#125;,</span><br><span class="line">  [tuture-add]  components: &#123;</span><br><span class="line"><span class="actionscript">  [tuture-add]    <span class="string">'product-form'</span>: ProductForm</span></span><br><span class="line">  [tuture-add]  &#125;</span><br><span class="line">  [tuture-add]&#125;</span><br><span class="line">  [tuture-add]</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们先来看该组件的<code>script</code>部分，首先定义了两个计算属性<code>model</code>和<code>manufacturers</code>返回本地商品和制造商。通过方法访问的方式调用指定的<code>getter</code>属性<code>productById</code>，参数为当前处于激活状态的路由对象的 id，这里返回<code>product</code>的拷贝，是为了在修改 <code>product</code>的拷贝之后，在保存之前不修改本地 Vuex store 的<code>product</code>属性。计算属性<code>manufacturers</code>通过相同的方式获取本地数据。</p>
<p>当该组件刚被创建时判断计算属性<code>model</code>中是否有值，如果没有则表示本地中没有该商品，将包含该商品 id 的对象作为载荷分发到类型为<code>productById</code>的<code>action</code>中，在<code>action</code>中进行异步操作从后端获取对应商品，并提交到对应类型的<code>mutation</code>中，在<code>mutation</code>中将获取到的商品保存到本地。除此之外判断计算属性<code>manufacturers</code>中是否有值，如果没有则通过相同的方式从后端获取并保存到本地。</p>
<p>在<code>template</code>中使用了子组件<code>ProductForm</code>用表单的形式来展示商品信息，当用户提交表单则会向父组件发射<code>save-product</code>事件，父组件监听到之后触发<code>updateProduct</code>事件，并将传入的商品参数作为载荷分发到类型为<code>updateProduct</code>的<code>action</code>中，通知后端进行同步更新数据并提交到对应的<code>mutation</code>中进行本地数据更新。</p>
<h3 id="重构-New-组件"><a href="#重构-New-组件" class="headerlink" title="重构 New 组件"></a>重构 New 组件</h3><p><code>src/pages/admin/New.vue</code>是添加商品组件，与<code>Edit</code>组件的代码逻辑相似，只是一个是修改商品信息，一个是添加商品信息。</p>
<p>我们将该组件中原先写死的数据改成了从后端动态获取， 并将获取的数据传递给子组件<code>ProductForm。</code></p>
<figure class="highlight html"><figcaption><span>src/pages/admin/New.vue</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvNDkwOTgwMy9zcmMvcGFnZXMvYWRtaW4vTmV3LnZ1ZQ==" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/4909803/src/pages/admin/New.vue">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">product-form</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">save-product</span>=<span class="string">"addProduct"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:model</span>=<span class="string">"model"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:manufacturers</span>=<span class="string">"manufacturers"</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">product-form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> ProductForm <span class="keyword">from</span> <span class="string">'@/components/products/ProductForm.vue'</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  [tuture-del]  data() &#123;</span><br><span class="line"><span class="actionscript">  [tuture-del]    <span class="keyword">return</span> &#123;</span></span><br><span class="line">  [tuture-del]      model: &#123;&#125;,</span><br><span class="line">  [tuture-del]      manufacturers: [</span><br><span class="line">  [tuture-del]        &#123;</span><br><span class="line"><span class="actionscript">  [tuture-del]          _id: <span class="string">'sam'</span>,</span></span><br><span class="line"><span class="actionscript">  [tuture-del]          name: <span class="string">'Samsung'</span>,</span></span><br><span class="line">  [tuture-del]        &#125;,</span><br><span class="line">  [tuture-del]        &#123;</span><br><span class="line"><span class="actionscript">  [tuture-del]          _id: <span class="string">'apple'</span>,</span></span><br><span class="line"><span class="actionscript">  [tuture-del]          name: <span class="string">'Apple'</span>,</span></span><br><span class="line">  [tuture-del]        &#125;,</span><br><span class="line">  [tuture-del]      ],</span><br><span class="line">  [tuture-del]    &#125;;</span><br><span class="line">  [tuture-add]  created() &#123;</span><br><span class="line"><span class="actionscript">  [tuture-add]    <span class="keyword">if</span> (<span class="keyword">this</span>.manufacturers.length === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="actionscript">  [tuture-add]      <span class="keyword">this</span>.$store.dispatch(<span class="string">'allManufacturers'</span>);</span></span><br><span class="line">  [tuture-add]    &#125;</span><br><span class="line">  [tuture-add]  &#125;,</span><br><span class="line">  [tuture-add]  computed: &#123;</span><br><span class="line">  [tuture-add]    manufacturers() &#123;</span><br><span class="line"><span class="actionscript">  [tuture-add]      <span class="keyword">return</span> <span class="keyword">this</span>.$store.getters.allManufacturers;</span></span><br><span class="line">  [tuture-add]    &#125;,</span><br><span class="line">  [tuture-add]    model() &#123;</span><br><span class="line"><span class="actionscript">  [tuture-add]      <span class="keyword">return</span> &#123;&#125;;</span></span><br><span class="line">  [tuture-add]    &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      addProduct(model) &#123;</span><br><span class="line"><span class="javascript">  [tuture-del]      <span class="built_in">console</span>.log(<span class="string">'model'</span>, model);</span></span><br><span class="line"><span class="actionscript">  [tuture-add]      <span class="keyword">this</span>.$store.dispatch(<span class="string">'addProduct'</span>, &#123;</span></span><br><span class="line">  [tuture-add]        product: model,</span><br><span class="line">  [tuture-add]      &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line"><span class="actionscript">    <span class="string">'product-form'</span>: ProductForm</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>该组件代码逻辑和<code>Edit.vue</code>组件相似，只是在这里我们定义的计算属性<code>model</code>返回一个空对象作为默认值，因为我们是添加商品，本地中还不存在该商品。</p>
<h3 id="抽取-Actions-逻辑"><a href="#抽取-Actions-逻辑" class="headerlink" title="抽取 Actions 逻辑"></a>抽取 Actions 逻辑</h3><p>像之前一样我们创建了<code>src/store/actions.js</code>文件，用于存储从<code>store</code>实例的<code>actions</code>属性中抽取出来的不同类型的<code>action</code>属性。这里我们定义了两个<code>Actions</code>对象：<code>productActions</code>和<code>manufacturerActions</code>，分别表示有关商品和制造商对视图层分发的事件作出的响应，并导出了这两个对象。</p>
<figure class="highlight js"><figcaption><span>src/store/actions.js</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvNDkwOTgwMy9zcmMvc3RvcmUvYWN0aW9ucy5qcw==" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/4909803/src/store/actions.js">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> API_BASE = <span class="string">'http://localhost:3000/api/v1'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> productActions = &#123;</span><br><span class="line">  allProducts(&#123; commit &#125;) &#123;</span><br><span class="line">    commit(<span class="string">'ALL_PRODUCTS'</span>);</span><br><span class="line"></span><br><span class="line">    axios.get(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/products`</span>).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      commit(<span class="string">'ALL_PRODUCTS_SUCCESS'</span>, &#123;</span><br><span class="line">        products: response.data,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  productById(&#123; commit &#125;, payload) &#123;</span><br><span class="line">    commit(<span class="string">'PRODUCT_BY_ID'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; productId &#125; = payload;</span><br><span class="line">    axios.get(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/products/<span class="subst">$&#123;productId&#125;</span>`</span>).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      commit(<span class="string">'PRODUCT_BY_ID_SUCCESS'</span>, &#123;</span><br><span class="line">        product: response.data,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  removeProduct(&#123; commit &#125;, payload) &#123;</span><br><span class="line">    commit(<span class="string">'REMOVE_PRODUCT'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; productId &#125; = payload;</span><br><span class="line">    axios.delete(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/products/<span class="subst">$&#123;productId&#125;</span>`</span>).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 返回 productId，用于删除本地对应的商品</span></span><br><span class="line">      commit(<span class="string">'REMOVE_PRODUCT_SUCCESS'</span>, &#123;</span><br><span class="line">        productId,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  updateProduct(&#123; commit &#125;, payload) &#123;</span><br><span class="line">    commit(<span class="string">'UPDATE_PRODUCT'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; product &#125; = payload;</span><br><span class="line">    axios.put(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/products/<span class="subst">$&#123;product._id&#125;</span>`</span>, product).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      commit(<span class="string">'UPDATE_PRODUCT_SUCCESS'</span>, &#123;</span><br><span class="line">        product,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  addProduct(&#123; commit &#125;, payload) &#123;</span><br><span class="line">    commit(<span class="string">'ADD_PRODUCT'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; product &#125; = payload;</span><br><span class="line">    axios.post(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/products`</span>, product).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      commit(<span class="string">'ADD_PRODUCT_SUCCESS'</span>, &#123;</span><br><span class="line">        product: response.data,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> manufacturerActions = &#123;</span><br><span class="line">  allManufacturers(&#123; commit &#125;) &#123;</span><br><span class="line">    commit(<span class="string">'ALL_MANUFACTURERS'</span>);</span><br><span class="line"></span><br><span class="line">    axios.get(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/manufacturers`</span>).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      commit(<span class="string">'ALL_MANUFACTURERS_SUCCESS'</span>, &#123;</span><br><span class="line">        manufacturers: response.data,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  removeManufacturer(&#123; commit &#125;, payload) &#123;</span><br><span class="line">    commit(<span class="string">'REMOVE_MANUFACTURER'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; manufacturerId &#125; = payload;</span><br><span class="line">    axios.delete(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/manufacturers/<span class="subst">$&#123;manufacturerId&#125;</span>`</span>).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 返回 manufacturerId，用于删除本地对应的制造商</span></span><br><span class="line">      commit(<span class="string">'REMOVE_MANUFACTURER_SUCCESS'</span>, &#123;</span><br><span class="line">        manufacturerId,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在该文件中我们首先导入<code>axios</code>依赖，以及定义了  <code>API_BASE</code>  后端接口根路由；</p>
<p>然后我们定义并导出了两个对象：</p>
<ul>
<li>在<code>productActions</code>对象中定义了一些有关商品在视图层分发对应的事件时，<code>action</code>作出的响应，比如<code>allProducts</code>，<code>productById</code>，<code>removeProduct</code>以及<code>updateProduct</code>等等。</li>
<li>在<code>manufacturerActions</code>对象中定义了一些有关制造商在视图层分发对应的事件时，<code>action</code>作出的响应，比如<code>allManufacturers</code>，<code>removeManufacturer</code>等等。</li>
</ul>
<h3 id="重构-Store-实例-1"><a href="#重构-Store-实例-1" class="headerlink" title="重构 Store 实例"></a>重构 Store 实例</h3><p>我们再次来到<code>src/store/index.js</code>文件中，添加有关抽取<code>Actions</code>逻辑之后的信息。</p>
<figure class="highlight js"><figcaption><span>src/store/index.js</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvNDkwOTgwMy9zcmMvc3RvcmUvaW5kZXguanM=" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/4909803/src/store/index.js">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span>;</span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span>;</span><br><span class="line">[tuture-del]<span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; productGetters, manufacturerGetters &#125; <span class="keyword">from</span> <span class="string">'./getters'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; productMutations, cartMutations, manufacturerMutations &#125; <span class="keyword">from</span> <span class="string">'./mutations'</span>;</span><br><span class="line">[tuture-del]</span><br><span class="line">[tuture-del]<span class="keyword">const</span> API_BASE = <span class="string">'http://localhost:3000/api/v1'</span>;</span><br><span class="line">[tuture-add]<span class="keyword">import</span> &#123; productActions, manufacturerActions &#125; <span class="keyword">from</span> <span class="string">'./actions'</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Vuex);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">  actions: &#123;</span><br><span class="line">[tuture-del]    allProducts(&#123; commit &#125;) &#123;</span><br><span class="line">[tuture-del]      commit(<span class="string">'ALL_PRODUCTS'</span>)</span><br><span class="line">[tuture-del]</span><br><span class="line">[tuture-del]      axios.get(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/products`</span>).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-del]        commit(<span class="string">'ALL_PRODUCTS_SUCCESS'</span>, &#123;</span><br><span class="line">[tuture-del]          products: response.data,</span><br><span class="line">[tuture-del]        &#125;);</span><br><span class="line">[tuture-del]      &#125;)</span><br><span class="line">[tuture-del]    &#125;,</span><br><span class="line">[tuture-del]    productById(&#123; commit &#125;, payload) &#123;</span><br><span class="line">[tuture-del]      commit(<span class="string">'PRODUCT_BY_ID'</span>);</span><br><span class="line">[tuture-del]</span><br><span class="line">[tuture-del]      <span class="keyword">const</span> &#123; productId &#125; = payload;</span><br><span class="line">[tuture-del]      axios.get(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/products/<span class="subst">$&#123;productId&#125;</span>`</span>).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-del]        commit(<span class="string">'PRODUCT_BY_ID_SUCCESS'</span>, &#123;</span><br><span class="line">[tuture-del]          product: response.data,</span><br><span class="line">[tuture-del]        &#125;);</span><br><span class="line">[tuture-del]      &#125;)</span><br><span class="line">[tuture-del]    &#125;,</span><br><span class="line">[tuture-del]    removeProduct(&#123; commit &#125;, payload) &#123;</span><br><span class="line">[tuture-del]      commit(<span class="string">'REMOVE_PRODUCT'</span>);</span><br><span class="line">[tuture-del]</span><br><span class="line">[tuture-del]      <span class="keyword">const</span> &#123; productId &#125; = payload;</span><br><span class="line">[tuture-del]      axios.delete(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/products/<span class="subst">$&#123;productId&#125;</span>`</span>).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-del]        <span class="comment">// 返回 productId，用于删除本地对应的商品</span></span><br><span class="line">[tuture-del]        commit(<span class="string">'REMOVE_PRODUCT_SUCCESS'</span>, &#123;</span><br><span class="line">[tuture-del]          productId,</span><br><span class="line">[tuture-del]        &#125;);</span><br><span class="line">[tuture-del]      &#125;)</span><br><span class="line">[tuture-del]    &#125;,</span><br><span class="line">[tuture-del]    allManufacturers(&#123; commit &#125;) &#123;</span><br><span class="line">[tuture-del]      commit(<span class="string">'ALL_MANUFACTURERS'</span>);</span><br><span class="line">[tuture-del]</span><br><span class="line">[tuture-del]      axios.get(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/manufacturers`</span>).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-del]        commit(<span class="string">'ALL_MANUFACTURERS_SUCCESS'</span>, &#123;</span><br><span class="line">[tuture-del]          manufacturers: response.data,</span><br><span class="line">[tuture-del]        &#125;);</span><br><span class="line">[tuture-del]      &#125;)</span><br><span class="line">[tuture-del]    &#125;,</span><br><span class="line">[tuture-del]    removeManufacturer(&#123; commit &#125;, payload) &#123;</span><br><span class="line">[tuture-del]      commit(<span class="string">'REMOVE_MANUFACTURER'</span>);</span><br><span class="line">[tuture-del]</span><br><span class="line">[tuture-del]      <span class="keyword">const</span> &#123; manufacturerId &#125; = payload;</span><br><span class="line">[tuture-del]      axios.delete(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/manufacturers/<span class="subst">$&#123;manufacturerId&#125;</span>`</span>).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-del]        <span class="comment">// 返回 manufacturerId，用于删除本地对应的制造商</span></span><br><span class="line">[tuture-del]        commit(<span class="string">'REMOVE_MANUFACTURER_SUCCESS'</span>, &#123;</span><br><span class="line">[tuture-del]          manufacturerId,</span><br><span class="line">[tuture-del]        &#125;);</span><br><span class="line">[tuture-del]      &#125;)</span><br><span class="line">[tuture-del]    &#125;,</span><br><span class="line">[tuture-add]    ...productActions,</span><br><span class="line">[tuture-add]    ...manufacturerActions,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这里我们首先导入了<code>actions.js</code>文件中导出的一些 Action 对象，并通过对象展开运算符在<code>store</code>实例的<code>actions</code>属性中混入了不同类型的<code>action</code>属性，实现了 Actions 逻辑的抽取。</p>
<h3 id="添加-mutations-属性"><a href="#添加-mutations-属性" class="headerlink" title="添加 mutations 属性"></a>添加 mutations 属性</h3><p>我们在<code>src/store/mutations.js</code>文件中又添加了一些<code>mutation</code>属性，用于用户进行不同的操作进行本地数据的同步。</p>
<figure class="highlight js"><figcaption><span>src/store/mutations.js</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvNDkwOTgwMy9zcmMvc3RvcmUvbXV0YXRpb25zLmpz" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/4909803/src/store/mutations.js">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; productId &#125; = payload;</span><br><span class="line">    state.products = state.products.filter(<span class="function"><span class="params">product</span> =&gt;</span> product._id !== productId);</span><br><span class="line">[tuture-add]  &#125;,</span><br><span class="line">[tuture-add]  UPDATE_PRODUCT(state) &#123;</span><br><span class="line">[tuture-add]    state.showLoader = <span class="literal">true</span>;</span><br><span class="line">[tuture-add]  &#125;,</span><br><span class="line">[tuture-add]  UPDATE_PRODUCT_SUCCESS(state, payload) &#123;</span><br><span class="line">[tuture-add]    state.showLoader = <span class="literal">false</span>;</span><br><span class="line">[tuture-add]</span><br><span class="line">[tuture-add]    <span class="keyword">const</span> &#123; <span class="attr">product</span>: newProduct &#125; = payload;</span><br><span class="line">[tuture-add]    state.product = newProduct;</span><br><span class="line">[tuture-add]    state.products = state.products.map(<span class="function"><span class="params">product</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-add]      <span class="keyword">if</span> (product._id === newProduct._id) &#123;</span><br><span class="line">[tuture-add]        <span class="keyword">return</span> newProduct;</span><br><span class="line">[tuture-add]      &#125;</span><br><span class="line">[tuture-add]</span><br><span class="line">[tuture-add]      <span class="keyword">return</span> product;</span><br><span class="line">[tuture-add]    &#125;)</span><br><span class="line">[tuture-add]  &#125;,</span><br><span class="line">[tuture-add]  ADD_PRODUCT(state) &#123;</span><br><span class="line">[tuture-add]    state.showLoader = <span class="literal">true</span>;</span><br><span class="line">[tuture-add]  &#125;,</span><br><span class="line">[tuture-add]  ADD_PRODUCT_SUCCESS(state, payload) &#123;</span><br><span class="line">[tuture-add]    state.showLoader = <span class="literal">false</span>;</span><br><span class="line">[tuture-add]</span><br><span class="line">[tuture-add]    <span class="keyword">const</span> &#123; product &#125; = payload;</span><br><span class="line">[tuture-add]    state.products = state.products.concat(product);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>上述添加的都是有关商品的<code>mutation</code>属性：<code>UPDATE_PRODUCT</code>，<code>UPDATE_PRODUCT_SUCCESS</code>，<code>ADD_PRODUCT</code>以及<code>ADD_PRODUCT_SUCCESS</code>分别表示更新商品信息，更新商品信息成功，添加商品以及添加商品成功。</p>
<h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><p>这一节我们学习了如何抽出<code>Actions</code>逻辑，减轻<code>store</code>实例中的负载：</p>
<ul>
<li>首先我们需要创建<code>actions</code>JS 文件，在文件中定义不同类型的<code>Actions</code>对象并导出，然后在<code>Actions</code>对象中定义相应的一些属性。</li>
<li>在<code>store</code>的<code>index</code>文件中导入这些<code>Actions</code>对象，并在<code>store</code>实例的<code>actions</code>属性中通过对象展开运算符混入这些对象。</li>
<li>我们可以使用<code>this.$store.actions.属性</code>的方式调用。</li>
</ul>
<h2 id="干掉-mutation-types-硬编码"><a href="#干掉-mutation-types-硬编码" class="headerlink" title="干掉 mutation-types 硬编码"></a>干掉 mutation-types 硬编码</h2><p>这一节我们主要是进一步完善我们的项目功能以及去掉一些硬编码。</p>
<h3 id="创建-ManufacturerForm-组件"><a href="#创建-ManufacturerForm-组件" class="headerlink" title="创建 ManufacturerForm 组件"></a>创建 ManufacturerForm 组件</h3><p>和商品信息展示功能一样，我们也需要将制造商信息展示部分封装到一个单独的组件<code>ManufacturerForm</code>中，以便我们在新建制造商和编辑制造商组件中都能复用该组件。</p>
<p>因此我们创建了<code>src/components/ManufacturerForm.vue</code>文件，用于展示制造商信息的表单组件。</p>
<figure class="highlight html"><figcaption><span>src/components/ManufacturerForm.vue</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvNDk1NzFkYy9zcmMvY29tcG9uZW50cy9NYW51ZmFjdHVyZXJGb3JtLnZ1ZQ==" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/49571dc/src/components/ManufacturerForm.vue">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> @<span class="attr">submit.prevent</span>=<span class="string">"saveManufacturer"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">placeholder</span>=<span class="string">"Name"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-model</span>=<span class="string">"model.name"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">"name"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"form-control"</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group new-button"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"button"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-pencil"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Conditional rendering for input text --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">"isEditing"</span>&gt;</span>Update Manufacturer<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-else</span>&gt;</span>Add Manufacturer<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">    props: [<span class="string">'model'</span>, <span class="string">'isEditing'</span>],</span></span><br><span class="line">    methods: &#123;</span><br><span class="line">      saveManufacturer() &#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.$emit(<span class="string">'save-manufacturer'</span>, <span class="keyword">this</span>.model);</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>该组件通过父子组件传值从父组件获取到了<code>model</code>和<code>isEditing</code>的值，并将<code>model</code>对象的信息展示在表单中。</p>
<p>表单信息中还通过<code>v-if</code>来判断<code>isEditing</code>的值是<code>true</code>还是<code>false</code>，如果是<code>true</code>则创建<code>Update Manufacturer</code>，反之创建<code>Add Manufacturer</code>。</p>
<p>当用户提交表单时触发<code>saveManufacturer</code>事件，此时会向父组件发送类型为<code>save-manufacturer</code>的事件通知其保存此次的修改操作。</p>
<h3 id="重构-getters-文件"><a href="#重构-getters-文件" class="headerlink" title="重构 getters 文件"></a>重构 getters 文件</h3><p>在创建编辑制造商组件之前，我们需要在 getters 文件中添加对应的 getter 属性。</p>
<p>我们在<code>src/store/getters.js</code>文件的<code>manufacturerGetters</code>对象中又添加了一个<code>manufacturerById</code>方法，用于获取本地中指定的制造商。</p>
<figure class="highlight js"><figcaption><span>src/store/getters.js</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvNDk1NzFkYy9zcmMvc3RvcmUvZ2V0dGVycy5qcw==" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/49571dc/src/store/getters.js">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> manufacturerGetters = &#123;</span><br><span class="line">  allManufacturers(state) &#123;</span><br><span class="line">    <span class="keyword">return</span> state.manufacturers;</span><br><span class="line">[tuture-add]  &#125;,</span><br><span class="line">[tuture-add]  manufacturerById: <span class="function">(<span class="params">state, getters</span>) =&gt;</span> <span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-add]    <span class="keyword">if</span> (getters.allManufacturers.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">[tuture-add]      <span class="keyword">return</span> getters.allManufacturers.filter(<span class="function"><span class="params">manufacturer</span> =&gt;</span> manufacturer._id === id)[<span class="number">0</span>]</span><br><span class="line">[tuture-add]    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">[tuture-add]      <span class="keyword">return</span> state.manufacturer;</span><br><span class="line">[tuture-add]    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>manufacturerById</code>方法中的 id 参数是 Vue 视图层通过方法调用时传入的 id，通过这个 id 判断本地中是否存在该制造商，如果存在则返回该制造商，如果不存在则返回一个空对象。</p>
<h3 id="创建-EditManufacturers-组件"><a href="#创建-EditManufacturers-组件" class="headerlink" title="创建 EditManufacturers 组件"></a>创建 EditManufacturers 组件</h3><p>在创建了展示制造商信息的表单组件<code>ManufacturerForm</code>以及添加了用于获取本地指定制造商数据的 getter 属性之后，紧接着我们又创建了<code>src/pages/admin/EditManufacturers.vue</code>文件，用于修改制造商信息。</p>
<figure class="highlight html"><figcaption><span>src/pages/admin/EditManufacturers.vue</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvNDk1NzFkYy9zcmMvcGFnZXMvYWRtaW4vRWRpdE1hbnVmYWN0dXJlcnMudnVl" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/49571dc/src/pages/admin/EditManufacturers.vue">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">manufacturer-form</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">save-manufacturer</span>=<span class="string">"addManufacturer"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:model</span>=<span class="string">"model"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:isEditing</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">manufacturer-form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> ManufacturerForm <span class="keyword">from</span> <span class="string">'@/components/ManufacturerForm.vue'</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    created() &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.$store.dispatch(<span class="string">'manufacturerById'</span>, &#123;</span></span><br><span class="line"><span class="actionscript">        manufacturerId: <span class="keyword">this</span>.$route.params[<span class="string">'id'</span>],</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;</span><br><span class="line">      model() &#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> manufacturer = <span class="keyword">this</span>.$store.getters.manufacturerById(</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.$route.params[<span class="string">'id'</span>],</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// 这里返回 product 的拷贝，是为了在修改 product 的拷贝之后，在保存之前不修改本地 Vuex stire 的 product 属性</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> &#123; ...manufacturer &#125;;</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      addManufacturer(model) &#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.$store.dispatch(<span class="string">'updateManufacturer'</span>, &#123;</span></span><br><span class="line">          manufacturer: model,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line"><span class="actionscript">      <span class="string">'manufacturer-form'</span>: ManufacturerForm,</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>该组件刚被创建时将当前处于激活状态的路由对象的 id 参数作为载荷分发到类型为<code>manufacturerById</code>的<code>action</code>中，在<code>action</code>中进行异步操作从服务器获取对应制造商，然后将该制造商提交到对应<code>mutation</code>中进行本地状态修改，将获取到的制造商保存到本地。</p>
<p>我们定义了计算属性<code>model</code>返回<code>manufacturer</code>的拷贝，是为了在修改<code>manufacturer</code>的拷贝之后，在保存之前不修改本地 <code>store</code>中的<code>manufacturer</code>属性。这里以方法访问的形式从<code>getters</code>中通过当前激活的路由对象中的 id 参数获取本地状态中的对应制造商作为<code>manufacturer</code>的拷贝，并返回给计算属性<code>model</code>，然后传给子组件<code>ManufacturerForm</code>。</p>
<p>该组件在<code>addManufacturer</code>事件中将子组件传入的新制造商对象作为载荷分发到类型为<code>updateManufacturer</code>的<code>action</code>中，在<code>action</code>中进行异步操作修改后端对应的商品信息，然后将新对象提交到对应的<code>mutation</code>中进行本地状态修改，修改本地状态中的<code>manufacturer</code>对象。</p>
<h3 id="创建-NewManufacturers-组件"><a href="#创建-NewManufacturers-组件" class="headerlink" title="创建 NewManufacturers 组件"></a>创建 NewManufacturers 组件</h3><p>同样的我们继续创建了<code>src/pages/admin/NewManufacturers.vue</code>文件，用于添加制造商信息。该组件和添加商品信息组件代码逻辑类似。</p>
<figure class="highlight html"><figcaption><span>src/pages/admin/NewManufacturers.vue</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvNDk1NzFkYy9zcmMvcGFnZXMvYWRtaW4vTmV3TWFudWZhY3R1cmVycy52dWU=" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/49571dc/src/pages/admin/NewManufacturers.vue">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">manufacturer-form</span> @<span class="attr">save-manufacturer</span>=<span class="string">"addManufacturer"</span> <span class="attr">:model</span>=<span class="string">"model"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">manufacturer-form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> ManufacturerForm <span class="keyword">from</span> <span class="string">'@/components/ManufacturerForm.vue'</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    computed: &#123;</span><br><span class="line">      model() &#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> &#123;&#125;;</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      addManufacturer(model) &#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.$store.dispatch(<span class="string">'addManufacturer'</span>, &#123;</span></span><br><span class="line">          manufacturer: model,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line"><span class="actionscript">      <span class="string">'manufacturer-form'</span>: ManufacturerForm,</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>该组件逻辑代码与<code>New.vue</code>组件类似，一个是添加商品组件，一个是添加制造商组件，您可以对比着来看。</p>
<h3 id="重构-Admin-入口文件-1"><a href="#重构-Admin-入口文件-1" class="headerlink" title="重构 Admin 入口文件"></a>重构 Admin 入口文件</h3><p>之前我们在该入口文件中增加了<strong>查看生产商</strong>导航，这里我们又增加了<strong>添加生产商</strong>导航。</p>
<figure class="highlight html"><figcaption><span>src/pages/admin/Index.vue</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvNDk1NzFkYy9zcmMvcGFnZXMvYWRtaW4vSW5kZXgudnVl" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/49571dc/src/pages/admin/Index.vue">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line">// ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">"/admin/manufacturers"</span>&gt;</span>查看生产商<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">[tuture-add]            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">[tuture-add]              <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">"/admin/manufacturers/new"</span>&gt;</span>添加生产商<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">[tuture-add]            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">      // ...</span><br></pre></td></tr></table></figure>

<h3 id="添加路由信息-1"><a href="#添加路由信息-1" class="headerlink" title="添加路由信息"></a>添加路由信息</h3><p>我们已经创建了添加和修改制造商组件以及添加了对应的入口导航，接着我们需要在该文件中对其进行路由参数配置。</p>
<p>再次进入<code>src/router/index.js</code>文件，我们导入了添加制造商和修改制造商的组件并配置了相关路由参数。</p>
<figure class="highlight js"><figcaption><span>src/router/index.js</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvNDk1NzFkYy9zcmMvcm91dGVyL2luZGV4Lmpz" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/49571dc/src/router/index.js">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">import</span> Products <span class="keyword">from</span> <span class="string">'@/pages/admin/Products'</span>;</span><br><span class="line"><span class="keyword">import</span> Edit <span class="keyword">from</span> <span class="string">'@/pages/admin/Edit'</span>;</span><br><span class="line"><span class="keyword">import</span> Manufacturers <span class="keyword">from</span> <span class="string">'@/pages/admin/Manufacturers'</span>;</span><br><span class="line">[tuture-add]<span class="keyword">import</span> NewManufacturers <span class="keyword">from</span> <span class="string">'@/pages/admin/NewManufacturers'</span>;</span><br><span class="line">[tuture-add]<span class="keyword">import</span> EditManufacturers <span class="keyword">from</span> <span class="string">'@/pages/admin/EditManufacturers'</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Router);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">          name: <span class="string">'Manufacturers'</span>,</span><br><span class="line">          component: Manufacturers,</span><br><span class="line">        &#125;,</span><br><span class="line">[tuture-add]        &#123;</span><br><span class="line">[tuture-add]          path: <span class="string">'manufacturers/new'</span>,</span><br><span class="line">[tuture-add]          name: <span class="string">'NewManufacturers'</span>,</span><br><span class="line">[tuture-add]          component: NewManufacturers,</span><br><span class="line">[tuture-add]        &#125;,</span><br><span class="line">[tuture-add]        &#123;</span><br><span class="line">[tuture-add]          path: <span class="string">'manufacturers/edit/:id'</span>,</span><br><span class="line">[tuture-add]          name: <span class="string">'EditManufacturers'</span>,</span><br><span class="line">[tuture-add]          component: EditManufacturers,</span><br><span class="line">[tuture-add]        &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>这里添加制造商的路由配置就是静态路由的配置方式；修改制造商的路由配置采用了动态传参的方式，这里使用的是<code>$route.params</code>对象的<code>Post</code>方式传参。</p>
<p>配置好添加制造商和修改制造商的路由参数之后，我们又可以进行验收啦，运行项目，点击 Admin 然后再点击添加制造商，我们可以看到添加制造商的表单：</p>
<p><img alt data-src="https://imgkr2.cn-bj.ufileos.com/75d2e9a0-99e1-48b7-bd69-7e3b02c2e1d5.png?UCloudPublicKey=TOKEN_8d8b72be-579a-4e83-bfd0-5f6ce1546f13&Signature=X%252FJFSTrFlTYnf7d5tuQdt%252F%252FVlhA%253D&Expires=1597417641"></p>
<p>然后再点击查看制造商，我们又可以看到一系列的制造商，并且每个制造商都对应的有修改和删除操作，这里我们随便选择一个制造商进行修改，就会看到该制造商的表单信息：</p>
<p><img alt data-src="https://imgkr2.cn-bj.ufileos.com/1ba7ff1c-472b-4aa2-987b-b9272906e773.png?UCloudPublicKey=TOKEN_8d8b72be-579a-4e83-bfd0-5f6ce1546f13&Signature=xC1ZxIRtgoxTIFhTsb4EwxLf1P8%253D&Expires=1597417672"></p>
<h3 id="创建-mutation-types-文件"><a href="#创建-mutation-types-文件" class="headerlink" title="创建 mutation-types 文件"></a>创建 mutation-types 文件</h3><p>这一节我们将对我们的项目代码进行优化，干掉一些硬编码。</p>
<p>我们都知道在<code>actions</code>文件和<code>mutations</code>文件中有一部分的事件类型是需要保持一致的，比如在我们在视图层分发一个添加商品事件<code>ADD_PRODUCT</code>，在<code>actions</code>文件中就需要有对应事件类型的<code>action</code>接收，然后向后端发起请求并将请求结果提交到对应类型的<code>mutation</code>中，这就要求了这几个文件中的对应事件类型都要保持一致。可是我们在开发过程中难免会出错，比如漏掉一个字母就会导致两个文件中的对应事件无法接收，尴尬的是控制台也没有报错，这就造成了我们很难查错。</p>
<p>因此，我们采用了字符串常量的形式定义<code>actions</code>文件和<code>mutations</code>文件中的事件类型，只要我们写错一个单词都会导致字符串常量不一致，关键的是这个时候会报错，利于我们查错。</p>
<p>进而我们创建了<code>src/store/mutation-types.js</code>文件，用于定义一些字符串常量来表示各种事件类型，并导出这些字符串常量。</p>
<figure class="highlight js"><figcaption><span>src/store/mutation-types.js</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvNDk1NzFkYy9zcmMvc3RvcmUvbXV0YXRpb24tdHlwZXMuanM=" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/49571dc/src/store/mutation-types.js">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ALL_PRODUCTS = <span class="string">'ALL_PRODUCTS'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ALL_PRODUCTS_SUCCESS = <span class="string">'ALL_PRODUCTS_SUCCESS'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> PRODUCT_BY_ID = <span class="string">'PRODUCT_BY_ID'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> PRODUCT_BY_ID_SUCCESS = <span class="string">'PRODUCT_BY_ID_SUCCESS'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD_PRODUCT = <span class="string">'ADD_PRODUCT'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD_PRODUCT_SUCCESS = <span class="string">'ADD_PRODUCT_SUCCESS'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> UPDATE_PRODUCT = <span class="string">'UPDATE_PRODUCT'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> UPDATE_PRODUCT_SUCCESS = <span class="string">'UPDATE_PRODUCT_SUCCESS'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> REMOVE_PRODUCT = <span class="string">'REMOVE_PRODUCT'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> REMOVE_PRODUCT_SUCCESS = <span class="string">'REMOVE_PRODUCT_SUCCESS'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD_TO_CART = <span class="string">'ADD_TO_CART'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> REMOVE_FROM_CART = <span class="string">'REMOVE_FROM_CART'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ALL_MANUFACTURERS = <span class="string">'ALL_MANUFACTURER'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ALL_MANUFACTURERS_SUCCESS = <span class="string">'ALL_MANUFACTURER_S'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> MANUFACTURER_BY_ID = <span class="string">'MANUFACTURER_BY_ID'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> MANUFACTURER_BY_ID_SUCCESS = <span class="string">'MANUFACTURER_BY_ID_SUCCESS'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD_MANUFACTURER = <span class="string">'ADD_MANUFACTURER'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD_MANUFACTURER_SUCCESS = <span class="string">'ADD_MANUFACTURER_SUCCESS'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> UPDATE_MANUFACTURER = <span class="string">'UPDATE_MANUFACTURER'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> UPDATE_MANUFACTURER_SUCCESS = <span class="string">'UPDATE_MANUFACTURER_SUCCESS'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> REMOVE_MANUFACTURER = <span class="string">'REMOVE_MANUFACTURER'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> REMOVE_MANUFACTURER_SUCCESS = <span class="string">'REMOVE_MANUFACTURER_SUCCESS'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="重构-actions-文件"><a href="#重构-actions-文件" class="headerlink" title="重构 actions 文件"></a>重构 actions 文件</h3><p>我们再次来到<code>src/store/actions.js</code>文件中，将所有的事件类型用字符串常量表示。</p>
<figure class="highlight js"><figcaption><span>src/store/actions.js</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvNDk1NzFkYy9zcmMvc3RvcmUvYWN0aW9ucy5qcw==" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/49571dc/src/store/actions.js">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"></span><br><span class="line">[tuture-add]<span class="keyword">import</span> &#123;</span><br><span class="line">[tuture-add]  ADD_PRODUCT,</span><br><span class="line">[tuture-add]  ADD_PRODUCT_SUCCESS,</span><br><span class="line">[tuture-add]  PRODUCT_BY_ID,</span><br><span class="line">[tuture-add]  PRODUCT_BY_ID_SUCCESS,</span><br><span class="line">[tuture-add]  UPDATE_PRODUCT,</span><br><span class="line">[tuture-add]  UPDATE_PRODUCT_SUCCESS,</span><br><span class="line">[tuture-add]  REMOVE_PRODUCT,</span><br><span class="line">[tuture-add]  REMOVE_PRODUCT_SUCCESS,</span><br><span class="line">[tuture-add]  ALL_PRODUCTS,</span><br><span class="line">[tuture-add]  ALL_PRODUCTS_SUCCESS,</span><br><span class="line">[tuture-add]  ALL_MANUFACTURERS,</span><br><span class="line">[tuture-add]  ALL_MANUFACTURERS_SUCCESS,</span><br><span class="line">[tuture-add]  MANUFACTURER_BY_ID,</span><br><span class="line">[tuture-add]  MANUFACTURER_BY_ID_SUCCESS,</span><br><span class="line">[tuture-add]  ADD_MANUFACTURER,</span><br><span class="line">[tuture-add]  ADD_MANUFACTURER_SUCCESS,</span><br><span class="line">[tuture-add]  UPDATE_MANUFACTURER,</span><br><span class="line">[tuture-add]  UPDATE_MANUFACTURER_SUCCESS,</span><br><span class="line">[tuture-add]  REMOVE_MANUFACTURER,</span><br><span class="line">[tuture-add]  REMOVE_MANUFACTURER_SUCCESS,</span><br><span class="line">[tuture-add]&#125; <span class="keyword">from</span> <span class="string">'./mutation-types'</span>;</span><br><span class="line">[tuture-add]</span><br><span class="line"><span class="keyword">const</span> API_BASE = <span class="string">'http://localhost:3000/api/v1'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> productActions = &#123;</span><br><span class="line">  allProducts(&#123; commit &#125;) &#123;</span><br><span class="line">[tuture-del]    commit(<span class="string">'ALL_PRODUCTS'</span>)</span><br><span class="line">[tuture-add]    commit(ALL_PRODUCTS)</span><br><span class="line"></span><br><span class="line">    axios.get(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/products`</span>).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-del]      commit(<span class="string">'ALL_PRODUCTS_SUCCESS'</span>, &#123;</span><br><span class="line">[tuture-add]      commit(ALL_PRODUCTS_SUCCESS, &#123;</span><br><span class="line">        products: response.data,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  productById(&#123; commit &#125;, payload) &#123;</span><br><span class="line">[tuture-del]    commit(<span class="string">'PRODUCT_BY_ID'</span>);</span><br><span class="line">[tuture-add]    commit(PRODUCT_BY_ID);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; productId &#125; = payload;</span><br><span class="line">    axios.get(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/products/<span class="subst">$&#123;productId&#125;</span>`</span>).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-del]      commit(<span class="string">'PRODUCT_BY_ID_SUCCESS'</span>, &#123;</span><br><span class="line">[tuture-add]      commit(PRODUCT_BY_ID_SUCCESS, &#123;</span><br><span class="line">        product: response.data,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  removeProduct(&#123; commit &#125;, payload) &#123;</span><br><span class="line">[tuture-del]    commit(<span class="string">'REMOVE_PRODUCT'</span>);</span><br><span class="line">[tuture-add]    commit(REMOVE_PRODUCT);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; productId &#125; = payload;</span><br><span class="line">    axios.delete(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/products/<span class="subst">$&#123;productId&#125;</span>`</span>).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 返回 productId，用于删除本地对应的商品</span></span><br><span class="line">[tuture-del]      commit(<span class="string">'REMOVE_PRODUCT_SUCCESS'</span>, &#123;</span><br><span class="line">[tuture-add]      commit(REMOVE_PRODUCT_SUCCESS, &#123;</span><br><span class="line">        productId,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  updateProduct(&#123; commit &#125;, payload) &#123;</span><br><span class="line">[tuture-del]    commit(<span class="string">'UPDATE_PRODUCT'</span>);</span><br><span class="line">[tuture-add]    commit(UPDATE_PRODUCT);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; product &#125; = payload;</span><br><span class="line">    axios.put(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/products/<span class="subst">$&#123;product._id&#125;</span>`</span>, product).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-del]      commit(<span class="string">'UPDATE_PRODUCT_SUCCESS'</span>, &#123;</span><br><span class="line">[tuture-add]      commit(UPDATE_PRODUCT_SUCCESS, &#123;</span><br><span class="line">        product,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  addProduct(&#123; commit &#125;, payload) &#123;</span><br><span class="line">[tuture-del]    commit(<span class="string">'ADD_PRODUCT'</span>);</span><br><span class="line">[tuture-add]    commit(ADD_PRODUCT);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; product &#125; = payload;</span><br><span class="line">    axios.post(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/products`</span>, product).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-del]      commit(<span class="string">'ADD_PRODUCT_SUCCESS'</span>, &#123;</span><br><span class="line">[tuture-add]      commit(ADD_PRODUCT_SUCCESS, &#123;</span><br><span class="line">        product: response.data,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> manufacturerActions = &#123;</span><br><span class="line">  allManufacturers(&#123; commit &#125;) &#123;</span><br><span class="line">[tuture-del]    commit(<span class="string">'ALL_MANUFACTURERS'</span>);</span><br><span class="line">[tuture-add]    commit(ALL_MANUFACTURERS);</span><br><span class="line"></span><br><span class="line">    axios.get(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/manufacturers`</span>).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-del]      commit(<span class="string">'ALL_MANUFACTURERS_SUCCESS'</span>, &#123;</span><br><span class="line">[tuture-add]      commit(ALL_MANUFACTURERS_SUCCESS, &#123;</span><br><span class="line">        manufacturers: response.data,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">[tuture-add]  manufacturerById(&#123; commit &#125;, payload) &#123;</span><br><span class="line">[tuture-add]    commit(MANUFACTURER_BY_ID);</span><br><span class="line">[tuture-add]</span><br><span class="line">[tuture-add]    <span class="keyword">const</span> &#123; manufacturerId &#125; = payload;</span><br><span class="line">[tuture-add]    axios.get(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/manufacturers/<span class="subst">$&#123;manufacturerId&#125;</span>`</span>).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-add]      commit(MANUFACTURER_BY_ID_SUCCESS, &#123;</span><br><span class="line">[tuture-add]        manufacturer: response.data,</span><br><span class="line">[tuture-add]      &#125;);</span><br><span class="line">[tuture-add]    &#125;)</span><br><span class="line">[tuture-add]  &#125;,</span><br><span class="line">  removeManufacturer(&#123; commit &#125;, payload) &#123;</span><br><span class="line">[tuture-del]    commit(<span class="string">'REMOVE_MANUFACTURER'</span>);</span><br><span class="line">[tuture-add]    commit(REMOVE_MANUFACTURER);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; manufacturerId &#125; = payload;</span><br><span class="line">    axios.delete(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/manufacturers/<span class="subst">$&#123;manufacturerId&#125;</span>`</span>).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 返回 manufacturerId，用于删除本地对应的制造商</span></span><br><span class="line">[tuture-del]      commit(<span class="string">'REMOVE_MANUFACTURER_SUCCESS'</span>, &#123;</span><br><span class="line">[tuture-add]      commit(REMOVE_MANUFACTURER_SUCCESS, &#123;</span><br><span class="line">        manufacturerId,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">[tuture-add]  updateManufacturer(&#123; commit &#125;, payload) &#123;</span><br><span class="line">[tuture-add]    commit(UPDATE_MANUFACTURER);</span><br><span class="line">[tuture-add]</span><br><span class="line">[tuture-add]    <span class="keyword">const</span> &#123; manufacturer &#125; = payload;</span><br><span class="line">[tuture-add]    axios.put(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/manufacturers/<span class="subst">$&#123;manufacturer._id&#125;</span>`</span>, manufacturer).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-add]      commit(UPDATE_MANUFACTURER_SUCCESS, &#123;</span><br><span class="line">[tuture-add]        manufacturer,</span><br><span class="line">[tuture-add]      &#125;);</span><br><span class="line">[tuture-add]    &#125;)</span><br><span class="line">[tuture-add]  &#125;,</span><br><span class="line">[tuture-add]  addManufacturer(&#123; commit &#125;, payload) &#123;</span><br><span class="line">[tuture-add]    commit(ADD_MANUFACTURER);</span><br><span class="line">[tuture-add]</span><br><span class="line">[tuture-add]    <span class="keyword">const</span> &#123; manufacturer &#125; = payload;</span><br><span class="line">[tuture-add]    axios.post(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/manufacturers`</span>, manufacturer).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-add]      commit(ADD_MANUFACTURER_SUCCESS, &#123;</span><br><span class="line">[tuture-add]        manufacturer: response.data,</span><br><span class="line">[tuture-add]      &#125;)</span><br><span class="line">[tuture-add]    &#125;)</span><br><span class="line">[tuture-add]  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里我们首先导入了<code>mutation-types</code>文件中定义的一些字符串常量，替换掉了对应的事件类型。</p>
<h3 id="重构-mutations-文件"><a href="#重构-mutations-文件" class="headerlink" title="重构 mutations 文件"></a>重构 mutations 文件</h3><p>同 actions 文件一样，我们再次进入<code>src/store/mutations.js</code>文件，将文件中的各种事件类型用字符串常量替代。</p>
<figure class="highlight js"><figcaption><span>src/store/mutations.js</span><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXYvdnVlLW9ubGluZS1zaG9wLWZyb250ZW5kL2Jsb2IvNDk1NzFkYy9zcmMvc3RvcmUvbXV0YXRpb25zLmpz" title="https://github.com/tuture-dev/vue-online-shop-frontend/blob/49571dc/src/store/mutations.js">查看完整代码<i class="fa fa-external-link"></i></span></figcaption><table><tr><td class="code"><pre><span class="line">[tuture-add]<span class="keyword">import</span> &#123;</span><br><span class="line">[tuture-add]  ADD_PRODUCT,</span><br><span class="line">[tuture-add]  ADD_PRODUCT_SUCCESS,</span><br><span class="line">[tuture-add]  PRODUCT_BY_ID,</span><br><span class="line">[tuture-add]  PRODUCT_BY_ID_SUCCESS,</span><br><span class="line">[tuture-add]  UPDATE_PRODUCT,</span><br><span class="line">[tuture-add]  UPDATE_PRODUCT_SUCCESS,</span><br><span class="line">[tuture-add]  REMOVE_PRODUCT,</span><br><span class="line">[tuture-add]  REMOVE_PRODUCT_SUCCESS,</span><br><span class="line">[tuture-add]  ADD_TO_CART,</span><br><span class="line">[tuture-add]  REMOVE_FROM_CART,</span><br><span class="line">[tuture-add]  ALL_PRODUCTS,</span><br><span class="line">[tuture-add]  ALL_PRODUCTS_SUCCESS,</span><br><span class="line">[tuture-add]  ALL_MANUFACTURERS,</span><br><span class="line">[tuture-add]  ALL_MANUFACTURERS_SUCCESS,</span><br><span class="line">[tuture-add]  MANUFACTURER_BY_ID,</span><br><span class="line">[tuture-add]  MANUFACTURER_BY_ID_SUCCESS,</span><br><span class="line">[tuture-add]  ADD_MANUFACTURER,</span><br><span class="line">[tuture-add]  ADD_MANUFACTURER_SUCCESS,</span><br><span class="line">[tuture-add]  UPDATE_MANUFACTURER,</span><br><span class="line">[tuture-add]  UPDATE_MANUFACTURER_SUCCESS,</span><br><span class="line">[tuture-add]  REMOVE_MANUFACTURER,</span><br><span class="line">[tuture-add]  REMOVE_MANUFACTURER_SUCCESS,</span><br><span class="line">[tuture-add]&#125; <span class="keyword">from</span> <span class="string">'./mutation-types'</span>;</span><br><span class="line">[tuture-add]</span><br><span class="line">[tuture-add]</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> productMutations = &#123;</span><br><span class="line">[tuture-del]  ALL_PRODUCTS(state) &#123;</span><br><span class="line">[tuture-add]  [ALL_PRODUCTS](state) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">[tuture-del]  ALL_PRODUCTS_SUCCESS(state, payload) &#123;</span><br><span class="line">[tuture-add]  [ALL_PRODUCTS_SUCCESS](state, payload) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; products &#125; = payload;</span><br><span class="line"></span><br><span class="line">    state.showLoader = <span class="literal">false</span>;</span><br><span class="line">    state.products = products;</span><br><span class="line">  &#125;,</span><br><span class="line">[tuture-del]  PRODUCT_BY_ID(state) &#123;</span><br><span class="line">[tuture-add]  [PRODUCT_BY_ID](state) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">[tuture-del]  PRODUCT_BY_ID_SUCCESS(state, payload) &#123;</span><br><span class="line">[tuture-add]  [PRODUCT_BY_ID_SUCCESS](state, payload) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; product &#125; = payload;</span><br><span class="line">    state.product = product;</span><br><span class="line">  &#125;,</span><br><span class="line">[tuture-del]  REMOVE_PRODUCT(state) &#123;</span><br><span class="line">[tuture-add]  [REMOVE_PRODUCT](state) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">[tuture-del]  REMOVE_PRODUCT_SUCCESS(state, payload) &#123;</span><br><span class="line">[tuture-add]  [REMOVE_PRODUCT_SUCCESS](state, payload) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; productId &#125; = payload;</span><br><span class="line">    state.products = state.products.filter(<span class="function"><span class="params">product</span> =&gt;</span> product._id !== productId);</span><br><span class="line">  &#125;,</span><br><span class="line">[tuture-del]  UPDATE_PRODUCT(state) &#123;</span><br><span class="line">[tuture-add]  [UPDATE_PRODUCT](state) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">[tuture-del]  UPDATE_PRODUCT_SUCCESS(state, payload) &#123;</span><br><span class="line">[tuture-add]  [UPDATE_PRODUCT_SUCCESS](state, payload) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">product</span>: newProduct &#125; = payload;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">      <span class="keyword">return</span> product;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">[tuture-del]  ADD_PRODUCT(state) &#123;</span><br><span class="line">[tuture-add]  [ADD_PRODUCT](state) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">[tuture-del]  ADD_PRODUCT_SUCCESS(state, payload) &#123;</span><br><span class="line">[tuture-add]  [ADD_PRODUCT_SUCCESS](state, payload) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; product &#125; = payload;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> cartMutations = &#123;</span><br><span class="line">[tuture-del]  ADD_TO_CART(state, payload) &#123;</span><br><span class="line">[tuture-add]  [ADD_TO_CART](state, payload) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; product &#125; = payload;</span><br><span class="line">    state.cart.push(product)</span><br><span class="line">  &#125;,</span><br><span class="line">[tuture-del]  REMOVE_FROM_CART(state, payload) &#123;</span><br><span class="line">[tuture-add]  [REMOVE_FROM_CART](state, payload) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; productId &#125; = payload</span><br><span class="line">    state.cart = state.cart.filter(<span class="function"><span class="params">product</span> =&gt;</span> product._id !== productId)</span><br><span class="line">  &#125;,</span><br><span class="line">[tuture-del]&#125;</span><br><span class="line">[tuture-add]&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> manufacturerMutations = &#123;</span><br><span class="line">[tuture-del]  ALL_MANUFACTURERS(state) &#123;</span><br><span class="line">[tuture-add]  [ALL_MANUFACTURERS](state) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">[tuture-del]  ALL_MANUFACTURERS_SUCCESS(state, payload) &#123;</span><br><span class="line">[tuture-add]  [ALL_MANUFACTURERS_SUCCESS](state, payload) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; manufacturers &#125; = payload;</span><br><span class="line"></span><br><span class="line">    state.showLoader = <span class="literal">false</span>;</span><br><span class="line">    state.manufacturers = manufacturers;</span><br><span class="line">  &#125;,</span><br><span class="line">[tuture-del]  REMOVE_MANUFACTURER(state) &#123;</span><br><span class="line">[tuture-add]  [MANUFACTURER_BY_ID](state) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">[tuture-del]  REMOVE_MANUFACTURER_SUCCESS(state, payload) &#123;</span><br><span class="line">[tuture-add]  [MANUFACTURER_BY_ID_SUCCESS](state, payload) &#123;</span><br><span class="line">[tuture-add]    state.showLoader = <span class="literal">false</span>;</span><br><span class="line">[tuture-add]</span><br><span class="line">[tuture-add]    <span class="keyword">const</span> &#123; manufacturer &#125; = payload;</span><br><span class="line">[tuture-add]    state.manufacturer = manufacturer;</span><br><span class="line">[tuture-add]  &#125;,</span><br><span class="line">[tuture-add]  [REMOVE_MANUFACTURER](state) &#123;</span><br><span class="line">[tuture-add]    state.showLoader = <span class="literal">true</span>;</span><br><span class="line">[tuture-add]  &#125;,</span><br><span class="line">[tuture-add]  [REMOVE_MANUFACTURER_SUCCESS](state, payload) &#123;</span><br><span class="line">    state.showLoader = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; manufacturerId &#125; = payload;</span><br><span class="line">    state.manufacturers = state.manufacturers.filter(<span class="function"><span class="params">manufacturer</span> =&gt;</span> manufacturer._id !== manufacturerId);</span><br><span class="line">[tuture-add]  &#125;,</span><br><span class="line">[tuture-add]  [UPDATE_MANUFACTURER](state) &#123;</span><br><span class="line">[tuture-add]    state.showLoader = <span class="literal">true</span>;</span><br><span class="line">[tuture-add]  &#125;,</span><br><span class="line">[tuture-add]  [UPDATE_MANUFACTURER_SUCCESS](state, payload) &#123;</span><br><span class="line">[tuture-add]    state.showLoader = <span class="literal">false</span>;</span><br><span class="line">[tuture-add]</span><br><span class="line">[tuture-add]    <span class="keyword">const</span> &#123; <span class="attr">manufacturer</span>: newManufacturer &#125; = payload;</span><br><span class="line">[tuture-add]    state.manufacturers = state.manufacturers.map(<span class="function"><span class="params">manufacturer</span> =&gt;</span> &#123;</span><br><span class="line">[tuture-add]      <span class="keyword">if</span> (manufacturer._id === newManufacturer._id) &#123;</span><br><span class="line">[tuture-add]        <span class="keyword">return</span> newManufacturer;</span><br><span class="line">[tuture-add]      &#125;</span><br><span class="line">[tuture-add]</span><br><span class="line">[tuture-add]      <span class="keyword">return</span> manufacturer;</span><br><span class="line">[tuture-add]    &#125;)</span><br><span class="line">[tuture-add]  &#125;,</span><br><span class="line">[tuture-add]  [ADD_MANUFACTURER](state) &#123;</span><br><span class="line">[tuture-add]    state.showLoader = <span class="literal">true</span>;</span><br><span class="line">[tuture-add]  &#125;,</span><br><span class="line">[tuture-add]  [ADD_MANUFACTURER_SUCCESS](state, payload) &#123;</span><br><span class="line">[tuture-add]    state.showLoader = <span class="literal">false</span>;</span><br><span class="line">[tuture-add]</span><br><span class="line">[tuture-add]    <span class="keyword">const</span> &#123; manufacturer &#125; = payload;</span><br><span class="line">[tuture-add]    state.manufacturers = state.manufacturers.concat(manufacturer);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里我们首先导入了<code>mutation-types</code>文件中定义的一些字符串常量，替换掉了对应的事件类型。</p>
<h3 id="小结-2"><a href="#小结-2" class="headerlink" title="小结"></a>小结</h3><p>这一节我们主要做了以下工作：</p>
<ul>
<li>创建了制造商相关组件并配置了相应路由参数，实现了新建和修改制造商信息；</li>
<li>利用字符串常量代替 actions 文件和 mutations 文件中的事件类型；</li>
</ul>
<h2 id="大量改进最后一步内容"><a href="#大量改进最后一步内容" class="headerlink" title="大量改进最后一步内容"></a>大量改进最后一步内容</h2>
    </div>

    
    
    
      

        <div id="qrcode_subscriber-container">
  <div></div>

  <div id="qrocde-qr">
        
      
      <div style="display: inline-block">
        <img src="/uploads/wechat-qcode.png" alt="图雀社区 微信公众号">
        <p>扫一扫关注上方公众号，拉学习群和答疑解惑</p>
      </div>

  </div>
</div>

      
        
      
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>图雀社区</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tuture.co/2020/03/03/-Oixkkq/" title="从零到部署：用 Vue 和 Express 实现迷你全栈电商应用（六）">https://tuture.co/2020/03/03/-Oixkkq/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li>
</ul>
</div>

      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/Vue/" rel="tag"><i class="fa fa-tag"></i> Vue</a>
            
              <a href="/tags/Vuex/" rel="tag"><i class="fa fa-tag"></i> Vuex</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2020/02/19/abfd872/" rel="next" title="Taro 小程序开发大型实战（六）：LeanCloud，一统江湖">
                  <i class="fa fa-chevron-left"></i> Taro 小程序开发大型实战（六）：LeanCloud，一统江湖
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2020/03/05/@5e60587/" rel="prev" title="爬虫养成记——先跨进这个精彩的世界（女生定制篇）">
                  爬虫养成记——先跨进这个精彩的世界（女生定制篇） <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
      <div>
          
          
          
          
        

        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc">
            文章目录
          </li>
          <li class="sidebar-nav-overview">
            站点概览
          </li>
        </ul>

        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#抽出-Getters-和-Mutations-逻辑"><span class="nav-number">1.</span> <span class="nav-text">抽出 Getters 和 Mutations 逻辑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#重构-Admin-入口文件"><span class="nav-number">1.1.</span> <span class="nav-text">重构 Admin 入口文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建-Manufacturers-组件"><span class="nav-number">1.2.</span> <span class="nav-text">创建 Manufacturers 组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重构-Products-组件"><span class="nav-number">1.3.</span> <span class="nav-text">重构 Products 组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加路由信息"><span class="nav-number">1.4.</span> <span class="nav-text">添加路由信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#抽取-Getters-逻辑"><span class="nav-number">1.5.</span> <span class="nav-text">抽取 Getters 逻辑</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#抽取-Mutations-逻辑"><span class="nav-number">1.6.</span> <span class="nav-text">抽取 Mutations 逻辑</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重构-Store-实例"><span class="nav-number">1.7.</span> <span class="nav-text">重构 Store 实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#小结"><span class="nav-number">1.8.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#抽出-Actions-逻辑"><span class="nav-number">2.</span> <span class="nav-text">抽出 Actions 逻辑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#重构-Edit-组件"><span class="nav-number">2.1.</span> <span class="nav-text">重构 Edit 组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重构-New-组件"><span class="nav-number">2.2.</span> <span class="nav-text">重构 New 组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#抽取-Actions-逻辑"><span class="nav-number">2.3.</span> <span class="nav-text">抽取 Actions 逻辑</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重构-Store-实例-1"><span class="nav-number">2.4.</span> <span class="nav-text">重构 Store 实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加-mutations-属性"><span class="nav-number">2.5.</span> <span class="nav-text">添加 mutations 属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#小结-1"><span class="nav-number">2.6.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#干掉-mutation-types-硬编码"><span class="nav-number">3.</span> <span class="nav-text">干掉 mutation-types 硬编码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建-ManufacturerForm-组件"><span class="nav-number">3.1.</span> <span class="nav-text">创建 ManufacturerForm 组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重构-getters-文件"><span class="nav-number">3.2.</span> <span class="nav-text">重构 getters 文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建-EditManufacturers-组件"><span class="nav-number">3.3.</span> <span class="nav-text">创建 EditManufacturers 组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建-NewManufacturers-组件"><span class="nav-number">3.4.</span> <span class="nav-text">创建 NewManufacturers 组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重构-Admin-入口文件-1"><span class="nav-number">3.5.</span> <span class="nav-text">重构 Admin 入口文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加路由信息-1"><span class="nav-number">3.6.</span> <span class="nav-text">添加路由信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建-mutation-types-文件"><span class="nav-number">3.7.</span> <span class="nav-text">创建 mutation-types 文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重构-actions-文件"><span class="nav-number">3.8.</span> <span class="nav-text">重构 actions 文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重构-mutations-文件"><span class="nav-number">3.9.</span> <span class="nav-text">重构 mutations 文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#小结-2"><span class="nav-number">3.10.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#大量改进最后一步内容"><span class="nav-number">4.</span> <span class="nav-text">大量改进最后一步内容</span></a></li></ol></div>
          
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="图雀社区">
  <p class="site-author-name" itemprop="name">图雀社区</p>
  <div class="site-description" itemprop="description">由 <a href="https://github.com/tuture-dev/tuture" target="_blank" rel="external nofollow noopener noreferrer">Tuture</a> 工具写成，这里汇集了能够让你从头敲到尾并做出可运行项目的精彩的免费技术教程</div>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uaW0vdXNlci81YjMzNDE0MzUxODgyNTc0Yjk2OTRkMjg="><i class="fa fa-fw fa-custom juejin"></i>掘金</span>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="/images/social/wechat.png"><i class="fa fa-fw fa-custom wechat"></i>微信</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vdHV0dXJl"><i class="fa fa-fw fa-custom zhihu"></i>知乎</span>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R1dHVyZS1kZXY="><i class="fa fa-fw fa-github"></i>GitHub</span>
      </span>
    
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright"><span class="exturl" data-url="aHR0cDovL3d3dy5iZWlhbi5taWl0Lmdvdi5jbg==">沪ICP备19039313号 </span><span><img src="/images/gongan-url.png" style="display:inline-block;">
  
  <span class="exturl" data-url="aHR0cDovL3d3dy5iZWlhbi5nb3YuY24vcG9ydGFsL3JlZ2lzdGVyU3lzdGVtSW5mbz9yZWNvcmRjb2RlPTMxMDExNzAyMDA3MTMw">沪公网安备 31011702007130号 </span>&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">图雀社区</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">898k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">13:36</span>
</span></div>
  <div class="powered-by">由 <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> 强力驱动 v4.2.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <span class="exturl theme-link" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZw==">NexT.Pisces</span> v7.4.0</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>

<script src="/js/utils.js?v=7.4.0.js"></script>


<script src="/js/schemes/pisces.js?v=7.4.0.js"></script>


<script src="/js/next-boot.js?v=7.4.0.js"></script>

<script src="/js/bookmark.js?v=7.4.0.js"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>








  
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css">
<script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.js"></script>
<script src="/js/algolia-search.js?v=7.4.0.js"></script>
















  

  

  


  <script>
    const line = document.getElementsByClassName('line');
    const arrLine = Array.from(line);

    const delRegex = /\[.*tuture.*-.*del.*?\]/;
    const addRegex = /\[.*tuture.*-.*add.*?\]/;
    const omitRegex = /\[.*tuture.*-.*omit.*?\]/;

    const delSpaceRegex = /^\s*\[.*tuture.*-.*del.*?\]\s*$/;
    const addSpaceRegex = /^\s*\[.*tuture.*-.*add.*?\]\s*$/;
    const omitSpaceRegex = /^\s*\[.*tuture.*-.*omit.*?\]\s*$/;

    arrLine.map(item => {
      if (item.innerText.startsWith('[tuture-add]')) {
        if (addSpaceRegex.test(item.innerText)) {
          item.innerHTML = item.innerHTML.replace(addRegex, ' ');
        } else {
          item.innerHTML = item.innerHTML.replace(addRegex, '');
        }

          item.className = item.className + ' tuture-add';
      } else if (item.innerText.startsWith('[tuture-del]')) {
          if (delSpaceRegex.test(item.innerText)) {
            item.innerHTML = item.innerHTML.replace(delRegex, ' ');
          } else {
            item.innerHTML = item.innerHTML.replace(delRegex, '');
          }

          item.className = item.className + ' tuture-del';
      } else if (item.innerText.startsWith('[tuture-omit]')) {
        item.innerHTML = item.innerHTML.replace(omitRegex, '...');
        item.className = item.className + ' tuture-omit';
      }
    })
  </script>
</body>
</html>
